<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기" /><meta name="author" content="JaeHo YooN" /><meta property="og:locale" content="en" /><meta name="description" content="ROS 패키지 제작" /><meta property="og:description" content="ROS 패키지 제작" /><link rel="canonical" href="https://dkssud8150.github.io/posts/package/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/package/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-27T01:23:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo YooN"},"dateModified":"2022-08-02T18:35:01+09:00","datePublished":"2022-07-27T01:23:00+09:00","description":"ROS 패키지 제작","headline":"[ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/package/"},"url":"https://dkssud8150.github.io/posts/package/"}</script><title> [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기 | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span> [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기 </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip> [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-07-27 01:23:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 27, 2022, 1:23 AM +0900" >Jul 27, 2022</em> </span> <span> Updated <em class="timeago" date="2022-08-02 18:35:01 +0900 " data-toggle="tooltip" data-placement="bottom" title="Tue, Aug 2, 2022, 6:35 PM +0900" >Aug 2, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7775 words"> <em>43 min</em> read</span></div></div></div><div class="post-content"><h1 id="ros-패키지-제작">ROS 패키지 제작</h1><h2 id="ros-패키지-설계">ROS 패키지 설계 <a href="#ros-패키지-설계" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/ros2/package/package_configure.png" data-proofer-ignore></p><p>목적별로 나누어 노드 단위의 프로그램을 작성하고, 노드와 노드간의 데이터 통신을 설계해야 한다. 이번 예제 패키지는 토픽, 서비스, 액션으로 구성하고자 한다.</p><p>총 4개의 노드로 구성되며, 각 노드에서는 1개 이상의 토픽 퍼블리셔, 토픽 서브스크라이브, 서비스 서버, 서비스 클라이언트, 액션 서버, 액션 클라이언트가 존재한다. 중앙에 있는 노드는 다른 노드들과의 연동을 해야 하므로 가장 핵심적인 역할이다.</p><p>각각의 노드, 토픽, 서비스, 액션은 고유의 이름을 가지고 있다.</p><ul><li><code class="language-plaintext highlighter-rouge">argument</code> : <em>arithmetic_argument</em> <strong>토픽</strong> 이름으로 현재 시간과 변수 a,b를 <strong>퍼블리시</strong>한다.<li><code class="language-plaintext highlighter-rouge">operator</code> : <em>arithmetic_operator</em> <strong>서비스</strong> 이름으로 calculator 노드에게 연산자(+-*/)를 <strong>서비스</strong> 요청값으로 보낸다.<li><code class="language-plaintext highlighter-rouge">calculator</code><ul><li><strong>토픽</strong>이 생성된 시간과 변수 a,b를 <em>arithmetic_argument</em> 이름의 토픽을 <strong>서브스크라이브</strong>한다.<li>받은 변수 a,b와 operator 노드로부터 요청값으로 받은 연산자를 통해 <strong>계산</strong>하고(a 연산자 b), operator 노드에게 결괏값을 <em>arithmetic_operator</em> 이름으로 <strong>서비스 응답값</strong>을 보낸다.<li>checker 노드로부터 <strong>액션 목표값</strong>(① action goal)을 받은 후부터 저장된 변수(a,b,연산자)를 가지고 연산한 값을 합한다. 그리고 연산이 끝난 계산식을 <em>arithmetic_checker</em> 이름으로 <strong>액션 피드백</strong>(② action feedback)을 checker 노드로 보낸다. 연산값의 합이 액션 목표값을 넘기면 최종 연산 합계를 <em>arithmetic_checker</em> 이름으로 <strong>액션 결괏값</strong>(③ action result)을 checker 노드로 보낸다.</ul><li><code class="language-plaintext highlighter-rouge">checker</code> : 연산값의 합계의 <strong>한계치</strong>를 <em>arithmetic_checker</em> <strong>액션</strong> 이름으로 <strong>액션</strong> 목표값으로 <strong>전달</strong>한다.</ul><p> </p><p> </p><h2 id="ros2-cpp-패키지-제작">ROS2 CPP 패키지 제작 <a href="#ros2-cpp-패키지-제작" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://cafe.naver.com/openrt/24798">034 ROS2 패키지 설계 (C++)</a><li><a href="https://cafe.naver.com/openrt/24802">035 토픽 프로그래밍 (C++)</a></ul><h3 id="ros2-패키지-설정">ROS2 패키지 설정 <a href="#ros2-패키지-설정" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>🔥 주의 : 아래 파일들은 코드를 설명하기 위해서만 보고, 추후 git clone을 수행할 예정이므로 패키지를 직접 생성하지 않기를 바란다. 만약 패키지를 동일한 이름으로 생성할 경우 빌드에 문제가 생기므로, 다른 이름으로 생성하여 커스터마이징하거나, clone한 것을 사용하길 바란다.</p><p> </p><ul><li>package.xml</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?&gt;</span>

<span class="c">&lt;!-- ROS2 패키지 설정파일의 package format이 세번째 버전이므로 3 --&gt;</span>
<span class="nt">&lt;package</span> <span class="na">format=</span><span class="s">"3"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- 패키지 이름 --&gt;</span>
  <span class="nt">&lt;name&gt;</span>topic_service_action_rclcpp_example<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>

  <span class="c">&lt;!-- 설명 --&gt;</span>
  <span class="nt">&lt;description&gt;</span>ROS 2 rclcpp example package for the topic, service, action<span class="nt">&lt;/description&gt;</span> 
  <span class="nt">&lt;maintainer</span> <span class="na">email=</span><span class="s">"jhyoon@todo.todo"</span><span class="nt">&gt;</span>jhyoon<span class="nt">&lt;/maintainer&gt;</span>
  <span class="c">&lt;!-- 라이선스 --&gt;</span>
  <span class="nt">&lt;license&gt;</span>Apache License 2.0<span class="nt">&lt;/license&gt;</span>
  <span class="nt">&lt;author</span> <span class="na">email=</span><span class="s">"passionvirus@gmail.com"</span><span class="nt">&gt;</span>Pyo<span class="nt">&lt;/author&gt;</span>
  <span class="nt">&lt;author</span> <span class="na">email=</span><span class="s">"routiful@gmail.com"</span><span class="nt">&gt;</span>Darby Lim<span class="nt">&lt;/author&gt;</span>

  <span class="c">&lt;!-- 빌드툴 : ament_cmake --&gt;</span>
  <span class="nt">&lt;buildtool_depend&gt;</span>ament_cmake<span class="nt">&lt;/buildtool_depend&gt;</span>

  <span class="c">&lt;!-- dependency --&gt;</span>
  <span class="c">&lt;!-- ros2에서 사용하는 cpp툴 --&gt;</span>
  <span class="nt">&lt;depend&gt;</span>rclcpp<span class="nt">&lt;/depend&gt;</span>
  <span class="c">&lt;!-- cpp툴에서 action 사용하기 위함 --&gt;</span>
  <span class="nt">&lt;depend&gt;</span>rclcpp_action<span class="nt">&lt;/depend&gt;</span>
  <span class="c">&lt;!-- std 패키지 사용 --&gt;</span>
  <span class="nt">&lt;depend&gt;</span>std_msgs<span class="nt">&lt;/depend&gt;</span>
  <span class="c">&lt;!-- 토픽,서비스,액션 인터페이스 사용하는 패키지 --&gt;</span>
  <span class="nt">&lt;depend&gt;</span>msg_srv_action_interface_example<span class="nt">&lt;/depend&gt;</span>

  <span class="c">&lt;!-- 사용하고자 하는 Lint 패키지, 테스트 코드를 위한 의존성 패키지 --&gt;</span>
  <span class="nt">&lt;test_depend&gt;</span>ament_lint_auto<span class="nt">&lt;/test_depend&gt;</span>
  <span class="nt">&lt;test_depend&gt;</span>ament_lint_common<span class="nt">&lt;/test_depend&gt;</span>

  <span class="nt">&lt;export&gt;</span>
    <span class="c">&lt;!-- build type : ament_cmake --&gt;</span>
    <span class="nt">&lt;build_type&gt;</span>ament_cmake<span class="nt">&lt;/build_type&gt;</span>
  <span class="nt">&lt;/export&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</pre></table></code></div></div><p> </p><ul><li>CMakeLists.txt</ul><p>CMakelist에는 크게 cmake 설정, 의존성 명시, 빌드, 설치, 테스트, ament package 매크로 설정으로 구성되어 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre><td class="rouge-code"><pre><span class="cp"># Set minimum required version of cmake, project name and compile options
</span><span class="n">cmake_minimum_required</span><span class="p">(</span><span class="n">VERSION</span> <span class="mf">3.5</span><span class="p">)</span>

<span class="cp"># project name
</span><span class="n">project</span><span class="p">(</span><span class="n">topic_service_action_rclcpp_example</span><span class="p">)</span>

<span class="cp"># C언어의 버전을 명시하지 않으면 C99를 기본으로 사용
</span><span class="k">if</span><span class="p">(</span><span class="n">NOT</span> <span class="n">CMAKE_C_STANDARD</span><span class="p">)</span>
  <span class="n">set</span><span class="p">(</span><span class="n">CMAKE_C_STANDARD</span> <span class="mi">99</span><span class="p">)</span>
<span class="n">endif</span><span class="p">()</span>

<span class="cp"># C++의 버전을 명시하지 않으면 C++ 14를 기본으로 사용
</span><span class="k">if</span><span class="p">(</span><span class="n">NOT</span> <span class="n">CMAKE_CXX_STANDARD</span><span class="p">)</span>
  <span class="n">set</span><span class="p">(</span><span class="n">CMAKE_CXX_STANDARD</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">endif</span><span class="p">()</span>

<span class="cp"># GNU를 기본으로 사용하지만, Clang 컴파일러를 사용할 수도 있다.
</span><span class="k">if</span><span class="p">(</span><span class="n">CMAKE_COMPILER_IS_GNUCXX</span> <span class="n">OR</span> <span class="n">CMAKE_CXX_COMPILER_ID</span> <span class="n">MATCHES</span> <span class="s">"Clang"</span><span class="p">)</span>
  <span class="n">add_compile_options</span><span class="p">(</span><span class="o">-</span><span class="n">Wall</span> <span class="o">-</span><span class="n">Wextra</span> <span class="o">-</span><span class="n">Wpedantic</span><span class="p">)</span>
<span class="n">endif</span><span class="p">()</span>

<span class="cp"># Find dependencies
# REQUIRED : 패키지를 찾고, 없으면 에러가 나도록 하는 옵션
</span><span class="n">find_package</span><span class="p">(</span><span class="n">ament_cmake</span> <span class="n">REQUIRED</span><span class="p">)</span>
<span class="n">find_package</span><span class="p">(</span><span class="n">rclcpp</span> <span class="n">REQUIRED</span><span class="p">)</span>
<span class="n">find_package</span><span class="p">(</span><span class="n">msg_srv_action_interface_example</span> <span class="n">REQUIRED</span><span class="p">)</span>
<span class="n">find_package</span><span class="p">(</span><span class="n">rclcpp_action</span> <span class="n">REQUIRED</span><span class="p">)</span>

<span class="cp"># header 파일을 가져오기 위한 디렉토리
</span><span class="n">include_directories</span><span class="p">(</span><span class="n">include</span><span class="p">)</span>

<span class="cp"># Build
# 실제로 실행하는 파일 (node_name file_directory)
</span><span class="n">add_executable</span><span class="p">(</span><span class="n">argument</span> <span class="n">src</span><span class="o">/</span><span class="n">arithmetic</span><span class="o">/</span><span class="n">argument</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="cp"># 프로그램 실행을 위해 필요한 의존성 패키지
</span><span class="n">ament_target_dependencies</span><span class="p">(</span><span class="n">argument</span>
  <span class="n">msg_srv_action_interface_example</span>
  <span class="n">rclcpp</span>
<span class="p">)</span>

<span class="n">add_executable</span><span class="p">(</span><span class="n">calculator</span> <span class="n">src</span><span class="o">/</span><span class="n">calculator</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span> <span class="n">src</span><span class="o">/</span><span class="n">calculator</span><span class="o">/</span><span class="n">calculator</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="cp"># calculator에서는 action도 진행되기에 의존성 패키지에 추가
</span><span class="n">ament_target_dependencies</span><span class="p">(</span><span class="n">calculator</span>
  <span class="n">msg_srv_action_interface_example</span>
  <span class="n">rclcpp</span>
  <span class="n">rclcpp_action</span>
<span class="p">)</span>

<span class="n">add_executable</span><span class="p">(</span><span class="n">checker</span> <span class="n">src</span><span class="o">/</span><span class="n">checker</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span> <span class="n">src</span><span class="o">/</span><span class="n">checker</span><span class="o">/</span><span class="n">checker</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="n">ament_target_dependencies</span><span class="p">(</span><span class="n">checker</span>
  <span class="n">msg_srv_action_interface_example</span>
  <span class="n">rclcpp</span>
  <span class="n">rclcpp_action</span>
<span class="p">)</span>

<span class="n">add_executable</span><span class="p">(</span><span class="k">operator</span> <span class="n">src</span><span class="o">/</span><span class="n">arithmetic</span><span class="o">/</span><span class="k">operator</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="n">ament_target_dependencies</span><span class="p">(</span><span class="k">operator</span>
  <span class="n">msg_srv_action_interface_example</span>
  <span class="n">rclcpp</span>
<span class="p">)</span>

<span class="cp"># Install
</span><span class="n">install</span><span class="p">(</span><span class="n">TARGETS</span>
  <span class="n">argument</span>
  <span class="n">calculator</span>
  <span class="n">checker</span>
  <span class="k">operator</span>
  <span class="n">DESTINATION</span> <span class="n">lib</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span>
<span class="p">)</span>

<span class="cp"># 여기서 볼 수 있듯 launch 와 param은 share 폴더 아래에 저장해야 한다.
</span><span class="n">install</span><span class="p">(</span><span class="n">DIRECTORY</span> <span class="n">launch</span> <span class="n">param</span>
  <span class="n">DESTINATION</span> <span class="n">share</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span>
<span class="p">)</span>

<span class="cp"># Test
# test시 필요한 의존성 패키지들, 추후 test시 colcon test 를 통해 사용 가능
# ament_lint_auto_find_test_dependenices를 통해 cpplint라는 코드 스타일을 점검해주는 패키지를 사용
</span><span class="k">if</span><span class="p">(</span><span class="n">BUILD_TESTING</span><span class="p">)</span>
  <span class="n">find_package</span><span class="p">(</span><span class="n">ament_lint_auto</span> <span class="n">REQUIRED</span><span class="p">)</span>
  <span class="n">ament_lint_auto_find_test_dependencies</span><span class="p">()</span>
<span class="n">endif</span><span class="p">()</span>

<span class="cp"># Macro for ament package
# ament 패키지를 위한 매크로 함수를 적어주어야 함
</span><span class="n">ament_package</span><span class="p">()</span>
</pre></table></code></div></div><p> </p><p> </p><h3 id="코드-다운로드-및-빌드">코드 다운로드 및 빌드 <a href="#코드-다운로드-및-빌드" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">source ~/robot_ws/install/local_setup.bash</code>는 ~/.bashrc에 없으면 추가하고, 있으면 추가하지 않아도 된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd</span> ~/robot_ws/src
<span class="nv">$ </span>git clone https://github.com/robotpilot/ros2-seminar-examples.git
<span class="nv">$ </span><span class="nb">cd</span> ~/robot_ws <span class="o">&amp;&amp;</span> colcon build <span class="nt">--symlink-install</span>
Starting <span class="o">&gt;&gt;&gt;</span> msg_srv_action_interface_example
Starting <span class="o">&gt;&gt;&gt;</span> logging_rclpy_example
Finished <span class="o">&lt;&lt;&lt;</span> logging_rclpy_example <span class="o">[</span>1.26s]
Starting <span class="o">&gt;&gt;&gt;</span> my_first_ros_rclcpp_pkg
Finished <span class="o">&lt;&lt;&lt;</span> my_first_ros_rclcpp_pkg <span class="o">[</span>13.8s]
Starting <span class="o">&gt;&gt;&gt;</span> my_first_ros_rclpy_pkg
...

<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'source ~/robot_ws/install/local_setup.bash'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nv">$ </span><span class="nb">source</span> ~/.bashrc

<span class="nv">$ </span><span class="nb">.</span> ~/robot_ws/install/local_setup.bash
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">. ~/robot_ws/install/local_setup.bash</code> 를 하지 않으면 패키지를 찾지 못한다는 에러가 뜨니 주의하자.</p><p> </p><p>빌드가 끝나고, 문제가 없다면 <code class="language-plaintext highlighter-rouge">~/robot_ws/install/topic_service_action_rclcpp_example</code> 폴더 안에 우리가 작성한 ROS 인터페이스를 사용하기 위한 파일들이 저장될 것이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls</span> ~/robot_ws/install
COLCON_IGNORE             logging_rclpy_example             rqt_example          tf2_rclpy_example
local_setup.bash          msg_srv_action_interface_example  setup.bash           time_rclcpp_example
local_setup.ps1           my_first_ros_rclcpp_pkg           setup.ps1            time_rclpy_example
local_setup.sh            my_first_ros_rclpy_pkg            setup.sh             topic_service_action_rclcpp_example
_local_setup_util_ps1.py  rclcpp_tutorial                   setup.zsh            topic_service_action_rclpy_example
_local_setup_util_sh.py   rclpy_tutorial                    testbot_description
local_setup.zsh           ros2env                           tf2_rclcpp_example


<span class="nv">$ </span><span class="nb">ls</span> ~/robot_ws/install/topic_service_action_rclcpp_example/lib/topic_service_action_rclcpp_example/
argument    calculator  checker     operator

<span class="nv">$ </span><span class="nb">ls</span> ~/robot_ws/install/topic_service_action_rclcpp_example/share/topic_service_action_rclcpp_example/
cmake/            launch/           local_setup.sh    package.dsv       package.xml
environment/      local_setup.bash  local_setup.zsh   package.ps1       package.zsh
hook/             local_setup.dsv   package.bash      package.sh        param/
</pre></table></code></div></div><p>이와 같이 argument, operator, calculator, checker와 같은 실행 스크립트가 생성되었다. 그리고 share 폴더 안에는 launch폴더와 param 폴더가 생성되었고, 각 폴더 안에는 arithmetic.launch.py와 arithmetic_config.yaml가 위치한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls</span> ~/robot_ws/install/topic_service_action_rclcpp_example/share/topic_service_action_rclcpp_example/launch/
arithmetic.launch.py

<span class="nv">$ </span><span class="nb">ls</span> ~/robot_ws/install/topic_service_action_rclcpp_example/share/topic_service_action_rclcpp_example/param/
arithmetic_config.yaml
</pre></table></code></div></div><p> </p><p> </p><h3 id="간단한-노드-실행">간단한 노드 실행 <a href="#간단한-노드-실행" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>calculator 노드 실행</ul><p>이 노드는 토픽 서브스크라이버, 서비스 서버, 액션 서버 역할을 수행한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example calculator
<span class="o">[</span>INFO]: Run calculator
</pre></table></code></div></div><p>실행했지만, 아직 받는 토픽이나 서비스, 액션이 없으므로 동작이 되지 않는다.</p><p> </p><ul><li>argument 노드 실행</ul><p>이 노드는 토픽 퍼블리셔 역할을 한다. 이를 실행하면 퍼블리시하고 있는 argument a, argument b가 표시될 것이고, 이를 통해 calculator 노드에서는 argument a, argument b와 함께 수신 받은 시간 정보가 출력될 것이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example argument
<span class="o">[</span>INFO]: Published argument_a 4.73
<span class="o">[</span>INFO]: Published argument_b 7.43
<span class="o">[</span>INFO]: Published argument_a 1.55
<span class="o">[</span>INFO]: Published argument_b 6.38
<span class="o">[</span>INFO]: Published argument_a 7.09
<span class="o">[</span>INFO]: Published argument_b 5.89
<span class="o">[</span>INFO]: Published argument_a 5.90
<span class="o">[</span>INFO]: Published argument_b 8.21
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>ros2 run  topic_service_action_rclcpp_example calculator
<span class="o">[</span>INFO]: Run calculator
<span class="o">[</span>INFO]: Timestamp of the message: sec 1658859718 nanosec 500974826
<span class="o">[</span>INFO]: Subscribed argument a: 4.73
<span class="o">[</span>INFO]: Subscribed argument b: 7.43
<span class="o">[</span>INFO]: Timestamp of the message: sec 1658859719 nanosec 500985640
<span class="o">[</span>INFO]: Subscribed argument a: 1.55
<span class="o">[</span>INFO]: Subscribed argument b: 6.38
<span class="o">[</span>INFO]: Timestamp of the message: sec 1658859720 nanosec 501005719
<span class="o">[</span>INFO]: Subscribed argument a: 7.09
<span class="o">[</span>INFO]: Subscribed argument b: 5.89
<span class="o">[</span>INFO]: Timestamp of the message: sec 1658859721 nanosec 500910222
<span class="o">[</span>INFO]: Subscribed argument a: 5.90
<span class="o">[</span>INFO]: Subscribed argument b: 8.21
<span class="o">[</span>INFO]: Timestamp of the message: sec 1658859722 nanosec 501017918
<span class="o">[</span>INFO]: Subscribed argument a: 2.57
<span class="o">[</span>INFO]: Subscribed argument b: 8.50
<span class="o">[</span>INFO]: Timestamp of the message: sec 1658859723 nanosec 500904549
<span class="o">[</span>INFO]: Subscribed argument a: 4.43
<span class="o">[</span>INFO]: Subscribed argument b: 4.86
</pre></table></code></div></div><p> </p><ul><li>operator 노드 실행</ul><p>이 노드는 서비스 클라이언트 역할을 한다. calculator 노드에게 랜덤으로 선택한 연산자를 서비스 요청값으로 보내고, 연산된 결과값을 받아 터미널 창에 표시한다. 실제 계산식은 calculator 노드가 실행 중인 창에서 확인할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example operator
<span class="o">[</span>INFO]: Result 13.79
Press Enter <span class="k">for </span>next service call.
<span class="o">[</span>INFO]: Result 9.57
Press Enter <span class="k">for </span>next service call.
<span class="o">[</span>INFO]: Result 0.30
Press Enter <span class="k">for </span>next service call.
<span class="o">[</span>INFO]: Result 0.71
Press Enter <span class="k">for </span>next service call.
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example calculator
<span class="o">[</span>INFO]: 2.224688 + 7.350139 <span class="o">=</span> 9.57483
<span class="o">[</span>INFO]: 2.224688 / 7.350139 <span class="o">=</span> 0.302673

<span class="o">[</span>INFO]: Timestamp of the message: sec 1658859884 nanosec 500955814
<span class="o">[</span>INFO]: Subscribed argument a: 5.25
<span class="o">[</span>INFO]: Subscribed argument b: 7.38
<span class="o">[</span>INFO]: 5.247090 / 7.383574 <span class="o">=</span> 0.710644
<span class="o">[</span>INFO]: 5.247090 / 7.383574 <span class="o">=</span> 0.710644
</pre></table></code></div></div><p>Entor 키를 통해 서비스를 보낼 수 있다.</p><p> </p><ul><li>checker 노드 실행</ul><p>마지막으로 이 노드는 먼저 연산값의 합계 한계치를 액션 목표값으로 calculator 노드에 전달한다. 이후 checker 노드는 calculator 노드에게 액션 피드백을 받는데, 그 피드백은 각 연산과 그 결과의 string타입이다. 지정한 연산값의 합계가 목표 합계를 넘기면 checker 노드는 액션 결과값으로 calculator 노드로부터 최종 연산 합계를 전달받는다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example checker
goal_total_sum : 50
<span class="o">[</span>INFO]: Action goal accepted.
<span class="o">[</span>INFO]: Action feedback:
<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]: Action feedback:
<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]: Action feedback:
<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]: Action feedback:
<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example calculator
<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644

<span class="o">[</span>INFO]:         5.247090 / 7.383574 <span class="o">=</span> 0.710644
</pre></table></code></div></div><p>동일한 logging이 출력되는데, 이는 목표 합계를 넘겼을 때, calculator 노드가 checker 노드에게 최종 연산 합계를 전달하기 때문이다. 합계의 한계치는 기본으로 50으로 설정되어 있다. 이를 수정하고자 한다면 checker 노드를 실행시킬 때 실행 인자로 <code class="language-plaintext highlighter-rouge">-g 100</code> 이라 입력하면 GOAL_TOTAL_SUM 이라는 합계 한계치 인자가 100으로 할당된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 run topic_service_action_rclcpp_example checker <span class="nt">-g</span> 100
</pre></table></code></div></div><p> </p><ul><li>launch 파일 실행</ul><p>launch 파일을 통해 argument 노드와 calculator 노드를 한번에 실행시킬 수 있다. launch파일은 <code class="language-plaintext highlighter-rouge">arithmetic.launch.py</code> 파일이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 launch topic_service_action_rclcpp_example arithmetic.launch.py
</pre></table></code></div></div><p> </p><p> </p><h3 id="ros-토픽-뜯어보기">ROS 토픽 뜯어보기 <a href="#ros-토픽-뜯어보기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>이제는 위의 패키지에서 토픽에 대해 더 자세히 뜯어보고자 한다.</p><p> </p><p>토픽은 비동기식 단방향 메시지 송수신 방식으로 메시지를 발행하는 퍼블리셔와 메시지를 구독하는 서브스크라이버 간의 통신이다. 이는 1:1 통신을 기본으로 하지만, 1:N, N:1, N:N도 가능하다.</p><p>위에서 토픽은 argument 노드에서 calculator 노드로의 argument a, argument b, 토픽을 생성한 시간에 대한 메시지 전달이다.</p><p><img data-src="/assets/img/ros2/package/topic.png" data-proofer-ignore></p><p> </p><p>따라서 퍼블리셔와 서브스크라이버를 직접 작성해보고자 한다.</p><p>코드는 소스 파일과 헤더 파일이 존재하고, 각각 src 폴더와 include 폴더에 위치한다.</p><p>퍼블리셔</p><ul><li>topic_service_action_rclcpp_example/src/arithmetic/argument.cpp<li>topic_service_action_rclcpp_example/include/arithmetic/argument.hpp</ul><p> </p><p>서브스크라이버</p><ul><li>topic_service_action_rclcpp_example/src/arithmetic/argument.cpp<li>topic_service_action_rclcpp_example/include/arithmetic/argument.hpp</ul><p> </p><h4 id="퍼블리셔">퍼블리셔 <a href="#퍼블리셔" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>토픽 퍼블리셔 노드는 argument 노드이다.</p><ol><li>Node 설정<li>QoS 설정<li>create_publisher 설정 (timer 설정)<li>퍼블리시 함수 작성</ol><p> </p><ul><li>헤더 파일</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="cp">#ifndef ARITHMETIC__ARGUMENT_HPP_
#define ARITHMETIC__ARGUMENT_HPP_
</span>
<span class="c1">// 시간을 다루는 라이브러리</span>
<span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span>
<span class="c1">// 동적 메모리를 다루는 라이브러리</span>
<span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// 문자열을 다루는 라이브러리</span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span>
<span class="c1">// 서로다른 도메인을 다루는 라이브러리</span>
<span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp">
</span>
<span class="c1">// rclcpp API를 담고 있는 rclcpp 헤더파일</span>
<span class="cp">#include</span> <span class="cpf">"rclcpp/rclcpp.hpp"</span><span class="cp">
</span>
<span class="c1">// 만든 인터페이스를 담고 있는 헤더파일</span>
<span class="cp">#include</span> <span class="cpf">"msg_srv_action_interface_example/msg/arithmetic_argument.hpp"</span><span class="cp">
</span>
<span class="c1">// rclcpp의 Node 클래스를 상속받는 Argument 클래스</span>
<span class="k">class</span> <span class="nc">Argument</span> <span class="o">:</span> <span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
<span class="p">{</span>
<span class="nl">public:</span>
  <span class="k">using</span> <span class="n">ArithmeticArgument</span> <span class="o">=</span> <span class="n">msg_srv_action_interface_example</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ArithmeticArgument</span><span class="p">;</span>

  <span class="c1">// Argument 클래스의 생성자는 rclcpp의 NodeOptions를 인자로 받는다. NodeOptions에는 context, arguments, intra process communication, parameter, allocator와 같은 Node 생성을 위한 다양한 옵션이 존재</span>
  <span class="k">explicit</span> <span class="n">Argument</span><span class="p">(</span><span class="k">const</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">NodeOptions</span> <span class="o">&amp;</span> <span class="n">node_options</span> <span class="o">=</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">NodeOptions</span><span class="p">());</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Argument</span><span class="p">();</span>

<span class="nl">private:</span>
  <span class="kt">void</span> <span class="n">publish_random_arithmetic_arguments</span><span class="p">();</span>
  <span class="kt">void</span> <span class="n">update_parameter</span><span class="p">();</span>

  <span class="c1">// 토픽 메시지에 담을 랜덤 변수의 범위</span>
  <span class="kt">float</span> <span class="n">min_random_num_</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">max_random_num_</span><span class="p">;</span>

  <span class="c1">// publisher와 timerbase 멤버변수가 선언되어 있다.</span>
  <span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">ArithmeticArgument</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">arithmetic_argument_publisher_</span><span class="p">;</span>
  <span class="n">rclcpp</span><span class="o">::</span><span class="n">TimerBase</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">timer_</span><span class="p">;</span>
  <span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ParameterEvent</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">parameter_event_sub_</span><span class="p">;</span>
  <span class="n">rclcpp</span><span class="o">::</span><span class="n">AsyncParametersClient</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">parameters_client_</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif  // ARITHMETIC__ARGUMENT_HPP_
</span></pre></table></code></div></div><p> </p><ul><li>소스 파일</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
</pre><td class="rouge-code"><pre><span class="c1">// C언어 표준 인풋 아웃풋 라이브러리</span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp">
</span>
<span class="c1">// 랜덤 숫자 생성 라이브러리</span>
<span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">"rclcpp/rclcpp.hpp"</span><span class="cp">
</span>
<span class="c1">/// 프로그램 실행시 넘겨받은 인자를 다루는 ROS2 라이브러리</span>
<span class="cp">#include</span> <span class="cpf">"rcutils/cmdline_parser.h"</span><span class="cp">
</span>
<span class="c1">// 위에서 생성한 argument 헤더 파일</span>
<span class="cp">#include</span> <span class="cpf">"arithmetic/argument.hpp"</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono_literals</span><span class="p">;</span>

<span class="c1">// Argument 클래스, 부모 클래스인 rclcpp:Node를 선언해주었는데, 첫번째 인자에는 노드 이름을, 두번째 인자에는 노드 옵션 변수를 명시한다.</span>
<span class="n">Argument</span><span class="o">::</span><span class="n">Argument</span><span class="p">(</span><span class="k">const</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">NodeOptions</span> <span class="o">&amp;</span> <span class="n">node_options</span><span class="p">)</span>
<span class="o">:</span> <span class="n">Node</span><span class="p">(</span><span class="s">"argument"</span><span class="p">,</span> <span class="n">node_options</span><span class="p">),</span>
  <span class="n">min_random_num_</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
  <span class="n">max_random_num_</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// QoS는 QoS 라이브러리를 이용하여 depth를 10으로 한다. </span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s">"qos_depth"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kt">int8_t</span> <span class="n">qos_depth</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">"qos_depth"</span><span class="p">).</span><span class="n">get_value</span><span class="o">&lt;</span><span class="kt">int8_t</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="c1">// 랜덤값 중 최소값로 0설정</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s">"min_random_num"</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
  <span class="n">min_random_num_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">"min_random_num"</span><span class="p">).</span><span class="n">get_value</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="c1">// 랜덤값 중 최대값로 9설정</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s">"max_random_num"</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">);</span>
  <span class="n">max_random_num_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">"max_random_num"</span><span class="p">).</span><span class="n">get_value</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="k">this</span><span class="o">-&gt;</span><span class="n">update_parameter</span><span class="p">();</span>

  <span class="cm">/*
  - History 옵션: KeepLast(depth : 10)
  - Reliability 옵션: reliable
  - Durability 옵션: volatile
  */</span>
  <span class="k">const</span> <span class="k">auto</span> <span class="n">QOS_RKL10V</span> <span class="o">=</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">QoS</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">KeepLast</span><span class="p">(</span><span class="n">qos_depth</span><span class="p">)).</span><span class="n">reliable</span><span class="p">().</span><span class="n">durability_volatile</span><span class="p">();</span>

  <span class="c1">// QoS는 publisher를 초기화할 때 두번째 인자로 들어가고, 첫번째 인자는 메시지 통신에 사용될 토픽명</span>
  <span class="n">arithmetic_argument_publisher_</span> <span class="o">=</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">ArithmeticArgument</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"arithmetic_argument"</span><span class="p">,</span> <span class="n">QOS_RKL10V</span><span class="p">);</span>

  <span class="c1">// 1초당 1번씩 publisher_random_arithmetic_arguments 멤버함수가 호출하도록 설정</span>
  <span class="n">timer_</span> <span class="o">=</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="mx">1s</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Argument</span><span class="o">::</span><span class="n">publish_random_arithmetic_arguments</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">Argument</span><span class="o">::~</span><span class="n">Argument</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="c1">// timer에 의해 1초당 1번씩 호출</span>
<span class="kt">void</span> <span class="n">Argument</span><span class="o">::</span><span class="n">publish_random_arithmetic_arguments</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">random_device</span> <span class="n">rd</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">mt19937</span> <span class="n">gen</span><span class="p">(</span><span class="n">rd</span><span class="p">());</span>

  <span class="c1">// ROS2 파라미터를 통해 얻은 숫자가 min(0) 과 max(9) 사이의 랜덤한 값으로 숫자를 생성</span>
  <span class="n">std</span><span class="o">::</span><span class="n">uniform_real_distribution</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">distribution</span><span class="p">(</span><span class="n">min_random_num_</span><span class="p">,</span> <span class="n">max_random_num_</span><span class="p">);</span>

  <span class="c1">// msg_srv_action_interface_example 패키지에 있는 msg 인터페이스를 선언</span>
  <span class="n">msg_srv_action_interface_example</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ArithmeticArgument</span> <span class="n">msg</span><span class="p">;</span>

  <span class="c1">// time-stamp</span>
  <span class="n">msg</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">();</span>

  <span class="c1">// argument a</span>
  <span class="n">msg</span><span class="p">.</span><span class="n">argument_a</span> <span class="o">=</span> <span class="n">distribution</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span>

  <span class="c1">// argument b</span>
  <span class="n">msg</span><span class="p">.</span><span class="n">argument_b</span> <span class="o">=</span> <span class="n">distribution</span><span class="p">(</span><span class="n">gen</span><span class="p">);</span>

  <span class="c1">// 토픽 발행</span>
  <span class="n">arithmetic_argument_publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>

  <span class="c1">// logging</span>
  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Published argument_a %.2f"</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">argument_a</span><span class="p">);</span>
  <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Published argument_b %.2f"</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">argument_b</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">Argument</span><span class="o">::</span><span class="n">update_parameter</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">parameters_client_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">AsyncParametersClient</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">parameters_client_</span><span class="o">-&gt;</span><span class="n">wait_for_service</span><span class="p">(</span><span class="mx">1s</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Interrupted while waiting for the service. Exiting."</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"service not available, waiting again..."</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">auto</span> <span class="n">param_event_callback</span> <span class="o">=</span>
    <span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">const</span> <span class="n">rcl_interfaces</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">ParameterEvent</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span>
    <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span> <span class="n">changed_parameter</span> <span class="o">:</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">changed_parameters</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">changed_parameter</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"min_random_num"</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Parameter</span><span class="o">::</span><span class="n">from_parameter_msg</span><span class="p">(</span><span class="n">changed_parameter</span><span class="p">).</span><span class="n">as_double</span><span class="p">();</span>
          <span class="n">min_random_num_</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">changed_parameter</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"max_random_num"</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Parameter</span><span class="o">::</span><span class="n">from_parameter_msg</span><span class="p">(</span><span class="n">changed_parameter</span><span class="p">).</span><span class="n">as_double</span><span class="p">();</span>
          <span class="n">max_random_num_</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>

  <span class="n">parameter_event_sub_</span> <span class="o">=</span> <span class="n">parameters_client_</span><span class="o">-&gt;</span><span class="n">on_parameter_event</span><span class="p">(</span><span class="n">param_event_callback</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// help</span>
<span class="kt">void</span> <span class="nf">print_help</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"For argument node:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"node_name [-h]</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Options:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">-h Help           : Print this help function.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="c1">// cmdline_parser 라이브러리 함수를 사용하여, 만약 명령 인자에 -h 가 있을 경우 print_help 함수를 호출하고 종료</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rcutils_cli_option_exist</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="n">argv</span> <span class="o">+</span> <span class="n">argc</span><span class="p">,</span> <span class="s">"-h"</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">print_help</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 초기화</span>
  <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  
  <span class="c1">// Argument 클래스를 인스턴스화</span>
  <span class="k">auto</span> <span class="n">argument</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Argument</span><span class="o">&gt;</span><span class="p">();</span>
  
  <span class="c1">// publish_random_arithmetic_arguments 실행</span>
  <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">argument</span><span class="p">);</span>
  
  <span class="c1">// ctrl+c와 같은 시그널을 통해 노드 종료를 종료</span>
  <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>파라미터와 관련된 부분은 추후 다루도록 한다.</p><p> </p><h4 id="서브스크라이버">서브스크라이버 <a href="#서브스크라이버" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>토픽 서브스크라이버 노드는 calculator 노드이다. calculator의 소스 코드는 토픽 서브스크라이버, 서비스 서버, 액션 서버를 모두 포함하고 있어서 매우 길어서 토픽 서브스크라이버와 관련된 부분만 살펴보도록 한다.</p><p>calculator 클래스는 토픽 퍼블리셔 노드와 마찬가지로 rclcpp::node를 상속하고, 생성자에서 calculator라는 노드 이름으로 초기화된다. 그리고 위에서와 동일하게 QoS를 생성한다.</p><p>서브스크라이버는 <code class="language-plaintext highlighter-rouge">create_subscription</code>을 통해 초기화되고, 해당 함수는 토픽명과 QoS, 콜백함수를 인자로 받는다. 첫번째, 두번째 인자는 Argument 클래스와 동일하게 넣고, 콜백함수는 std::bind가 아닌 <strong>람다 표현식</strong>을 사용했다. 콜백함수를 보면 인자를 통해 수신받은 메시지에 접근하여 멤버 변수에 저장한다.</p><p> </p><ol><li>Node 설정<li>QoS 설정<li>create_subscription 설정<li>서브스크라이브 함수 작성</ol><p> </p><ul><li>소스파일</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>  <span class="c1">// QoS 설정 - history : KeepLast, Reliability : reliable, Durability : volatile</span>
  <span class="k">const</span> <span class="k">auto</span> <span class="n">QOS_RKL10V</span> <span class="o">=</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">QoS</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">KeepLast</span><span class="p">(</span><span class="n">qos_depth</span><span class="p">)).</span><span class="n">reliable</span><span class="p">().</span><span class="n">durability_volatile</span><span class="p">();</span>
  
  <span class="c1">// 서브스크라이버 초기화, [토픽명, QoS]</span>
  <span class="n">arithmetic_argument_subscriber_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">ArithmeticArgument</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="s">"arithmetic_argument"</span><span class="p">,</span>
    <span class="n">QOS_RKL10V</span><span class="p">,</span>
    <span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">const</span> <span class="n">ArithmeticArgument</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span>
    <span class="p">{</span>
      <span class="n">argument_a_</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">argument_a</span><span class="p">;</span>
      <span class="n">argument_b_</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">argument_b</span><span class="p">;</span>
      
      <span class="c1">// logging - timestamp</span>
      <span class="n">RCLCPP_INFO</span><span class="p">(</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span>
        <span class="s">"Subscribed at: sec %ld nanosec %ld"</span><span class="p">,</span>
        <span class="n">msg</span><span class="o">-&gt;</span><span class="n">stamp</span><span class="p">.</span><span class="n">sec</span><span class="p">,</span>
        <span class="n">msg</span><span class="o">-&gt;</span><span class="n">stamp</span><span class="p">.</span><span class="n">nanosec</span><span class="p">);</span>
      
      <span class="c1">// logging - argument a, argument b</span>
      <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Subscribed argument a : %.2f"</span><span class="p">,</span> <span class="n">argument_a_</span><span class="p">);</span>
      <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Subscribed argument b : %.2f"</span><span class="p">,</span> <span class="n">argument_b_</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>
</pre></table></code></div></div><p> </p><p> </p><h4 id="실행">실행 <a href="#실행" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>실행하기 전에 CMakeLists.txt를 확인해서 add_executable 태그에 알맞게 들어가있는지 확인한다.</p><pre><code class="language-txt">add_executable(argument src/arithmetic/argument.cpp)
add_executable(calculator src/calculator/main.cpp src/calculator/calculator.cpp)
</code></pre><p>첫번째 인자는 실행명, 그 다음 인자부터는 실행할 소스파일이다.</p><p> </p><p>실행은 <code class="language-plaintext highlighter-rouge">run</code>과 <code class="language-plaintext highlighter-rouge">launch</code> 두가지 방식이 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example calculator
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclcpp_example argument
</pre></table></code></div></div><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 launch topic_service_action_rclcpp_example arithmetic.launch.py
</pre></table></code></div></div><p> </p><p>두 방법 모두 동작하는 것은 동일하다.</p><p> </p><p> </p><p> </p><h2 id="ros2-python-패키지-제작">ROS2 python 패키지 제작 <a href="#ros2-python-패키지-제작" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://cafe.naver.com/openrt/24637">028 ROS2 패키지 설계 (python)</a><li><a href="https://cafe.naver.com/openrt/24644">029 토픽 프로그래밍 (python)</a></ul><h3 id="ros2-패키지-설정-1">ROS2 패키지 설정 <a href="#ros2-패키지-설정-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>package.xml (패키지 설정 파일)</ul><p>topic_service_action_rclpy_example 패키지의 설정 파일은 다음과 같다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">format=</span><span class="s">"3"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;name&gt;</span>topic_service_action_rclpy_example<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;description&gt;</span>ROS 2 rclpy example package for the topic, service, action<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;maintainer</span> <span class="na">email=</span><span class="s">"jhyoon@gmail.com"</span><span class="nt">&gt;</span>Pyo<span class="nt">&lt;/maintainer&gt;</span>
  <span class="nt">&lt;license&gt;</span>Apache License 2.0<span class="nt">&lt;/license&gt;</span>
  <span class="nt">&lt;author</span> <span class="na">email=</span><span class="s">"passionvirus@gmail.com"</span><span class="nt">&gt;</span>Pyo<span class="nt">&lt;/author&gt;</span>
  <span class="nt">&lt;author</span> <span class="na">email=</span><span class="s">"routiful@gmail.com"</span><span class="nt">&gt;</span>Darby Lim<span class="nt">&lt;/author&gt;</span>

  <span class="c">&lt;!-- ros2에서 사용되는 python툴 --&gt;</span>
  <span class="nt">&lt;depend&gt;</span>rclpy<span class="nt">&lt;/depend&gt;</span>
  <span class="nt">&lt;depend&gt;</span>std_msgs<span class="nt">&lt;/depend&gt;</span>
  <span class="c">&lt;!-- 토픽, 서비스, 액션 인터페이스를 사용하기 위한 의존성 패키지 --&gt;</span>
  <span class="nt">&lt;depend&gt;</span>msg_srv_action_interface_example<span class="nt">&lt;/depend&gt;</span>

  <span class="nt">&lt;test_depend&gt;</span>ament_copyright<span class="nt">&lt;/test_depend&gt;</span>

  <span class="c">&lt;!-- python과 연동시키기 간편한 flake를 사용하기 위한 test 툴 --&gt;</span>
  <span class="nt">&lt;test_depend&gt;</span>ament_flake8<span class="nt">&lt;/test_depend&gt;</span>
  <span class="nt">&lt;test_depend&gt;</span>ament_pep257<span class="nt">&lt;/test_depend&gt;</span>

  <span class="c">&lt;!-- python에 사용될 test툴 --&gt;</span>
  <span class="nt">&lt;test_depend&gt;</span>python3-pytest<span class="nt">&lt;/test_depend&gt;</span>
  <span class="nt">&lt;export&gt;</span>
    <span class="nt">&lt;build_type&gt;</span>ament_python<span class="nt">&lt;/build_type&gt;</span>
  <span class="nt">&lt;/export&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</pre></table></code></div></div><p> </p><ul><li>setup.py (파이썬 패키지 설정 파일)</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="kn">from</span> <span class="n">setuptools</span> <span class="kn">import</span> <span class="n">find_packages</span>
<span class="kn">from</span> <span class="n">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">package_name</span> <span class="o">=</span> <span class="s">'topic_service_action_rclpy_example'</span>
<span class="n">share_dir</span> <span class="o">=</span> <span class="s">'share/'</span> <span class="o">+</span> <span class="n">package_name</span>

<span class="nf">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s">'0.2.0'</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="nf">find_packages</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s">'test'</span><span class="p">]),</span>
    <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s">'share/ament_index/resource_index/packages'</span><span class="p">,</span> <span class="p">[</span><span class="s">'resource/'</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">share_dir</span><span class="p">,</span> <span class="p">[</span><span class="s">'package.xml'</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">share_dir</span> <span class="o">+</span> <span class="s">'/launch'</span><span class="p">,</span> <span class="n">glob</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s">'launch'</span><span class="p">,</span> <span class="s">'*.launch.py'</span><span class="p">))),</span>
        <span class="p">(</span><span class="n">share_dir</span> <span class="o">+</span> <span class="s">'/param'</span><span class="p">,</span> <span class="n">glob</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s">'param'</span><span class="p">,</span> <span class="s">'*.yaml'</span><span class="p">))),</span>
    <span class="p">],</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s">'setuptools'</span><span class="p">],</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s">'Pyo, Darby Lim'</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s">'passionvirus@gmail.com, routiful@gmail.com'</span><span class="p">,</span>
    <span class="n">maintainer</span><span class="o">=</span><span class="s">'Pyo'</span><span class="p">,</span>
    <span class="n">maintainer_email</span><span class="o">=</span><span class="s">'passionvirus@gmail.com'</span><span class="p">,</span>
    <span class="n">keywords</span><span class="o">=</span><span class="p">[</span><span class="s">'ROS'</span><span class="p">],</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s">'Intended Audience :: Developers'</span><span class="p">,</span>
        <span class="s">'License :: OSI Approved :: Apache Software License'</span><span class="p">,</span>
        <span class="s">'Programming Language :: Python'</span><span class="p">,</span>
        <span class="s">'Topic :: Software Development'</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">description</span><span class="o">=</span><span class="s">'ROS 2 rclpy example package for the topic, service, action'</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s">'Apache License, Version 2.0'</span><span class="p">,</span>
    <span class="n">tests_require</span><span class="o">=</span><span class="p">[</span><span class="s">'pytest'</span><span class="p">],</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'console_scripts'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">'argument = topic_service_action_rclpy_example.arithmetic.argument:main'</span><span class="p">,</span>
            <span class="s">'operator = topic_service_action_rclpy_example.arithmetic.operator:main'</span><span class="p">,</span>
            <span class="s">'calculator = topic_service_action_rclpy_example.calculator.main:main'</span><span class="p">,</span>
            <span class="s">'checker = topic_service_action_rclpy_example.checker.main:main'</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></table></code></div></div><p>살펴볼 부분은 <strong>data_files</strong>와 <strong>entry_points</strong> 이다.</p><p>data_files</p><ul><li>이 패키지에서 사용되는 파일들을 기입하여 함께 배포한다. 주로 resource 폴더 내에 있는 ament_index를 위한 패키지의 이름의 빈 파일이나, package.xml, .launch.py, .yaml 등을 기입한다. 이를 통해 빌드 후 해당 파일들이 설치 폴더에 추가된다.<li>이 패키지에서는 <code class="language-plaintext highlighter-rouge">arithmetic.launch.py</code> 런치 파일과 <code class="language-plaintext highlighter-rouge">arithmetic_config.yaml</code> 파라미터 파일이 사용되므로 아래와 같이 해당 파일들의 설정을 추가한다.</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s">'share/ament_index/resource_index/packages'</span><span class="p">,</span> <span class="p">[</span><span class="s">'resource/'</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">share_dir</span><span class="p">,</span> <span class="p">[</span><span class="s">'package.xml'</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">share_dir</span> <span class="o">+</span> <span class="s">'/launch'</span><span class="p">,</span> <span class="n">glob</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s">'launch'</span><span class="p">,</span> <span class="s">'*.launch.py'</span><span class="p">))),</span>
        <span class="p">(</span><span class="n">share_dir</span> <span class="o">+</span> <span class="s">'/param'</span><span class="p">,</span> <span class="n">glob</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s">'param'</span><span class="p">,</span> <span class="s">'*.yaml'</span><span class="p">))),</span>
    <span class="p">],</span>
</pre></table></code></div></div><p> </p><p>entry_points</p><ul><li>entry_points는 설치하여 사용할 실행 가능한 콘솔 스크립트 이름과 호출 함수를 기입한다.<li><code class="language-plaintext highlighter-rouge">ros2 run</code>과 같은 노드 실행 명령어를 통해 각 노드를 실행할 것이므로 <strong>entry_points</strong>에 추가한다.</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'console_scripts'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">'argument = topic_service_action_rclpy_example.arithmetic.argument:main'</span><span class="p">,</span>
            <span class="s">'operator = topic_service_action_rclpy_example.arithmetic.operator:main'</span><span class="p">,</span>
            <span class="s">'calculator = topic_service_action_rclpy_example.calculator.main:main'</span><span class="p">,</span>
            <span class="s">'checker = topic_service_action_rclpy_example.checker.main:main'</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
</pre></table></code></div></div><p> </p><p> </p><h3 id="코드-다운로드-및-빌드-1">코드 다운로드 및 빌드 <a href="#코드-다운로드-및-빌드-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>위의 git 클론을 하게 되면, rclcpp 뿐만 아니라 rclpy 패키지도 함께 들어있다.</p><p><code class="language-plaintext highlighter-rouge">~/robot_ws/install/topic_service_action_rclpy_example</code> 폴더가 존재하는지 확인한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>~/robot_ws/install<span class="nv">$ </span><span class="nb">ls
</span>COLCON_IGNORE             logging_rclpy_example             rqt_example          tf2_rclpy_example
local_setup.bash          msg_srv_action_interface_example  setup.bash           time_rclcpp_example
local_setup.ps1           my_first_ros_rclcpp_pkg           setup.ps1            time_rclpy_example
local_setup.sh            my_first_ros_rclpy_pkg            setup.sh             topic_service_action_rclcpp_example
_local_setup_util_ps1.py  rclcpp_tutorial                   setup.zsh            topic_service_action_rclpy_example
_local_setup_util_sh.py   rclpy_tutorial                    testbot_description
local_setup.zsh           ros2env                           tf2_rclcpp_example
</pre></table></code></div></div><p> </p><h3 id="간단한-노드-실행-1">간단한 노드 실행 <a href="#간단한-노드-실행-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>calculator 노드 실행</ul><p>아직 주고 받는 토픽, 서비스, 액션이 없으니 대기 상태이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclpy_example calculator
</pre></table></code></div></div><p> </p><ul><li>argument 노드 실행</ul><p>토픽 퍼블리셔 역할을 하는 노드이다. 실행하고 나면 퍼블리시하고 있는 argument a, argument b가 표시된다. 그리고, calculator 노드를 실행시킨 터미널에서도 토픽을 수신받은 시간에 대한 정보와 argument a, argument b가 표시된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclpy_example argument
<span class="o">[</span>INFO]: Published argument a: 4.0
<span class="o">[</span>INFO]: Published argument b: 5.0
<span class="o">[</span>INFO]: Published argument a: 1.0
<span class="o">[</span>INFO]: Published argument b: 9.0
<span class="o">[</span>INFO]: Published argument a: 0.0
...
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclpy_example calculator
<span class="o">[</span>INFO]: Timestamp of the message: builtin_interfaces.msg.Time<span class="o">(</span><span class="nv">sec</span><span class="o">=</span>1659430104, <span class="nv">nanosec</span><span class="o">=</span>525228141<span class="o">)</span>
<span class="o">[</span>INFO]: Subscribed argument a: 4.0
<span class="o">[</span>INFO]: Subscribed argument b: 5.0
<span class="o">[</span>INFO]: Timestamp of the message: builtin_interfaces.msg.Time<span class="o">(</span><span class="nv">sec</span><span class="o">=</span>1659430105, <span class="nv">nanosec</span><span class="o">=</span>525153321<span class="o">)</span>
<span class="o">[</span>INFO]: Subscribed argument a: 1.0
<span class="o">[</span>INFO]: Subscribed argument b: 9.0
<span class="o">[</span>INFO]: Timestamp of the message: builtin_interfaces.msg.Time<span class="o">(</span><span class="nv">sec</span><span class="o">=</span>1659430106, <span class="nv">nanosec</span><span class="o">=</span>525057834<span class="o">)</span>
<span class="o">[</span>INFO]: Subscribed argument a: 0.0
<span class="o">[</span>INFO]: Subscribed argument b: 1.0
...
</pre></table></code></div></div><p> </p><ul><li>operator 노드 실행</ul><p>서비스 클라이언트 역할을 하는 노드를 실행해보자. 그러면 calculator 노드에게 랜덤으로 선택한 연산자를 서비스 요청값으로 보내고, 연산된 결과값을 반환받아 터미널에 표시한다. 실제 계산식은 calculator 노드가 실행 중인 창에서 확인할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclpy_example operator
<span class="o">[</span>INFO]: Result: 3.0
Press Enter <span class="k">for </span>next service call.
<span class="o">[</span>INFO]: Result: 14.0
Press Enter <span class="k">for </span>next service call.
<span class="o">[</span>INFO]: Result: 0.6666666865348816
Press Enter <span class="k">for </span>next service call.
...
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclpy_example calculator
<span class="o">[</span>INFO]: Timestamp of the message: builtin_interfaces.msg.Time<span class="o">(</span><span class="nv">sec</span><span class="o">=</span>1659430234, <span class="nv">nanosec</span><span class="o">=</span>525041106<span class="o">)</span>
<span class="o">[</span>INFO]: Subscribed argument a: 6.0
<span class="o">[</span>INFO]: Subscribed argument b: 2.0
<span class="o">[</span>INFO]: 6.0 / 2.0 <span class="o">=</span> 3.0
<span class="o">[</span>INFO]: Timestamp of the message: builtin_interfaces.msg.Time<span class="o">(</span><span class="nv">sec</span><span class="o">=</span>1659430238, <span class="nv">nanosec</span><span class="o">=</span>525190661<span class="o">)</span>
<span class="o">[</span>INFO]: Subscribed argument a: 2.0
<span class="o">[</span>INFO]: Subscribed argument b: 7.0
<span class="o">[</span>INFO]: 2.0 <span class="k">*</span> 7.0 <span class="o">=</span> 14.0
<span class="o">[</span>INFO]: Timestamp of the message: builtin_interfaces.msg.Time<span class="o">(</span><span class="nv">sec</span><span class="o">=</span>1659430240, <span class="nv">nanosec</span><span class="o">=</span>525128381<span class="o">)</span>
<span class="o">[</span>INFO]: Subscribed argument a: 2.0
<span class="o">[</span>INFO]: Subscribed argument b: 3.0
<span class="o">[</span>INFO]: 2.0 / 3.0 <span class="o">=</span> 0.6666666666666666
</pre></table></code></div></div><p> </p><ul><li>checker 노드 실행</ul><p>마지막으로 checker 노드는 연산값의 합계의 한계치를 액션 목표값으로 전달하고, calculator 노드는 이를 받은 후부터의 연산값을 합하여 액션 피드백으로 각 연산 계산식을 보낸다. 지정한 목표 합계를 넘기면 액션 결과값으로 최종 연산 합계를 보낸다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run topic_service_action_rclpy_example checker
<span class="o">[</span>INFO]: Action goal accepted.
<span class="o">[</span>INFO]: Action feedback: <span class="o">[</span><span class="s1">'9.0 + 8.0 = 17.0'</span><span class="o">]</span>
<span class="o">[</span>INFO]: Action feedback: <span class="o">[</span><span class="s1">'9.0 + 8.0 = 17.0'</span>, <span class="s1">'9.0 + 8.0 = 17.0'</span><span class="o">]</span>
<span class="o">[</span>INFO]: Action feedback: <span class="o">[</span><span class="s1">'9.0 + 8.0 = 17.0'</span>, <span class="s1">'9.0 + 8.0 = 17.0'</span>, <span class="s1">'9.0 + 8.0 = 17.0'</span><span class="o">]</span>
<span class="o">[</span>INFO]: Action succeeded!
<span class="o">[</span>INFO]: Action result<span class="o">(</span>all formula<span class="o">)</span>: <span class="o">[</span><span class="s1">'9.0 + 8.0 = 17.0'</span>, <span class="s1">'9.0 + 8.0 = 17.0'</span>, <span class="s1">'9.0 + 8.0 = 17.0'</span><span class="o">]</span>
<span class="o">[</span>INFO]: Action result<span class="o">(</span>total <span class="nb">sum</span><span class="o">)</span>: 51.0
</pre></table></code></div></div><p>합계 한계치는 기본적으로 50으로 지정되어 있고, 이를 수정하려면 checker 노드 실행할 때 <code class="language-plaintext highlighter-rouge">-g</code> 인자를 통해 직접 할당할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 run topic_service_action_rclpy_example checker <span class="nt">-g</span> 100
</pre></table></code></div></div><p> </p><ul><li>launch 파일 실행</ul><p>argument 노드와 calculator 노드를 한번에 실행시키고자 한다면 launch파일을 실행하면 된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 launch topic_service_action_rclpy_example arithmetic.launch.py
</pre></table></code></div></div><p> </p><p> </p><h3 id="ros2-토픽-뜯어보기">ROS2 토픽 뜯어보기 <a href="#ros2-토픽-뜯어보기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>동일하게 토픽에 대해 자세하게 뜯어볼 것이다.</p><p>퍼블리셔</p><ul><li>topic_service_action_rclpy_example/topic_service/action_rclpy_example/arithmetic/argument.py</ul><p> </p><p>서브스크라이버</p><ul><li>topic_service_action_rclpy_example/topic_service/action_rclpy_example/calculator/calculator.py</ul><p> </p><h4 id="퍼블리셔-1">퍼블리셔 <a href="#퍼블리셔-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>토픽 퍼블리셔 역할을 하는 <strong>argument</strong> 노드이다.</p><ol><li>Node 설정<li>QoS 설정<li>create_publisher 설정<li>퍼블리시 함수 작성</ol><p> </p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">random</span>

<span class="kn">from</span> <span class="n">msg_srv_action_interface_example.msg</span> <span class="kn">import</span> <span class="n">ArithmeticArgument</span>
<span class="kn">from</span> <span class="n">rcl_interfaces.msg</span> <span class="kn">import</span> <span class="n">SetParametersResult</span>

<span class="c1"># ros2에서 사용하는 python 모듈
</span><span class="kn">import</span> <span class="n">rclpy</span>

<span class="c1"># 노드
</span><span class="kn">from</span> <span class="n">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="c1"># 파라미터
</span><span class="kn">from</span> <span class="n">rclpy.parameter</span> <span class="kn">import</span> <span class="n">Parameter</span>

<span class="c1"># QoS 패키지
</span><span class="kn">from</span> <span class="n">rclpy.qos</span> <span class="kn">import</span> <span class="n">QoSDurabilityPolicy</span>
<span class="kn">from</span> <span class="n">rclpy.qos</span> <span class="kn">import</span> <span class="n">QoSHistoryPolicy</span>
<span class="kn">from</span> <span class="n">rclpy.qos</span> <span class="kn">import</span> <span class="n">QoSProfile</span>
<span class="kn">from</span> <span class="n">rclpy.qos</span> <span class="kn">import</span> <span class="n">QoSReliabilityPolicy</span>

<span class="c1"># rclpy.node 모듈의 Node 클래스를 상속한다.
</span><span class="k">class</span> <span class="nc">Argument</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># 생성자 - argument 노드 이름으로 초기화
</span>        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="s">'argument'</span><span class="p">)</span>

        <span class="c1"># 파라미터 설정
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">declare_parameter</span><span class="p">(</span><span class="s">'qos_depth'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">qos_depth</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_parameter</span><span class="p">(</span><span class="s">'qos_depth'</span><span class="p">).</span><span class="n">value</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">declare_parameter</span><span class="p">(</span><span class="s">'min_random_num'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_random_num</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_parameter</span><span class="p">(</span><span class="s">'min_random_num'</span><span class="p">).</span><span class="n">value</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">declare_parameter</span><span class="p">(</span><span class="s">'max_random_num'</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_random_num</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_parameter</span><span class="p">(</span><span class="s">'max_random_num'</span><span class="p">).</span><span class="n">value</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">add_on_set_parameters_callback</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">update_parameter</span><span class="p">)</span>

        <span class="c1"># QoS 설정
</span>        <span class="c1">### RELIABLE : 데이터 수신에 집중, 유실 시 재전송 &lt;-&gt; BEST_EFFORT : 데이터 송신에 집중, 전송 속도 중시
</span>        <span class="c1">### KEEP_LAST : 정해진 메시지 큐 사이즈(depth)만큼 데이터를 보관 &lt;-&gt; KEEP_ALL : 모든 데이터를 보관
</span>        <span class="c1">### VOLATILE : 서브스크라이버 생성되기 전의 데이터는 삭제 &lt;-&gt; TRANSIENT_LOCAL : 서브스크라이버 생성되기 전의 데이터도 보관
</span>        <span class="n">QOS_RKL10V</span> <span class="o">=</span> <span class="nc">QoSProfile</span><span class="p">(</span>
            <span class="n">reliability</span><span class="o">=</span><span class="n">QoSReliabilityPolicy</span><span class="p">.</span><span class="n">RELIABLE</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">QoSHistoryPolicy</span><span class="p">.</span><span class="n">KEEP_LAST</span><span class="p">,</span>
            <span class="n">depth</span><span class="o">=</span><span class="n">qos_depth</span><span class="p">,</span>
            <span class="n">durability</span><span class="o">=</span><span class="n">QoSDurabilityPolicy</span><span class="p">.</span><span class="n">VOLATILE</span><span class="p">)</span>

        <span class="c1"># 퍼블리셔 선언, (토픽 타입, 이름, QoS 설정)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">arithmetic_argument_publisher</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_publisher</span><span class="p">(</span>
            <span class="n">ArithmeticArgument</span><span class="p">,</span>
            <span class="s">'arithmetic_argument'</span><span class="p">,</span>
            <span class="n">QOS_RKL10V</span><span class="p">)</span>

        <span class="c1"># 함수 실행 주기, 1초에 1번 실행하도록 설정
</span>        <span class="c1"># 이전 설정은 모두 퍼블리시를 위한 설정이고, publish_random_arithmetic_argments가 실제 토픽 발행 부분
</span>        <span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">publish_random_arithmetic_arguments</span><span class="p">)</span>

    <span class="c1"># 메시지 타입은 arithmeticArgument, timestamp, 랜덤의 argument a,b 저장
</span>    <span class="k">def</span> <span class="nf">publish_random_arithmetic_arguments</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nc">ArithmeticArgument</span><span class="p">()</span>

        <span class="c1"># timestamp 지정
</span>        <span class="n">msg</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_clock</span><span class="p">().</span><span class="nf">now</span><span class="p">().</span><span class="nf">to_msg</span><span class="p">()</span>

        <span class="c1"># 랜덤의 argument a 지정
</span>        <span class="n">msg</span><span class="p">.</span><span class="n">argument_a</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_random_num</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">max_random_num</span><span class="p">))</span>

        <span class="c1"># 랜덤의 argument b 지정
</span>        <span class="n">msg</span><span class="p">.</span><span class="n">argument_b</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_random_num</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">max_random_num</span><span class="p">))</span>

        <span class="c1"># 토픽 발행
</span>        <span class="n">self</span><span class="p">.</span><span class="n">arithmetic_argument_publisher</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># logging
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="s">'Published argument a: {0}'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">argument_a</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="s">'Published argument b: {0}'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">argument_b</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">update_parameter</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'min_random_num'</span> <span class="ow">and</span> <span class="n">param</span><span class="p">.</span><span class="n">type_</span> <span class="o">==</span> <span class="n">Parameter</span><span class="p">.</span><span class="n">Type</span><span class="p">.</span><span class="n">INTEGER</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">min_random_num</span> <span class="o">=</span> <span class="n">param</span><span class="p">.</span><span class="n">value</span>
            <span class="k">elif</span> <span class="n">param</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'max_random_num'</span> <span class="ow">and</span> <span class="n">param</span><span class="p">.</span><span class="n">type_</span> <span class="o">==</span> <span class="n">Parameter</span><span class="p">.</span><span class="n">Type</span><span class="p">.</span><span class="n">INTEGER</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">max_random_num</span> <span class="o">=</span> <span class="n">param</span><span class="p">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="nc">SetParametersResult</span><span class="p">(</span><span class="n">successful</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">argument</span> <span class="o">=</span> <span class="nc">Argument</span><span class="p">()</span>

        <span class="c1"># 1초에 1번씩 함수 실행
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">rclpy</span><span class="p">.</span><span class="nf">spin</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
        <span class="c1"># Ctrl+C와 같은 시그널이 들어오면 종료
</span>        <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">argument</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="s">'Keyboard Interrupt (SIGINT)'</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">argument</span><span class="p">.</span><span class="nf">destroy_node</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div><p> </p><h4 id="서브스크라이버-1">서브스크라이버 <a href="#서브스크라이버-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>토픽 서브스크라이버 역할을 하는 <strong>calculator</strong> 노드이다. calculator의 소스 코드는 토픽 서브스크라이버, 서비스 서버, 액션 서버를 모두 포함하고 있어서 매우 길어서 토픽 서브스크라이버와 관련된 부분만 살펴보도록 한다.</p><p>calculator 클래스는 rclpy.node 모듈의 Node 클래스를 상속하고 있으며, 생성자에서 <code class="language-plaintext highlighter-rouge">calculator</code> 라는 노드 이름으로 초기화된다. 그 뒤에는 QoSProfile 클래스를 사용하여 서브스크라이버의 QoS 설정을 해준다.</p><p> </p><ol><li>Node 설정<li>QoS 설정<li>create_subscription 설정<li>서브스크라이브 함수 작성</ol><p> </p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">rclpy</span>
<span class="kn">from</span> <span class="n">rclpy.executors</span> <span class="kn">import</span> <span class="n">MultiThreadedExecutor</span>

<span class="c1"># Node 클래스를 상속
</span><span class="k">class</span> <span class="nc">Calculator</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># calculator 이름으로 초기화
</span>        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="s">'calculator'</span><span class="p">)</span>

        <span class="c1"># 변수 초기화
</span>        <span class="n">self</span><span class="p">.</span><span class="n">argument_a</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">argument_b</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">callback_group</span> <span class="o">=</span> <span class="nc">ReentrantCallbackGroup</span><span class="p">()</span>

        <span class="p">(</span><span class="n">일부</span> <span class="n">코드</span> <span class="n">생략</span><span class="p">)</span>

        <span class="c1"># QoS 설정
</span>        <span class="n">QOS_RKL10V</span> <span class="o">=</span> <span class="nc">QoSProfile</span><span class="p">(</span>
            <span class="n">reliability</span><span class="o">=</span><span class="n">QoSReliabilityPolicy</span><span class="p">.</span><span class="n">RELIABLE</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">QoSHistoryPolicy</span><span class="p">.</span><span class="n">KEEP_LAST</span><span class="p">,</span>
            <span class="n">depth</span><span class="o">=</span><span class="n">qos_depth</span><span class="p">,</span>
            <span class="n">durability</span><span class="o">=</span><span class="n">QoSDurabilityPolicy</span><span class="p">.</span><span class="n">VOLATILE</span><span class="p">)</span>

        <span class="c1"># 서브스크라이버 설정
</span>        <span class="c1">### 퍼블리셔와 동일하게 (토픽 타입(ArithmeticArgument), 토픽 이름, QoS 설정) + callback함수
</span>        <span class="c1">### get_arithmetic_argument : 퍼블리셔로부터 메시지를 서브스크라이브할 때마다 실행되는 함수
</span>        <span class="c1">### callback_group = ReentrantCallbackGroup : 콜백함수를 병렬로 실행할 수 있게 해주는 multithread 기능이 있다. 지정해주지 않아도 되는데, 지정하지 않으면 MultuallyExclusiveCallbackGroup이 기본으로 설정된다. 이는 한번에 하나의 콜백함수만을 실행하도록 허용하는 것이고, ReenttrantCallbackGroup은 제한없이 콜백함수를 병렬로 실행시켜준다. callback_group 설정으로는 create_subscription(), create_service(), ActionServer(), create_timer() 에서 사용된다.
</span>        <span class="n">self</span><span class="p">.</span><span class="n">arithmetic_argument_subscriber</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
            <span class="n">ArithmeticArgument</span><span class="p">,</span>
            <span class="s">'arithmetic_argument'</span><span class="p">,</span>
            <span class="n">self</span><span class="p">.</span><span class="n">get_arithmetic_argument</span><span class="p">,</span>
            <span class="n">QOS_RKL10V</span><span class="p">,</span>
            <span class="n">callback_group</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">callback_group</span><span class="p">)</span>

    <span class="c1"># callback 함수 : ArithmeticArgument 타입의 메시지의 arithmetic_argument라는 토픽을 서브스크라이브 하면 실행된다.
</span>    <span class="k">def</span> <span class="nf">get_arithmetic_argument</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># 서브스크라이브한 msg의 argument a와 b를 멤버 변수에 저장
</span>        <span class="n">self</span><span class="p">.</span><span class="n">argument_a</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">argument_a</span>
        <span class="n">self</span><span class="p">.</span><span class="n">argument_b</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">argument_b</span>

        <span class="c1"># logging
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="s">'Subscribed at: {0}'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">stamp</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="s">'Subscribed argument a: {0}'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">argument_a</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="s">'Subscribed argument b: {0}'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">argument_b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">calculator</span> <span class="o">=</span> <span class="nc">Calculator</span><span class="p">()</span>

        <span class="c1"># multithreadExecutor가 있는데, 이는 스레드 풀(thread pool)을 사용하여 콜백을 실행하는 것인데, num_threads로 스레드 수를 지정할 수 있고, 지정하지 않을 경우 multiprocessing.cpu_count()를 통해 시스템에서 가용할 수 있는 스레드 수를 지정받는다. 둘다 해당되지 않으면 단일 스레드를 사용한다. excutor는 콜백이 병렬로 발생하도록 허용하여 ReentrantCallbackGroup과 함께 사용하여 콜백함수를 병렬로 실행할 수 있게 한다.
</span>        <span class="n">executor</span> <span class="o">=</span> <span class="nc">MultiThreadedExecutor</span><span class="p">(</span><span class="n">num_threads</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># 위에서 설정한 executor를 calculator 노드에 추가
</span>        <span class="n">executor</span><span class="p">.</span><span class="nf">add_node</span><span class="p">(</span><span class="n">calculator</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">executor</span><span class="p">.</span><span class="nf">spin</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">calculator</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="s">'Keyboard Interrupt (SIGINT)'</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">executor</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>
            <span class="n">calculator</span><span class="p">.</span><span class="n">arithmetic_action_server</span><span class="p">.</span><span class="nf">destroy</span><span class="p">()</span>
            <span class="n">calculator</span><span class="p">.</span><span class="nf">destroy_node</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div><p> </p><h4 id="실행-1">실행 <a href="#실행-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>실행하기 전에 setup.py를 다시 한 번 점검하자.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'console_scripts'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">'argument = topic_service_action_rclpy_example.arithmetic.argument:main'</span><span class="p">,</span>
            <span class="s">'operator = topic_service_action_rclpy_example.arithmetic.operator:main'</span><span class="p">,</span>
            <span class="s">'calculator = topic_service_action_rclpy_example.calculator.main:main'</span><span class="p">,</span>
            <span class="s">'checker = topic_service_action_rclpy_example.checker.main:main'</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
</pre></table></code></div></div><p>entry_points에 argument.py의 main함수 실행와 calculator.py의 main함수 실행하는 부분이 담겨져 있어야 한다.</p><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 launch topic_service_action_rclcpp_example arithmetic.launch.py
<span class="o">[</span>INFO] <span class="o">[</span>launch]: All log files can be found below /home/jhyoon/.ros/log/2022-08-02-18-33-29-121351-LAPTOP-FCNUC3SV-442
<span class="o">[</span>INFO] <span class="o">[</span>launch]: Default logging verbosity is <span class="nb">set </span>to INFO
<span class="o">[</span>INFO] <span class="o">[</span>argument-1]: process started with pid <span class="o">[</span>444]
<span class="o">[</span>INFO] <span class="o">[</span>calculator-2]: process started with pid <span class="o">[</span>446]
<span class="o">[</span>calculator-2] <span class="o">[</span>INFO]: Run calculator
<span class="o">[</span>argument-1] <span class="o">[</span>INFO]: Published argument_a 7.62
<span class="o">[</span>argument-1] <span class="o">[</span>INFO]: Published argument_b 1.43
<span class="o">[</span>calculator-2] <span class="o">[</span>INFO]: Timestamp of the message: sec 1659432810 nanosec 256482232
<span class="o">[</span>calculator-2] <span class="o">[</span>INFO]: Subscribed argument a: 7.62
<span class="o">[</span>calculator-2] <span class="o">[</span>INFO]: Subscribed argument b: 1.43
<span class="o">[</span>argument-1] <span class="o">[</span>INFO]: Published argument_a 8.76
<span class="o">[</span>argument-1] <span class="o">[</span>INFO]: Published argument_b 0.60
<span class="o">[</span>calculator-2] <span class="o">[</span>INFO]: Timestamp of the message: sec 1659432811 nanosec 256391424
<span class="o">[</span>calculator-2] <span class="o">[</span>INFO]: Subscribed argument a: 8.76
<span class="o">[</span>calculator-2] <span class="o">[</span>INFO]: Subscribed argument b: 0.60
</pre></table></code></div></div><p> </p></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/package/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/package.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/classlog/'>Classlog</a>, <a href='/categories/ros2/'>ROS2</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ros2/" class="post-tag no-text-decoration" >ROS2</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text= [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기 - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/package/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title= [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기 - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/package/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/package/&amp;text= [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기 - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/package/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[깃허브 프로필 꾸미기] github 프로필 만들기</a><li><a href="/posts/product/">[깃허브 프로필 꾸미기] productive box 만들기</a><li><a href="/posts/regex/">[데브코스] 2주차 - linux 기초(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation 과 StratifiedKFold</a><li><a href="/posts/cmake/">[데브코스] 17주차 - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/turtlesim/"><div class="card-body"> <em class="timeago small" date="2022-07-26 04:23:00 +0900" >Jul 26, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ROS2 이론] turtlesim 실행</h3><div class="text-muted small"><p> 개발 환경을 설정하는 것은 해당 블로그를 확인해보길 바란다.   007 패키지 설치와 노드 실행 Turtlesim 이란? 추가 예정.     Turtlesim 패키지 설치 turtlesim은 ROS의 기본 기능을 가지고 있어 튜토리얼로 많이 사용...</p></div></div></a></div><div class="card"> <a href="/posts/introduction/"><div class="card-body"> <em class="timeago small" date="2022-07-25 18:35:00 +0900" >Jul 25, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ROS2 이론] 목차 및 개요</h3><div class="text-muted small"><p> 표윤석 박사님의 네이버 카페 글을 참고로 하여 ROS2를 공부하고, 기록하고자 합니다. 기본 URL : https://cafe.naver.com/openrt/24070 github : https://github.com/robotpilot/ros2-seminar-examples   목차는 기본적으로 이론/프로그래밍으로 나뉘어져 있고, 심...</p></div></div></a></div><div class="card"> <a href="/posts/helloworld/"><div class="card-body"> <em class="timeago small" date="2022-07-26 01:35:00 +0900" >Jul 26, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ROS2 프로그래밍] ROS 프로그래밍 코드 스타일 및 프로그래밍 기초</h3><div class="text-muted small"><p> 023 ROS 프로그래밍 규칙 (코드 스타일) ROS2 프로그래밍 규칙 (코드 스타일) 협업 프로그래밍 작업 시 일관된 규칙을 만들고, 이를 준수하여야 코드가 꼬이거나 문제가 생기지 않는다. ROS가 지원하느 프로그래밍 언어는 다양하지만, 가장 많이 사용되는 C++과 python만 살펴보자.   C++ style ROS2 Develo...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/turtlesim/" class="btn btn-outline-primary" prompt="Older"><p>[ROS2 이론] turtlesim 실행</p></a> <a href="/posts/kooc_start/" class="btn btn-outline-primary" prompt="Newer"><p>[KOOC] 인공지능 및 기계학습 개론 - Abstract</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>