<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[논문 리뷰] You Only Look Once v5 - blog" /><meta name="author" content="JaeHo-YooN" /><meta property="og:locale" content="en" /><meta name="description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><meta property="og:description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><link rel="canonical" href="https://dkssud8150.github.io/posts/YoloV5/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/YoloV5/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-05T13:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[논문 리뷰] You Only Look Once v5 - blog" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo-YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo-YooN"},"dateModified":"2022-04-29T19:05:05+09:00","datePublished":"2021-09-05T13:00:00+09:00","description":"Do focus on developing ‘your ability’ rather than waste time on making you famous.","headline":"[논문 리뷰] You Only Look Once v5 - blog","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/YoloV5/"},"url":"https://dkssud8150.github.io/posts/YoloV5/"}</script><title>[논문 리뷰] You Only Look Once v5 - blog | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[논문 리뷰] You Only Look Once v5 - blog</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[논문 리뷰] You Only Look Once v5 - blog</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo-YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-09-05 13:00:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Sun, Sep 5, 2021, 1:00 PM +0900" >Sep 5, 2021</em> </span> <span> Updated <em class="timeago" date="2022-04-29 19:05:05 +0900 " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 29, 2022, 7:05 PM +0900" >Apr 29, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5754 words"> <em>31 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="https://blog.roboflow.com/content/images/2020/06/ezgif.com-video-to-gif--3--1.gif" alt="Full-width image" data-proofer-ignore></p><h2 id="yolo-review">YOLO review <a href="#yolo-review" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>입력된 이미지는 low-level feature 에서 high-level feature가 되고, classification을 위해 trainable classifier를 거친다. <br /></p><p><a href="https://www.notion.so/Yolo-You-Only-Look-Once-ee0370b7eec942bf8279dd54952e4efb">Yolo</a>는 앞서 정리한 것을 참고하면 좋을 것 같다.</p><p>간단히 리뷰하자면,</p><p><img data-src="https://pyimagesearch.com/wp-content/uploads/2018/11/yolo_design.jpg" alt="Full-width image" data-proofer-ignore></p><p>bounding box regression 과 classification을 나눠서 진행하는 Two stage 방법과는 다르게 두 개를 합쳐 동시에 진행함으로써 속도를 향상시켰다.</p><p>이미지를 SxS 그리드로 나누고, 이미지가 있을 법한 곳에 bounding box를 여러 개 예측하고, 각 BB에 대한 confidence를 추출한다. 이 confidence는 box안에 클래스가 존재하는지에 대한 파라미터다.</p><p>two stage 보다 속도는 뛰어나지만, 정확도 면에서는 떨어진다. <br /></p><h1 id="what-is-the-yolov5">What is the YoloV5</h1><p><img data-src="https://miro.medium.com/max/700/1*7UXLYoPteNz6IO9Oc3-jAw.png" alt="Full-width image" data-proofer-ignore></p><h2 id="train-yolov5-using-custom-datasetopen-image-dataset">train YOLOV5 using Custom dataset(open image dataset) <a href="#train-yolov5-using-custom-datasetopen-image-dataset" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-markdown highlighter-rouge"><div class="code-header"> <span data-label-text="Markdown"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gt">&gt; Index</span>
<span class="p">1.</span> Preparing Dataset
<span class="p">2.</span> Environment Setup
<span class="p">3.</span> Configure / Modify files and directory structure.
<span class="p">4.</span> Training 
<span class="p">5.</span> Inference
<span class="p">6.</span> Result
</pre></table></code></div></div><ul><li>preparing dataset</ul><p><a href="https://storage.googleapis.com/openimages/web/download.html">open image dataset</a>를 활용하여 분석할 것이다.<br /></p><p>다운 받은 데이터셋을 train, validation, test txt files 로 생성하여 각각에 70%, 20%, 10% 로 이동시킨다. 이 때, txt 내용은 사진의 경로를 넣는다.</p><blockquote><p>ex) ../data/train/000.jpg <br /></p></blockquote><ul><li>environment setup</ul><p>git clone 을 통해 불러온 가상환경에서 진행한다. 그리고, requirement.txt 파일을 불러와 패키지 설치를 통해 환경을 설정한다.</p><pre><code class="language-git">$ git clone https://github.com/ultralytics/yolov5.git
$ cd yolov5
$ pip install -r requirement.txt
</code></pre><div class="language-markdown highlighter-rouge"><div class="code-header"> <span data-label-text="Markdown"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="gh"># requirement.txt</span>
numpy==1.17
scipy==1.4.1
cudatoolkit==10.2.89
opencv-python
torch==1.5
torchvision==0.6.0
matplotlib
pycocotools
tqdm
pillow
tensorboard
pyyaml
</pre></table></code></div></div><ul><li>Configure / Modify files and idrectory structure</ul><p><img data-src="/assets/img/2021-09-05/dir.png" alt="Full-width image" data-proofer-ignore></p><p>clone을 통해 불러온 것을 위와 같이 경로를 설정한다.</p><p>데이터셋의 parameter를 설정하기 위해서는 YAML 파일을 설정해야 한다. 필요에 따라 수정할 수 있다.</p><p>원래의 형태는 아래와 같다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1"># train and val data as 1) directory: path/images/, 2) file: path/images.txt, or 3) list: [path1/images/, path2/images/]</span>
<span class="na">train</span><span class="pi">:</span> <span class="s">../coco128/images/train</span>
<span class="na">val</span><span class="pi">:</span> <span class="s">../coco128/images/val</span>

<span class="c1"># number of classes</span>
<span class="na">nc</span><span class="pi">:</span> <span class="m">80</span>

<span class="c1"># class names</span>
<span class="na">names</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">person'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bicycle'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">car'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">motorcycle'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">airplane'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bus'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">train'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">truck'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">boat'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">traffic</span><span class="nv"> </span><span class="s">light'</span><span class="pi">,</span>
        <span class="s1">'</span><span class="s">fire</span><span class="nv"> </span><span class="s">hydrant'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">stop</span><span class="nv"> </span><span class="s">sign'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">parking</span><span class="nv"> </span><span class="s">meter'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bench'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bird'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cat'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">dog'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">horse'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">sheep'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cow'</span><span class="pi">,</span>
        <span class="s1">'</span><span class="s">elephant'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bear'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">zebra'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">giraffe'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">backpack'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">umbrella'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">handbag'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">tie'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">suitcase'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">frisbee'</span><span class="pi">,</span>
        <span class="s1">'</span><span class="s">skis'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">snowboard'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">sports</span><span class="nv"> </span><span class="s">ball'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">kite'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">baseball</span><span class="nv"> </span><span class="s">bat'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">baseball</span><span class="nv"> </span><span class="s">glove'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">skateboard'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">surfboard'</span><span class="pi">,</span>
        <span class="s1">'</span><span class="s">tennis</span><span class="nv"> </span><span class="s">racket'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bottle'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">wine</span><span class="nv"> </span><span class="s">glass'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cup'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">fork'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">knife'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">spoon'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bowl'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">banana'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">apple'</span><span class="pi">,</span>
        <span class="s1">'</span><span class="s">sandwich'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">orange'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">broccoli'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">carrot'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">hot</span><span class="nv"> </span><span class="s">dog'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">pizza'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">donut'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cake'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">chair'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">couch'</span><span class="pi">,</span>
        <span class="s1">'</span><span class="s">potted</span><span class="nv"> </span><span class="s">plant'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bed'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">dining</span><span class="nv"> </span><span class="s">table'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">toilet'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">tv'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">laptop'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">mouse'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">remote'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">keyboard'</span><span class="pi">,</span> 
        <span class="s1">'</span><span class="s">cell</span><span class="nv"> </span><span class="s">phone'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">microwave'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">oven'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">toaster'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">sink'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">refrigerator'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">book'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">clock'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">vase'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">scissors'</span><span class="pi">,</span> 
        <span class="s1">'</span><span class="s">teddy</span><span class="nv"> </span><span class="s">bear'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">hair</span><span class="nv"> </span><span class="s">drier'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">toothbrush'</span><span class="pi">]</span>
</pre></table></code></div></div><p>이를 자신이 cumtomize 하여 사용할 것만 가져오면 된다. 그리고 train, val 부분을 이미지가 있는 경로로 설정한다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1"># here you need to specify the files train, test and validation txt # files created in step 1.</span>
<span class="na">train</span><span class="pi">:</span> <span class="s">./data/images/train</span>
<span class="na">val</span><span class="pi">:</span> <span class="s">/data/images/valid</span>
<span class="na">test</span><span class="pi">:</span> <span class="s">/data/images/test</span>
<span class="c1"># number of classes in your dataset</span>
<span class="na">nc</span><span class="pi">:</span> <span class="m">1</span>
<span class="c1"># class names</span>
<span class="na">names</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">Elephant'</span><span class="pi">]</span>
</pre></table></code></div></div><p>그 후 이미지를 작업 폴더로 옮기고, 각각 train, val, test 폴더로 <strong>분리</strong>시킨다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="n">shutil</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="n">data</span> <span class="o">=</span><span class="p">[</span><span class="s">'train'</span><span class="p">,</span><span class="s">'valid'</span><span class="p">,</span><span class="s">'test'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="s">'./data/iamges/'</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">'/'</span>
    <span class="n">image</span> <span class="o">=</span> <span class="s">'./data/images/'</span> <span class="o">+</span> <span class="n">i</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="s">'./data/labels/'</span> <span class="o">+</span> <span class="n">i</span>
    <span class="n">mydict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">image</span><span class="p">:</span> <span class="p">[</span><span class="s">'jpg'</span><span class="p">,</span><span class="s">'png'</span><span class="p">,</span><span class="s">'gif'</span><span class="p">,</span><span class="s">'jpeg'</span><span class="p">,</span><span class="s">'JPG'</span><span class="p">],</span>
        <span class="n">labels</span><span class="p">:</span> <span class="p">[</span><span class="s">'txt'</span><span class="p">,</span><span class="s">'json'</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">destination</span><span class="p">,</span> <span class="n">extensions</span> <span class="ow">in</span> <span class="nf">mydict_items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="nf">glob</span><span class="p">(</span><span class="n">source</span> <span class="o">+</span><span class="s">'*'</span> <span class="o">+</span> <span class="n">ext</span><span class="p">):</span>
                <span class="n">shutil</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="nb">file</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">'/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></table></code></div></div><p><br /></p><ul><li>training</ul><p>yolov5는 4가지로 나눌 수 있다. s,m,l,x 는 각각 <code class="language-plaintext highlighter-rouge">small</code>,<code class="language-plaintext highlighter-rouge">medium</code>, <code class="language-plaintext highlighter-rouge">large</code>, <code class="language-plaintext highlighter-rouge">xlarge</code> 에 해당한다.</p><p>이를 나눈 기준은 model depth multiple 과 layer width multiple 의 차이이다.</p><p>학습할 때 weight는 yolov5s.pt 라는 미리 학습되어 있는 파일을 사용한다.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Model<th style="text-align: left">size(pixels)<th style="text-align: left">mAP-val 0.5:0.95<th style="text-align: left">mAP-test 0.5:0.95<th style="text-align: left">speed V100 (ms)<tbody><tr><td style="text-align: center">YOLOv5s<td style="text-align: left">640<td style="text-align: left">36.7<td style="text-align: left">36.7<td style="text-align: left">2.0<tr><td style="text-align: center">YOLOv5m<td style="text-align: left">640<td style="text-align: left">44.5<td style="text-align: left">44.5<td style="text-align: left">2.7<tr><td style="text-align: center">YOLOv5l<td style="text-align: left">640<td style="text-align: left">48.2<td style="text-align: left">48.2<td style="text-align: left">3.8<tr><td style="text-align: center">YOLOv5x<td style="text-align: left">640<td style="text-align: left">50.4<td style="text-align: left">50.4<td style="text-align: left">6.1</table></div><p>이제 image를 train 모델에 입력시켜 훈련한다.</p><p>model을 학습하기 전, 사용할 model 파일을 들어가 nc(number of classes) 파라미터를 앞서 설정했던 것과 동일하게 변경시켜줘야 한다. <br /></p><ul><li>Inference</ul><p>훈련된 모델에 test image를 넣어 inference를 진행한다.</p><pre><code class="language-command">python3 detect.py --source ~/test_img/2011_09_26_drive_0091_sync/image_01/data/ --weights ./runs/exp5_ep50/weights/my_best.pt
</code></pre><p>detect.py를 통해 test를 하고 –source는 test할 data의 파일 경로 , –weights는 train에서 나온 결과 파일에서 weight 파일을 선택한다. weight file은 best.pt와 last.pt 가 나오는데 나는 best.pt 로 설정했다.</p><ul><li>Result</ul><p><img data-src="https://miro.medium.com/max/700/1*PbBTabYmB6hyvPwlsgxDow.gif" alt="Half-width image" data-proofer-ignore></p><p><br /></p><h4 id="train-yolov5-using-custom-datasetcoco-dataset">train YOLOV5 using Custom dataset(<a href="https://cocodataset.org/#home">COCO dataset</a>) <a href="#train-yolov5-using-custom-datasetcoco-dataset" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>추가적으로 COCO Dataset을 사용할 경우를 보자. 위 사이트를 들어가면 coco dataset을 다운받을 수 있다.</p><p>여기서 coco dataset을 yolo dataset으로 변경시켜줘야 한다. 변경하는 방법은 직접 변경해도 되지만, 변경해주는 <a href="https://bitbucket.org/yymoto/coco-to-yolo/src/master/">사이트</a>가 따로 있다. 이 링크로 들어가서 jar 파일을 다운 받고 아래와 같이 입력하면 된다.</p><pre><code class="language-command">cocotoyolo.jar "json file(annotations) path" "img path" "class" "save path"
</code></pre><p>coco dataset을 다운 받을 때 annotation.json 의 위치, 변환할 이미지의 위치, 그리고 내가 원하는 추출하고자 하는 class 이름, 그리고 저장할 위치이다.</p><p><img data-src="/assets/img/2021-09-05/size.png" alt="Full-width image" data-proofer-ignore></p><p>coco는 기본적으로 bounding box가 <strong>맨 왼쪽의 x,y 좌표</strong>로 구성되어 있고, 이에 따른 w,h 로 구성된다.</p><p><img data-src="/assets/img/2021-09-05/size2.png" alt="Full-width image" data-proofer-ignore></p><p>yolo dataset은 x,y 좌표가 bounding box 중앙에 위치하고, 이에 따른 w,h가 존재해야 한다. 따라서 x,y,w,h 좌표를 중앙을 기준으로 하도록 재설정해야 한다.</p><p>이후에는 open image dataset을 할 때와 같다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>&gt; 성능 높이는 방법
yolov5 공식 깃허브에 기재되어 있는 성능 높이는 여러 방법이 있다.
* background image 넣기 =&gt; bg image를 넣으면 false positive가 줄어든다고 한다. train 이미지 전체의 0~10% 정도 넣어주는 것을 추천한다. 
* pretrained weight 사용하기 =&gt; 작거나 중간 정도의 사이즈의 데이터셋 사용 시 추천한다. (yolov5.pt 대신 다른 것을 넣는 것이다.)
* epoch 을 300부터 시작해서 overfitting 이 발생하면 줄이고 아니면 점차 늘린다.
* 기본 파라미터들은 hyp.scatch.yaml에 있다. 먼저 이 parameter들을 학습시켜놓는 것을 추천한다. yolov5에서는 hyperparameter evolution 이라는 기법을 사용한다. 이는 genetic algorithm(GA)를 사용해서 hyperparameter를 최적화한다. 이 기법은 [이 블로그]를 참고하는 것이 좋다. 인자값으로 --evolve를 줘서 이 기법을 사용할 수 있다고 한다. 
</pre></table></code></div></div><h3 id="평가-지표">평가 지표 <a href="#평가-지표" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>IoU</ul><p>IoU 는 데이터셋에 대해서 객체 검출하는 모델의 정확도를 측정하는 방법이다. 이는 합성곱 신경망을 사용한 객체 검출 모델(R-CNN, YOLO) 등에 사용된다. IOU를 평가하기 위해서 GT Bounding box와 모델로부터 예측된 bounding box 를 사용한다.</p><p><img data-src="/assets/img/2021-09-05/iou.png" alt="Full-width image" data-proofer-ignore></p><p>classification의 경우 라벨 값만 비교하면 되지만, 객체 검출은 bounding box를 정확하게 예측했는지가 중요하다. 따라서 bounding box의 x,y 좌표를 사용해야 한다.</p><p>이 때, threshold를 설정하여 0.5라고 가정하면 IOU를 계산했을 때, 0.5보다 큰 것만 가져온다.</p><ul><li>Precision, Recall</ul><p>Precision(정밀도)는 모델이 예측한 결과의 positive 결과가 얼마나 정확한지 측정하는 것이고, Recall(재현율)은 모델이 예측한 결과가 얼마나 positive 값들을 잘 찾는지 측정하는 것이다.</p><p><img data-src="https://blog.kakaocdn.net/dn/b2pbxK/btq4IM4xg8s/RSDBy18rP4aZK85ISR1ZkK/img.png" alt="Full-width image" data-proofer-ignore></p><p>예를 들어, 암 진단의 경우를 볼 때, <br /></p><p>precision: 양성으로 예측된 것 중 진짜 양성의 비율 =&gt; 모델이 정답이라고 한 것 중 진짜 정답의 비율 recall: 진짜 양성 중 양성으로 예측된 비율 =&gt; 진짜 정답 중에 모델이 정답이라 한 것의 비율</p><p><img data-src="https://blog.kakaocdn.net/dn/dUBKFl/btq4J8TMagH/Iay9qJkkmZRPyUtphzSggK/img.png" alt="Half-width image" data-proofer-ignore></p><p>precision 과 recall 은 반비례하는 경향이 있다. 따라서 두 값을 종합해서 알고리즘 성능을 평가해야 한다. 그래서 나온 것이 PR곡선(Precision-recall)이다.</p><p>PR곡선은 confidence 에 따라 값이 변한다. confidence는 알고리즘이 검출한 것에 대해 얼마나 정확하다고 생각하는지 알려주는 값인데, 어떤 물체를 검출했을 때 confidence가 0.99라면 알고리즘은 그 물체가 검출해야 하는 물체와 거의 똑같다고 생각한다.</p><ul><li>Average Precision(AP) PR 곡선은 알고리즘의 성능을 평가하기에는 좋으나 서로 다른 두 알고리즘을 비교하는데는 좋지 않다.</ul><p>Average precision은 PR그래프에서 그래프 선 아래쪽의 면적에 해당한다. AP가 높을수록 그 알고리즘의 성능이 높다는 뜻이다. 컴퓨터 비전에서는 대부분 AP로 성능을 평가한다.</p><ul><li>mAP(mean AP) mAP를 구하기 위해서 예측한 모든 bounding box를 가져온다. 이 모든 box를 confidence 기준으로 내림차순한다. 이 모든 box 에 대해 precision, recall 을 계산한다. 계산한 값들로 PR곡선을 그린다. 그 후 곡선 아래의 면적을 계산하면 된다. 객체가 두 개 이상일 경우 AP를 평균 낸다. 그래서 mAP인 것이다. 이때 mAP 0.5:0.05:0.95라고 하는 것은 0.5,0.05,0.95 IOU threshold를 사용하여 계산한 것이다.</ul><h2 id="diffence-between-yolov5-and-others">diffence between YoloV5 and others <a href="#diffence-between-yolov5-and-others" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>The First Release of model in pytorch between Yolo famliy yolov5는 처음으로 pytorch에서 구현되었기 때문에, 이 모델을 사용할 때, 보다 더 쉬워졌다. 또한, 모델을 ONNX 나 CoreML로 쉽게 컴파일할 수 있게 되었기 때문에 모바일 기기로의 구현이 간단해졌다.</p><li><p>More Faster and More Accurate and Small <a href="https://colab.research.google.com/drive/1gDZ2xcTOgR39tGGs-EZ6i3RTs16wmzZQ#scrollTo=GD9gUQpaBxNa">yolov5 colab</a> 을 참고할 때, 140 frames per second(FPS)를 달성하였다고 한다. V4와 비교했을 때, 50FPS나 더 빨라진 것이다. 또한, 100 epochs 동안 평균 약 0.895 mAP 를 달성했다. yolov5의 weight 파일은 약 27MB 정도의 크기다. 그에 반해 yolov4는 244MB 이다.</p></ul><p><img data-src="https://user-images.githubusercontent.com/26833433/114313216-f0a5e100-9af5-11eb-8445-c682b60da2e3.png" alt="Full-width image" data-proofer-ignore><br /></p><h2 id="yolov5-architecture">Yolov5 Architecture <a href="#yolov5-architecture" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="backbone-and-head">Backbone and Head <a href="#backbone-and-head" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>크게 <code class="language-plaintext highlighter-rouge">Backbone</code>과 <code class="language-plaintext highlighter-rouge">Head</code>가 있다.</p><p>yolov5가 빨라진 이유는 backbone의 변화의 영향이 가장 크다.</p><p><strong>backbone</strong>의 경우, image로부터 feature map을 추출하는 부분인데, Yolov5는 DarkNet을 사용하고, CSPNet, 그 중에서도 BottleneckCSP를 사용했다.</p><p>CSPNet는 CNN의 학습 능력을 향상시키는 방법으로 이 <a href="https://keyog.tistory.com/30">블로그</a>에 잘 설명되어 있다.</p><p>그리고, yolov5는 4가지로 나눌 수 있다. s,m,l,x 는 각각 <code class="language-plaintext highlighter-rouge">small</code>,<code class="language-plaintext highlighter-rouge">medium</code>, <code class="language-plaintext highlighter-rouge">large</code>, <code class="language-plaintext highlighter-rouge">xlarge</code> 에 해당한다.</p><p><strong>Head</strong>의 경우, 추출된 feature map을 바탕으로 물체의 위치를 찾는 부분이다. Anchor box를 통해 bounding box를 예측한다. v3와 동일하게 3가지의 scale에서 바운딩 박스를 생성한다. 그 후, 각 scale마다 3개의 anchor box를 사용하기에 총 9개의 anchor box를 만들게 된다.</p><pre><code class="language-git">                 from  n    params  module                                  arguments                     
  0                -1  1      3520  models.common.Focus                     [3, 32, 3]                    
  1                -1  1     18560  models.common.Conv                      [32, 64, 3, 2]                
  2                -1  1     19904  models.common.BottleneckCSP             [64, 64, 1]                   
  3                -1  1     73984  models.common.Conv                      [64, 128, 3, 2]               
  4                -1  1    161152  models.common.BottleneckCSP             [128, 128, 3]                 
  5                -1  1    295424  models.common.Conv                      [128, 256, 3, 2]              
  6                -1  1    641792  models.common.BottleneckCSP             [256, 256, 3]                 
  7                -1  1   1180672  models.common.Conv                      [256, 512, 3, 2]              
  8                -1  1    656896  models.common.SPP                       [512, 512, [5, 9, 13]]        
  9                -1  1   1248768  models.common.BottleneckCSP             [512, 512, 1, False]          
 10                -1  1    131584  models.common.Conv                      [512, 256, 1, 1]              
 11                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']          
 12           [-1, 6]  1         0  models.common.Concat                    [1]                           
 13                -1  1    378624  models.common.BottleneckCSP             [512, 256, 1, False]          
 14                -1  1     33024  models.common.Conv                      [256, 128, 1, 1]              
 15                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']          
 16           [-1, 4]  1         0  models.common.Concat                    [1]                           
 17                -1  1     95104  models.common.BottleneckCSP             [256, 128, 1, False]          
 18                -1  1    147712  models.common.Conv                      [128, 128, 3, 2]              
 19          [-1, 14]  1         0  models.common.Concat                    [1]                           
 20                -1  1    313088  models.common.BottleneckCSP             [256, 256, 1, False]          
 21                -1  1    590336  models.common.Conv                      [256, 256, 3, 2]              
 22          [-1, 10]  1         0  models.common.Concat                    [1]                           
 23                -1  1   1248768  models.common.BottleneckCSP             [512, 512, 1, False]          
 24      [17, 20, 23]  1    229245  Detect                                  [80, [[10, 13, 16, 30, 33, 23], [30, 61, 62, 45, 59, 119], [116, 90, 156, 198, 373, 326]], [128, 256, 512]]

 Model Summary: 191 layers, 7.46816e+06 parameters, 7.46816e+06 gradients
</code></pre><p>이는 yolov5의 전체 architeture 을 나타낸 것이다.</p><p>i가 0~9 까지가 backbone 10~24가 head 이다.</p><h3 id="backbone">Backbone <a href="#backbone" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="model">model <a href="#model" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li><code class="language-plaintext highlighter-rouge">Bottleneck</code></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">BottleneckCSP</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="c1"># CSP Bottleneck https://github.com/WongKinYiu/CrossStagePartialNetworks
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shortcut</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>  <span class="c1"># ch_in, ch_out, number, shortcut, groups, expansion
</span>        <span class="nf">super</span><span class="p">(</span><span class="n">BottleneckCSP</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">c_</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">c2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span>  <span class="c1"># hidden channels
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cv1</span> <span class="o">=</span> <span class="nc">Conv</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cv2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cv3</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cv4</span> <span class="o">=</span> <span class="nc">Conv</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c_</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">bn</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c_</span><span class="p">)</span>  <span class="c1"># applied to cat(cv2, cv3)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">act</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">LeakyReLU</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nc">Bottleneck</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">shortcut</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">cv3</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">cv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">cv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">cv4</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">act</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">bn</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">((</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))))</span>
</pre></table></code></div></div><p>BottleneckCSP는 기본적으로 4개의 Conv layer를 생성한다.</p><p>이 중, conv2 와 conv3은 convolution + batch normalization을 진행한다.</p><p>또, CSP 구조이므로 y 값을 2 개 생성한다. y1은 conv1에서 바로 conv3로 갈 때의 연산값이 나오고, y2는 conv2의 값을 받는다. 이를 conv4에 합친 후 반환한다.</p><ul><li><code class="language-plaintext highlighter-rouge">conv</code></ul><p>conv + batch_norm 레이어다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Conv</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="c1"># Standard convolution
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">act</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>  <span class="c1"># ch_in, ch_out, kernel, stride, padding, groups
</span>        <span class="nf">super</span><span class="p">(</span><span class="n">Conv</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="nf">autopad</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">groups</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">bn</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">BatchNorm2d</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">act</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Hardswish</span><span class="p">()</span> <span class="k">if</span> <span class="n">act</span> <span class="k">else</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Identity</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">act</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">bn</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">fuseforward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">act</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">conv</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></table></code></div></div><p>forward 함수를 보면, 이 레이어는 conv 연산을 한 후에 batch normalization 과정을 거친다.</p><p>활성화 함수로는 Hard swish 함수를 사용한다. Hard swish는 최근에 나온 함수이다.</p><p><img data-src="/assets/img/2021-09-05/sigmoid.png" alt="Full-width image" data-proofer-ignore></p><p>ReLU를 대체하기 위한 구글이 고안한 함수라고 한다. 시그모이드 함수에 x를 곱한 간단한 형태다. 깊은 레이어를 학습시킬 때 뛰어난 성능을 보인다고 한다.</p><ul><li><code class="language-plaintext highlighter-rouge">SPP</code></ul><p>Spatial Pyramid Pooling Layer 로, 5<em>5, 9</em>9, 13*13 feature map 들을 사용한다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">SPP</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="c1"># Spatial pyramid pooling layer used in YOLOv3-SPP
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">)):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">SPP</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">c_</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># hidden channels
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cv1</span> <span class="o">=</span> <span class="nc">Conv</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cv2</span> <span class="o">=</span> <span class="nc">Conv</span><span class="p">(</span><span class="n">c_</span> <span class="o">*</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">c2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ModuleList</span><span class="p">([</span><span class="n">nn</span><span class="p">.</span><span class="nc">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">x</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">cv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">cv2</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nf">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">m</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">Concat</code></ul><p>단순히 2개의 레이어 연산 값을 합치는 것이다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Concat</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="c1"># Concatenate a list of tensors along dimension
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">Concat</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">dimension</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">d</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="depth-multiple">Depth Multiple <a href="#depth-multiple" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>depth multiple 값이 클수록 BottleneckCSP 모듈(레이어)가 더 많이 반복되어, 더 깊은 모델이 된다.</p><p><code class="language-plaintext highlighter-rouge">parse model</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">parse_model</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ch</span><span class="p">):</span>  <span class="c1"># model_dict, input_channels(3)
</span>    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">%3s%18s%3s%10s  %-40s%-30s'</span> <span class="o">%</span> <span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="s">'from'</span><span class="p">,</span> <span class="s">'n'</span><span class="p">,</span> <span class="s">'params'</span><span class="p">,</span> <span class="s">'module'</span><span class="p">,</span> <span class="s">'arguments'</span><span class="p">))</span>
    <span class="n">anchors</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">gd</span><span class="p">,</span> <span class="n">gw</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">'anchors'</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">'nc'</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">'depth_multiple'</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">'width_multiple'</span><span class="p">]</span>
    <span class="c1"># print("depth_multiple : %s" %gd)
</span>    <span class="n">na</span> <span class="o">=</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">anchors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">anchors</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">anchors</span>  <span class="c1"># number of anchors
</span>    <span class="n">no</span> <span class="o">=</span> <span class="n">na</span> <span class="o">*</span> <span class="p">(</span><span class="n">nc</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># number of outputs = anchors * (classes + 5)
</span>
    <span class="n">layers</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># layers, savelist, ch out
</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">'backbone'</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s">'head'</span><span class="p">]):</span>  <span class="c1"># from, number, module, args
</span>        <span class="n">m</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">m</span>  <span class="c1"># eval strings
</span>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">a</span>  <span class="c1"># eval strings
</span>            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">gd</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">n</span>  <span class="c1"># depth gain
</span>        <span class="c1"># print("depth_gain : %s" %n)
</span></pre></table></code></div></div><p>위의 코드를 보면, depth multiple 값이 gd라는 변수에 저장되는 것을 볼 수 있다. 변수 gd는 depth gain의 변수인 n을 구하는데 사용한다.</p><p>depth gain의 변수 n을 계산하기 위해서 2개으 변수를 사용한다. 위에서 설명한 gd(=depth_multiple) 값과 yaml 파일에서 number라고 적혀있는 n 값을 사용한다.</p><p>위의 yolov5 aritecture을 보면 Focus, Conv, SPP 모듈은 number 값이 1이고, bottleneckCSP 모듈만이 number 값을 3,9를 가진다.</p><p>number의 n과 depth_multiple 의 gd를 곱하고 round로 반올림 한 후, max 를 통해 정수 1보다 작은 것을 제거시켜서 n(=depth gain)을 계산한다.</p><p>이 n을 활용하여</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">m_</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nf">m</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="nf">m</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># module
</span></pre></table></code></div></div><p>n 값만큼 반복한다.</p><p>아래는 n=9인 BottleneckCSP의 구조다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="n">number</span> <span class="p">:</span> <span class="mi">9</span>
<span class="n">depth_gain</span> <span class="p">:</span> <span class="mi">3</span>
<span class="n">module</span> <span class="p">:</span> <span class="nc">BottleneckCSP</span><span class="p">(</span>
  <span class="p">(</span><span class="n">cv1</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
    <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="n">cv2</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="p">(</span><span class="n">cv3</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="p">(</span><span class="n">cv4</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
    <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="p">(</span><span class="n">m</span><span class="p">):</span> <span class="nc">Sequential</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="nc">Bottleneck</span><span class="p">(</span>
      <span class="p">(</span><span class="n">cv1</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">cv2</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="nc">Bottleneck</span><span class="p">(</span>
      <span class="p">(</span><span class="n">cv1</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">cv2</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">):</span> <span class="nc">Bottleneck</span><span class="p">(</span>
      <span class="p">(</span><span class="n">cv1</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">cv2</span><span class="p">):</span> <span class="nc">Conv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="nc">Conv2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">(</span><span class="n">bn</span><span class="p">):</span> <span class="nc">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">(</span><span class="n">act</span><span class="p">):</span> <span class="nc">Hardswish</span><span class="p">()</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>
</pre></table></code></div></div><p>여기서 핵심은 <strong>(n):Bottleneck</strong> 이다. n=9이고, depth_gain=3 일 경우</p><p>n * gd = 9 * (1/3) = 2.97 즉 3 정도이기 때문에 0~2 총 3번 반복한다.</p><h4 id="width-multiple">Width Multiple <a href="#width-multiple" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>args값과 width_multiple 값을 곱한 값이 해당 모듈의 채널 값으로 사용된다. 즉, width_multiple 값이 증가할수록 해당 레이어의 conv필터 수가 증가한다.</p><p>yolov5s 의 경우 width_multiple 값은 0.5이다. 이 변수는 gw에 저장된다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1"># yaml file</span>
<span class="c1"># YOLOv5 backbone</span>
<span class="na">backbone</span><span class="pi">:</span>
  <span class="c1"># [from, number, module, args]</span>
  <span class="pi">[[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Focus</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">64</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">]],</span>  <span class="c1"># 0-P1/2</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">128</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">]],</span>  <span class="c1"># 1-P2/4</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">128</span><span class="pi">]],</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">256</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">]],</span>  <span class="c1"># 3-P3/8</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">9</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">256</span><span class="pi">]],</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">512</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">]],</span>  <span class="c1"># 5-P4/16</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">9</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">512</span><span class="pi">]],</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1024</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">]],</span>  <span class="c1"># 7-P5/32</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">SPP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1024</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">5</span><span class="pi">,</span> <span class="nv">9</span><span class="pi">,</span> <span class="nv">13</span><span class="pi">]]],</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1024</span><span class="pi">,</span> <span class="nv">False</span><span class="pi">]],</span>  <span class="c1"># 9</span>
  <span class="pi">]</span>
</pre></table></code></div></div><p>yolov5 의 backbone 구조를 나타낸 것이다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">parse_model</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ch</span><span class="p">):</span>  <span class="c1"># model_dict, input_channels(3)
</span>    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">%3s%18s%3s%10s  %-40s%-30s'</span> <span class="o">%</span> <span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="s">'from'</span><span class="p">,</span> <span class="s">'n'</span><span class="p">,</span> <span class="s">'params'</span><span class="p">,</span> <span class="s">'module'</span><span class="p">,</span> <span class="s">'arguments'</span><span class="p">))</span>
    <span class="n">anchors</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">gd</span><span class="p">,</span> <span class="n">gw</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">'anchors'</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">'nc'</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">'depth_multiple'</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">'width_multiple'</span><span class="p">]</span>
    <span class="c1"># print("depth_multiple : %s" %gd)
</span>    <span class="c1"># print("width_multiple : %s" %gw)
</span>    <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="n">nn</span><span class="p">.</span><span class="n">Conv2d</span><span class="p">,</span> <span class="n">Conv</span><span class="p">,</span> <span class="n">Bottleneck</span><span class="p">,</span> <span class="n">SPP</span><span class="p">,</span> <span class="n">DWConv</span><span class="p">,</span> <span class="n">MixConv2d</span><span class="p">,</span> <span class="n">Focus</span><span class="p">,</span> <span class="n">CrossConv</span><span class="p">,</span> <span class="n">BottleneckCSP</span><span class="p">,</span> <span class="n">C3</span><span class="p">]:</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># print("args [0] : %s" %c2)
</span>        <span class="n">c2</span> <span class="o">=</span> <span class="nf">make_divisible</span><span class="p">(</span><span class="n">c2</span> <span class="o">*</span> <span class="n">gw</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="k">if</span> <span class="n">c2</span> <span class="o">!=</span> <span class="n">no</span> <span class="k">else</span> <span class="n">c2</span>
        <span class="c1"># print("make_divisible_c2 : %s" %c2)
</span>            
            
<span class="c1">################### utils 폴더 안에 있는 general.py 코드 ####################
</span>
<span class="k">def</span> <span class="nf">make_divisible</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
    <span class="c1"># Returns x evenly divisble by divisor
</span>    <span class="k">return</span> <span class="n">math</span><span class="p">.</span><span class="nf">ceil</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">)</span> <span class="o">*</span> <span class="n">divisor</span>
</pre></table></code></div></div><p>이때 c2라는 변수도 존재하는데, yaml 파일의 args의 첫번째 변수다. Focus 에서 args로 [64,3]를 가지고 있다. 따라서 64가 c2 값이 된다.</p><p>gw와 c2는 make_divisible 함수에 의해 두 변수를 곱해서 계산된다.</p><h3 id="head">Head <a href="#head" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1"># yolov5s.yaml</span>
<span class="c1"># YOLOv5 head</span>
<span class="na">head</span><span class="pi">:</span>
  <span class="pi">[[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">512</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">]],</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">nn.Upsample</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">None</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">,</span> <span class="s1">'</span><span class="s">nearest'</span><span class="pi">]],</span>
   <span class="pi">[[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">6</span><span class="pi">],</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Concat</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">]],</span>  <span class="c1"># cat backbone P4</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">512</span><span class="pi">,</span> <span class="nv">False</span><span class="pi">]],</span>  <span class="c1"># 13</span>

   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">256</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">]],</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">nn.Upsample</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">None</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">,</span> <span class="s1">'</span><span class="s">nearest'</span><span class="pi">]],</span>
   <span class="pi">[[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">4</span><span class="pi">],</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Concat</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">]],</span>  <span class="c1"># cat backbone P3</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">256</span><span class="pi">,</span> <span class="nv">False</span><span class="pi">]],</span>  <span class="c1"># 17 (P3/8-small)</span>

   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">256</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">]],</span>
   <span class="pi">[[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">14</span><span class="pi">],</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Concat</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">]],</span>  <span class="c1"># cat head P4</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">512</span><span class="pi">,</span> <span class="nv">False</span><span class="pi">]],</span>  <span class="c1"># 20 (P4/16-medium)</span>

   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Conv</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">512</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">]],</span>
   <span class="pi">[[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">10</span><span class="pi">],</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Concat</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">]],</span>  <span class="c1"># cat head P5</span>
   <span class="pi">[</span><span class="nv">-1</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">BottleneckCSP</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">1024</span><span class="pi">,</span> <span class="nv">False</span><span class="pi">]],</span>  <span class="c1"># 23 (P5/32-large)</span>

   <span class="pi">[[</span><span class="nv">17</span><span class="pi">,</span> <span class="nv">20</span><span class="pi">,</span> <span class="nv">23</span><span class="pi">],</span> <span class="nv">1</span><span class="pi">,</span> <span class="nv">Detect</span><span class="pi">,</span> <span class="pi">[</span><span class="nv">nc</span><span class="pi">,</span> <span class="nv">anchors</span><span class="pi">]],</span>  <span class="c1"># Detect(P3, P4, P5)</span>
  <span class="pi">]</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre># yolo.py result (YOLOv5-s'HEAD)

  i              from  n    params  module                                  arguments  
 10                -1  1    131584  models.common.Conv                      [512, 256, 1, 1]
 11                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']
 12           [-1, 6]  1         0  models.common.Concat                    [1]
 13                -1  1    378624  models.common.BottleneckCSP             [512, 256, 1, False]
 14                -1  1     33024  models.common.Conv                      [256, 128, 1, 1]
 15                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']
 16           [-1, 4]  1         0  models.common.Concat                    [1]
 17                -1  1     95104  models.common.BottleneckCSP             [256, 128, 1, False]
 18                -1  1    147712  models.common.Conv                      [128, 128, 3, 2]
 19          [-1, 14]  1         0  models.common.Concat                    [1]
 20                -1  1    313088  models.common.BottleneckCSP             [256, 256, 1, False]
 21                -1  1    590336  models.common.Conv                      [256, 256, 3, 2]
 22          [-1, 10]  1         0  models.common.Concat                    [1]
 23                -1  1   1248768  models.common.BottleneckCSP             [512, 512, 1, False]
 24      [17, 20, 23]  1    229245  Detect                                  [80, [[10, 13, 16, 30, 33, 23], [30, 61, 62, 45, 59, 119], [116, 90, 156, 198, 373, 326]], [128, 256, 512]]
</pre></table></code></div></div><p>head 또한 from number module arguments 로 구성되어 있다.</p><p>{conv,upsample,concat,bottleneckCSP}가 한 불록이다. 이 블록이 총 4개 있는 것이고, 마지막 detect 부분으로 연결된다.</p><h4 id="concat">Concat <a href="#concat" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>여기서 concat의 의미는 바로 전 층인 nn.upsample 층과 bottleneckCSP 층과 결합시키는 것이다.</p><p>첫번째 concat 부분은 backbone의 P4(i=6인 BottleneckCSP)와 결합 두번째 concat 부분은 backbone의 P3(i=4인 BottleneckCSP)와 결합 -&gt; 작은 물체 검출 세번째 concat 부분은 backbone의 P4(i=14인 conv)와 결합 -&gt; 중간 물체 검출 네번째 concat 부분은 backbone의 P5(i=10인 conv)와 결합 -&gt; 큰 물체 검출 한다는 것이다. P3가 작은 물체 검출인 이유는 P3의 경우 작은 픽셀을 가지고 있다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">Concat</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"ch_list : %s"</span> <span class="o">%</span><span class="n">ch</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"x : %s"</span> <span class="o">%</span><span class="n">x</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"x+1 : %s"</span> <span class="o">%</span><span class="nf">str</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">c2</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">([</span><span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="p">])</span>

    <span class="nf">print</span><span class="p">(</span><span class="s">"c2 : %s"</span> <span class="o">%</span><span class="n">c2</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="detect">detect <a href="#detect" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>말 그대로 i = 17,20,23 layer를 종합하여 detect 한다.</p><h3 id="loss">Loss <a href="#loss" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="giou">GIoU <a href="#giou" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>GIoU는 bounding box에 관한 loss 함수다. 이는 compute_loss 함수에 있다. 1 - giou 값 = giou loss 이다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">giou</span> <span class="o">=</span> <span class="nf">bbox_iou</span><span class="p">(</span><span class="n">pbox</span><span class="p">.</span><span class="n">T</span><span class="p">,</span> <span class="n">tbox</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x1y1x2y2</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">CIoU</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># giou(prediction, target)
</span><span class="n">lbox</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">giou</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>  <span class="c1"># giou loss
</span></pre></table></code></div></div><p>GIoU 는 general.py 의 bbox_iou 함수에 있다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1"># Intersection area
</span><span class="n">inter</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">b1_x2</span><span class="p">,</span> <span class="n">b2_x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">b1_x1</span><span class="p">,</span> <span class="n">b2_x1</span><span class="p">)).</span><span class="nf">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
	<span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">b1_y2</span><span class="p">,</span> <span class="n">b2_y2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">b1_y1</span><span class="p">,</span> <span class="n">b2_y1</span><span class="p">)).</span><span class="nf">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Union Area
</span><span class="n">w1</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">b1_x2</span> <span class="o">-</span> <span class="n">b1_x1</span><span class="p">,</span> <span class="n">b1_y2</span> <span class="o">-</span> <span class="n">b1_y1</span>
<span class="n">w2</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">b2_x2</span> <span class="o">-</span> <span class="n">b2_x1</span><span class="p">,</span> <span class="n">b2_y2</span> <span class="o">-</span> <span class="n">b2_y1</span>

<span class="n">union</span> <span class="o">=</span> <span class="p">(</span><span class="n">w1</span> <span class="o">*</span> <span class="n">h1</span> <span class="o">+</span> <span class="mf">1e-16</span><span class="p">)</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="n">inter</span>
<span class="n">iou</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">/</span> <span class="n">union</span>  <span class="c1"># iou
</span>
<span class="k">if</span> <span class="n">GIoU</span> <span class="ow">or</span> <span class="n">DIoU</span> <span class="ow">or</span> <span class="n">CIoU</span><span class="p">:</span>
	<span class="n">cw</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">b1_x2</span><span class="p">,</span> <span class="n">b2_x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">b1_x1</span><span class="p">,</span> <span class="n">b2_x1</span><span class="p">)</span>  <span class="c1"># convex (smallest enclosing box) width
</span>	<span class="n">ch</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">b1_y2</span><span class="p">,</span> <span class="n">b2_y2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">b1_y1</span><span class="p">,</span> <span class="n">b2_y1</span><span class="p">)</span>  <span class="c1"># convex height
</span>	<span class="k">if</span> <span class="n">GIoU</span><span class="p">:</span>  <span class="c1"># Generalized IoU https://arxiv.org/pdf/1902.09630.pdf
</span>		<span class="n">c_area</span> <span class="o">=</span> <span class="n">cw</span> <span class="o">*</span> <span class="n">ch</span> <span class="o">+</span> <span class="mf">1e-16</span>  <span class="c1"># convex area
</span>		<span class="k">return</span> <span class="n">iou</span> <span class="o">-</span> <span class="p">(</span><span class="n">c_area</span> <span class="o">-</span> <span class="n">union</span><span class="p">)</span> <span class="o">/</span> <span class="n">c_area</span>  <span class="c1"># GIoU
</span></pre></table></code></div></div><p>최종적으로 giou loss 는 utils/general.py의 compute_loss 함수에 있다.</p><p>(1 - giou 값 = giou loss) 이다.</p><h4 id="obj--objectness-loss-clsclassification-loss">obj ( objectness loss), cls(classification loss) <a href="#obj--objectness-loss-clsclassification-loss" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>objectness loss와 classification loss는 BCEwithLogitsLoss를 사용한다. 이것도 general.py에 있다. BCEwithLogitsLoss는 class가 2개인 경우에 사용하는 loss function인 Binary Cross Entropy 에 sigmoid layer를 추가했다.</p><p>classcification loss는 객체 탐지가 제대로 탐지되었는지에 대한 loss이다. MSE와 유사하게 (판단 값-실제 값)^2 해서 구한다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">cls</span> <span class="o">+=</span> <span class="nc">BCEcls</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:],</span><span class="n">t</span><span class="p">)</span> <span class="c1"># BCE
</span></pre></table></code></div></div><p>objectness loss는 객체 탐지에 대한 loss이다. 객체가 있을 경우의 loss 와 없을 경우의 loss를 따로 구하고, 각 loss에 가중치 값을 곱하여 클래스 불균형 문제를 해결한다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1"># Losses
</span><span class="n">nt</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of targets
</span><span class="n">np</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># number of outputs
</span><span class="n">balance</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>  <span class="c1"># P3-5 or P3-6
</span>       
<span class="n">lobj</span> <span class="o">+=</span> <span class="nc">BCEobj</span><span class="p">(</span><span class="n">pi</span><span class="p">[...,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">tobj</span><span class="p">)</span> <span class="o">*</span> <span class="n">balance</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># obj loss
</span>
</pre></table></code></div></div><h3 id="optimizer">optimizer <a href="#optimizer" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>default 값으로는 SGD, 추가 설정으로 Adam으로 설정이 가능하다.</p><p><br /></p><p><br /></p><h1 id="reference">Reference</h1><ul><li><a href="https://towardsdatascience.com/yolo-v5-is-here-b668ce2a4908">https://towardsdatascience.com/yolo-v5-is-here-b668ce2a4908</a><li><a href="https://blog.roboflow.com/yolov5-is-here/">https://blog.roboflow.com/yolov5-is-here/</a><li><a href="https://bigdata-analyst.tistory.com/194?category=883085">https://bigdata-analyst.tistory.com/194?category=883085</a><li><a href="https://lynnshin.tistory.com/48?category=941325">https://lynnshin.tistory.com/48?category=941325</a><li><a href="https://ropiens.tistory.com/44">https://ropiens.tistory.com/44</a></ul></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/YoloV5/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/YoloV5.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/review/'>Review</a>, <a href='/categories/object-detection/'>Object Detection</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/object-detection/" class="post-tag no-text-decoration" >Object Detection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[논문 리뷰] You Only Look Once v5 - blog - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/YoloV5/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[논문 리뷰] You Only Look Once v5 - blog - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/YoloV5/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/YoloV5/&amp;text=[논문 리뷰] You Only Look Once v5 - blog - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/YoloV5/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[깃허브 프로필 꾸미기] github 프로필 만들기</a><li><a href="/posts/product/">[깃허브 프로필 꾸미기] productive box 만들기</a><li><a href="/posts/regex/">[데브코스] 2주차 - linux 기초(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation 과 StratifiedKFold</a><li><a href="/posts/cmake/">[데브코스] 17주차 - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tusimple/"><div class="card-body"> <em class="timeago small" date="2022-04-29 03:20:00 +0900" >Apr 29, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[논문 리뷰] Ultra Fast Structure-aware Deep Lane Detection</h3><div class="text-muted small"><p> Lane Detection에 대한 논문을 리뷰한 내용입니다. 혼자 공부하기 위해 정리한 내용으로 이해가 안되는 부분들이 많을 거라 생각됩니다. 참고용으로만 봐주세요. Abstract 최근 Lane detection 방법들은 픽셀 단위의 segmentation 기반의 방법으로 다양한 환경과 처리 속도 문제를 해결하기 위해 노력해왔다. 사람의 인지 시...</p></div></div></a></div><div class="card"> <a href="/posts/YoloV5-2/"><div class="card-body"> <em class="timeago small" date="2021-09-06 13:00:00 +0900" >Sep 6, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>You Only Look Once v5 - Github</h3><div class="text-muted small"><p> Train Custom Data https://github.com/ultralytics/yolov5/blob/master/tutorial.ipynb Prepare start 시작 전 환경 설정을 위해 repogitory 를 clone 하고, requiements.txt를 설치한다. 1 2 3 git clone https://github.com/...</p></div></div></a></div><div class="card"> <a href="/posts/MMdetection/"><div class="card-body"> <em class="timeago small" date="2021-12-22 13:00:00 +0900" >Dec 22, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[논문 리뷰] MMDetection: Open MMLab Detection Toolbox and Benchmark</h3><div class="text-muted small"><p> MMDetection에 대한 논문을 리뷰한 내용입니다. 혼자 공부하기 위해 정리한 내용으로 이해가 안되는 부분들이 많을 거라 생각됩니다. 참고용으로만 봐주세요. Abstract mmdetection은 object detection과 instance segmentation을 다루는 유명하고 다양한 모델을 하나의 toolbox로 구현한 일종의 플랫폼이다...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cs231n2/" class="btn btn-outline-primary" prompt="Older"><p>CS231N chapter 2 - Image Classification</p></a> <a href="/posts/YoloV5-2/" class="btn btn-outline-primary" prompt="Newer"><p>You Only Look Once v5 - Github</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>