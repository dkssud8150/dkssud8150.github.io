<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[데브코스] 4주차 - ROS nodes and topics for lidar sensors" /><meta name="author" content="JaeHo YooN" /><meta property="og:locale" content="en" /><meta name="description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><meta property="og:description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><link rel="canonical" href="https://dkssud8150.github.io/posts/lidar1/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/lidar1/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-10T16:14:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[데브코스] 4주차 - ROS nodes and topics for lidar sensors" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo YooN"},"dateModified":"2022-07-29T05:41:26+09:00","datePublished":"2022-03-10T16:14:00+09:00","description":"Do focus on developing ‘your ability’ rather than waste time on making you famous.","headline":"[데브코스] 4주차 - ROS nodes and topics for lidar sensors","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/lidar1/"},"url":"https://dkssud8150.github.io/posts/lidar1/"}</script><title>[데브코스] 4주차 - ROS nodes and topics for lidar sensors | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[데브코스] 4주차 - ROS nodes and topics for lidar sensors </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/dev/week4/day3/lidar.jpeg" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore><h1 data-toc-skip>[데브코스] 4주차 - ROS nodes and topics for lidar sensors</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-03-10 16:14:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Thu, Mar 10, 2022, 4:14 PM +0900" >Mar 10, 2022</em> </span> <span> Updated <em class="timeago" date="2022-07-29 05:41:26 +0900 " data-toggle="tooltip" data-placement="bottom" title="Fri, Jul 29, 2022, 5:41 AM +0900" >Jul 29, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5978 words"> <em>33 min</em> read</span></div></div></div><div class="post-content"><p><br /></p><h1 id="라이다-센서-ros-패키지">라이다 센서 ROS 패키지</h1><p>라이다 센서 ROS 패키지를 xycar_lidar로 만든다. 토픽의 이름은 <code class="language-plaintext highlighter-rouge">/scan</code>으로 할 것이다.</p><p><code class="language-plaintext highlighter-rouge">/scan</code> 토픽안에는</p><ul><li>타입 : sensor_msgs\/LaserScan<li>구성<ul><li>std_msgs/Header header # 시퀀스 번호, 시간, 아이디를 담는다. uid32 seq time stamp string frame_id # rviz에 사용되는 값 float32 angle_min float32 angle_max … float32[] ranges # 장애물까지의 거리 정보들을 담는 array float32[] intensities # 물체의 경도</ul></ul><p><br /></p><h2 id="라이다-거리-정보-화면에-출력">라이다 거리 정보 화면에 출력 <a href="#라이다-거리-정보-화면에-출력" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="패키지-만들기">패키지 만들기 <a href="#패키지-만들기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-markdown highlighter-rouge"><div class="code-header"> <span data-label-text="Markdown"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>xycar_ws
  ⊢ build
  ⊢ devel
  ∟ src
      ∟ my_lidar
          ⊢ launch
              ∟ lidar_scan.launch
          ∟ src
              ∟ lidar_scan.py
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>xycar_ws/src<span class="nv">$ </span>catkin_create_pkg my_lidar std_msgs rospy
</pre></table></code></div></div><h3 id="서브-폴더-만들기">서브 폴더 만들기 <a href="#서브-폴더-만들기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>launch 파일 생성</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mkdir </span>launch
<span class="nv">$ </span>gedit lidar_scan.launch
</pre></table></code></div></div><h3 id="소스파일-만들기">소스파일 만들기 <a href="#소스파일-만들기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>라이다로부터 주변 물체까지의 거리값을 받아 출력한다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="c1"># lidar_scan.py
</span>
<span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">LaserScan</span> <span class="c1"># LaserScan 메시지 사용 준비
</span>
<span class="n">lidar_points</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># 라이다 토픽이 들어오면 실행되는 콜백 함수
</span><span class="k">def</span> <span class="nf">lidar_callback</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">lidar_points</span> 
    <span class="n">lidar_points</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">ranges</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">'my_lidar'</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># lidar 이름의 노드 생성
</span><span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="s">'/scan'</span><span class="p">,</span> <span class="n">LaserScan</span><span class="p">,</span> <span class="n">lidar_callback</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># laserscan 토픽이 오면 콜백함수가 호출되도록 셋팅
</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">lidar_points</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">continue</span>    <span class="c1"># 토픽이 안왔으면 기다려라
</span>
    <span class="n">rtn</span> <span class="o">=</span> <span class="s">''</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span> <span class="c1"># 30도씩 건너뛰면서 12개 거리값만 출력
</span>        <span class="n">rtn</span> <span class="o">+=</span> <span class="nf">str</span><span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="n">lidar_points</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">30</span><span class="p">],</span><span class="s">'.2f'</span><span class="p">))</span> <span class="o">+</span> <span class="s">", "</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">rtn</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="c1"># 천천히 출력
</span></pre></table></code></div></div><ul><li>launch 파일 생성</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- lidar_scan.launch --&gt;</span>
<span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">"$(find xycar_lidar)/launch/lidar_noviewer.launch"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 라이다 장치를 구동시켜 토픽을 발행하는 파일 --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"my lidar"</span> <span class="na">pkg=</span><span class="s">"my_liad"</span> <span class="na">type=</span><span class="s">"lidar_scan.py"</span> <span class="na">output=</span><span class="s">'screen'</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><h3 id="실행">실행 <a href="#실행" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>roslaunch my_lidar lidar_scan.launch
</pre></table></code></div></div><p>출력에서 inf는 무한대로 너무 멀거나 너무 가깝다는 것을 의미한다. 출력된 정보는 거리로 m단위이다. 코드를 짤 때 inf와 같이 오류가 나는 것에 대해서 잘 처리해야 오류가 나지 않게 만들 수 있다.</p><p><br /></p><h2 id="출력-시각화하기">출력 시각화하기 <a href="#출력-시각화하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="패키지-생성">패키지 생성 <a href="#패키지-생성" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>xycar_ws
  ⊢ build
  ⊢ devel
  ∟ src
      ∟ rviz_lidar
          ⊢ launch
              ∟ lidar_3d.launch
          ⊢ src
          ∟ rviz
              ∟ lidar_3d.rviz
</pre></table></code></div></div><p>rviz_lidar라는 이름의 ROS 패키지를 생성한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>catkin_create_pkg rivz_lidar rospy tf geometry_msgs urdf rviz xacro
</pre></table></code></div></div><h3 id="서브-폴더-생성">서브 폴더 생성 <a href="#서브-폴더-생성" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>launch 폴더 만들기<ul><li>lidar_3d.launch 생성</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>  <span class="nt">&lt;launch&gt;</span>
      <span class="c">&lt;!-- rviz display --&gt;</span>
      <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rviz_visualizer"</span> <span class="na">pkg=</span><span class="s">"rviz"</span> <span class="na">type=</span><span class="s">"rviz"</span> <span class="na">required=</span><span class="s">"true"</span>
      <span class="na">args=</span><span class="s">"-d $(find rviz_lidar)/rviz/lidar_3d.rviz"</span><span class="nt">/&gt;</span>

      <span class="c">&lt;!-- c++ 파일을 실행 --&gt;</span>
      <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"xycar_lidar"</span> <span class="na">pkg=</span><span class="s">"xycar_lidar"</span> <span class="na">type=</span><span class="s">"xycar_lidar"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="nt">&gt;</span>
          <span class="c">&lt;!-- 포트 --&gt;</span>
          <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"serial_port"</span>   <span class="na">xype=</span><span class="s">"string"</span>   <span class="na">value=</span><span class="s">"/dev/ttyRPL"</span><span class="nt">/&gt;</span>
          <span class="c">&lt;!-- usb이지만 serial파일로 돌아간다. --&gt;</span>
          <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"serial_baudrate"</span>   <span class="na">xype=</span><span class="s">"int"</span>   <span class="na">value=</span><span class="s">"115200"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"frame_id"</span>   <span class="na">xype=</span><span class="s">"string"</span>   <span class="na">value=</span><span class="s">"laser"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"inverterd"</span>   <span class="na">xype=</span><span class="s">"bool"</span>   <span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"angle_compensate"</span>   <span class="na">xype=</span><span class="s">"bool"</span>   <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/node&gt;</span>
  <span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div></ul><h3 id="-라이다-장치가-없을-경우">+ 라이다 장치가 없을 경우 <a href="#-라이다-장치가-없을-경우" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>그러나 라이다 장치가 없을 경우에는 이를 사용할 수 없을 것이다. 하지만 실제 라이다 장치를 대신하여 /scan 토픽을 발행하는 프로그램을 이용할 수 있다.</p><p>ROS에서 제공하는 <strong>rosbag</strong>를 이용하면 된다. 이는 라이다에서 발행하는 scan 토픽을 저장해놓은 파일로, 그 당시의 시간 간격에 맞추어 scan 토픽을 발행할 수 있다.</p><p><br /></p><p>이 rosbag을 사용할 경우 launch파일을 살짝 수정해야 한다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- lidar_3d_rosbag.launch --&gt;</span>
<span class="nt">&lt;launch&gt;</span>
    <span class="c">&lt;!-- rviz display --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rviz_visualizer"</span> <span class="na">pkg=</span><span class="s">"rviz"</span> <span class="na">type=</span><span class="s">"rviz"</span> <span class="na">required=</span><span class="s">"true"</span>
    <span class="na">args=</span><span class="s">"-d $(find rviz_lidar)/rviz/lidar_3d.rviz"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- c++ 파일을 실행 --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rosbag_play"</span> <span class="na">pkg=</span><span class="s">"rosbag"</span> <span class="na">type=</span><span class="s">"play"</span> <span class="na">output=</span><span class="s">"screen"</span> 
        <span class="na">required=</span><span class="s">"true"</span> <span class="na">args=</span><span class="s">"$(find rviz_lidar)/src/lidar_topic.bag"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><p>더 자세한 건 아래에서 다루겠다.</p><p><br /></p><h3 id="실행-1">실행 <a href="#실행-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>먼저 라이다가 있는 경우를 살펴보자.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>roslaunch rviz_lidar lidar_3d.launch
</pre></table></code></div></div><p>실행을 해도 아직 아무것도 안나온다. 플러그인을 추가해야 한다.</p><ol><li>플러그인 추가<ul><li>우측 displays 탭 하단에 add클릭<li>laserscan 선택 후 ok클릭</ul><li>topic 설정<ul><li>laserscan 에서 topic을 <code class="language-plaintext highlighter-rouge">/scan</code>으로 작성하거나 화살표를 눌러 선택</ul><li>fixed frame<ul><li>displays 탭에서 fixed frame을 laser로 수정<li>이는 header - frame_id 에 해당하는 값임</ul><li>size 설정<ul><li>laserscan에서 size를 설정해야 한다. 0.1 정도로 하면 화면에 잘 보일 것이다.<li>너무 작으면 사이즈를 키우면 된다.</ul></ol><p><br /></p><p><br /></p><h2 id="rosbag">ROSBAG <a href="#rosbag" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="http://wiki.ros.org/rosbag">ros 공식 문서 - rosbag</a></p><p>ROSBAG : ROS 명령어로 토픽을 구독하여 파일로 저장하거나파일에서 토픽을 꺼내 발행하는 기능이다.</p><p>토픽의 내용만 작성하는 것이 아니라 시간도 함께 담아서 꺼낼 때는 시간도 함께 받을 수 있다.</p><h3 id="사용법">사용법 <a href="#사용법" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>터미널에서 실행</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>저장
<span class="nv">$ </span>rosbag record <span class="nt">-O</span> lidar_topic scan

불러오기
<span class="nv">$ </span>rosbag play lidar_topic.bag 
</pre></table></code></div></div><p>lidar_topic은 저장할 파일의 이름이고, scan은 구독해서 저장할 토픽의 이름이다. 토픽은 여러개로 작성 가능하다.</p><p><br /></p><ul><li>런치파일에서 실행</ul><p>node를 선언할 것이다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rosbag_play"</span> <span class="na">pkg=</span><span class="s">"rosbag"</span> <span class="na">type=</span><span class="s">"play"</span> <span class="na">output=</span><span class="s">"screen"</span>
        <span class="na">required=</span><span class="s">"true"</span> <span class="na">args=</span><span class="s">"$(find rviz_lidar)/src/liar_topic.bag"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><p><br /></p><p><br /></p><h2 id="range-데이터를-발행해서-뷰어에-표시해보기">range 데이터를 발행해서 뷰어에 표시해보기 <a href="#range-데이터를-발행해서-뷰어에-표시해보기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>range데이터를 담은 토픽을 발행하는 <code class="language-plaintext highlighter-rouge">lidar_range.py</code>를 만들어서 <code class="language-plaintext highlighter-rouge">/scan1</code> 이름의 토픽을 발행한다.</p><p>range타입의 데이터를 담은 /scan1 /scan2 /scan3 /scan4 총 4개 토픽을 발행한다. RVIZ에서는 원뿔 그림의 Range 거리정보를 시각화하여 표시한다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>xycar_ws
  ⊢ build
  ⊢ devel
  ∟ src
      ∟ rviz_lidar
          ⊢ launch
              ∟ lidar_range.launch
          ⊢ src
              ∟ lidar_range.py
          ∟ rviz
              ∟ lidar_range.rviz
</pre></table></code></div></div><p>기존의 rviz_lidar파일에서 진행할 것이고, 연결 관계는 다음과 같다.</p><p><img data-src="/assets/img/dev/week4/day4/rosbag_con.png" data-proofer-ignore></p><ul><li>노드 이름: lindar_range<li>토픽 이름: /scan1~4<li>메시지 타입: range (from sensor_msgs.msg import Range)</ul><p>publish 노드</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>pub1 = rospy.Publisher('scan1',Range,queue_size=1)
pub2 = rospy.Publisher('scan2',Range,queue_size=1)
pub3 = rospy.Publisher('scan3',Range,queue_size=1)
pub4 = rospy.Publisher('scan4',Range,queue_size=1)
</pre></table></code></div></div><p>하면 순서대로 날아갈 것이다.</p><p>range 타입을 확인하기 위해</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>rosmsg show sensor_msgs/Range
</pre></table></code></div></div><p><img data-src="/assets/img/dev/week4/day4/rangeshow.png" data-proofer-ignore></p><p>더 자세히 보려면 http://docs.ros.org/en/melodic/api/sensor_msgs/html/msg/Range.html 로 가보면 자세히 나온다.</p><p>단순하게 얼만큼 떨어져 있는가에 대한 것으로 부채꼴 모양으로 측정함을 보여준다. 대체로 전파나 음파 등은 부채꼴 모양으로 날아가서 다시 돌아올 것이다.</p><ul><li>header.timestamp: 송신부터 수신까지의 시간을 나타낸 것이다.<li>radiation_type: sound인지 적외선인지 등등의 타입을 나타낸다.<li>field.of_view: 중간을 0으로 기준잡아 반 부채꼴의 각도 (대체로 초음파 센서는 왼/오 각각 15도, 총 30도)<li>min_range/max_range: 이 장치가 감지할 거리의 경계값<li><p>range: 감지한 거리의 값 (-inf(거리가 너무 가까울 떄), +inf(거리가 너무 멀 때))</p><li>lidar_range.py</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env pythonm
</span>
<span class="c1"># range, header import
</span><span class="kn">import</span> <span class="n">serial</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">Range</span>
<span class="kn">from</span> <span class="n">std_msgs</span> <span class="kn">import</span> <span class="n">Header</span>

<span class="c1"># mk node
</span><span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">'lidar_range'</span><span class="p">)</span>

<span class="c1"># mk 4 publisher
</span><span class="n">pub1</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="s">'scan1'</span><span class="p">,</span><span class="n">Range</span><span class="p">,</span><span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pub2</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="s">'scan2'</span><span class="p">,</span><span class="n">Range</span><span class="p">,</span><span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pub3</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="s">'scan3'</span><span class="p">,</span><span class="n">Range</span><span class="p">,</span><span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pub4</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="s">'scan4'</span><span class="p">,</span><span class="n">Range</span><span class="p">,</span><span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="nc">Range</span><span class="p">()</span>
<span class="c1"># fill the range field - header information, required information about range expression of cone shape
</span><span class="n">header</span> <span class="o">=</span> <span class="nc">Header</span><span class="p">()</span>
<span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"sensorXY"</span>
<span class="n">msg</span><span class="p">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
<span class="n">msg</span><span class="p">.</span><span class="n">radiation_type</span> <span class="o">=</span> <span class="nc">Range</span><span class="p">().</span><span class="n">ULTRASOUND</span>
<span class="n">msg</span><span class="p">.</span><span class="n">min_range</span> <span class="o">=</span> <span class="mf">0.02</span>                    <span class="c1"># 2cm
</span><span class="n">msg</span><span class="p">.</span><span class="n">max_range</span> <span class="o">=</span> <span class="mf">2.0</span>                     <span class="c1"># 2m
</span><span class="n">msg</span><span class="p">.</span><span class="n">field_of_view</span> <span class="o">=</span> <span class="p">(</span><span class="mf">30.0</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span><span class="o">*</span><span class="mf">3.14</span>   <span class="c1"># radian expression 1/6 pi
</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
    <span class="n">msg</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>

    <span class="c1"># pushing the distance to the object at msg.range in meters and publishing topic
</span>    <span class="n">msg</span><span class="p">.</span><span class="nb">range</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">pub1</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">msg</span><span class="p">.</span><span class="nb">range</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">pub2</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">msg</span><span class="p">.</span><span class="nb">range</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">pub3</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">msg</span><span class="p">.</span><span class="nb">range</span> <span class="o">=</span> <span class="mf">1.6</span>
    <span class="n">pub4</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>    

    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># slow publish
</span></pre></table></code></div></div><ul><li>lidar_range.launch</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="c">&lt;!-- rviz display --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rviz_visualizer"</span> <span class="na">pkg=</span><span class="s">"rviz"</span> <span class="na">type=</span><span class="s">"rviz"</span> <span class="na">required=</span><span class="s">"true"</span>
        <span class="na">args=</span><span class="s">"-d $(find rviz_lidar)/rviz/lidar_range.rviz"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- implement the python file we just made --&gt;</span>    
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"lidar_range"</span> <span class="na">pkg=</span><span class="s">"rviz_lidar"</span> <span class="na">type=</span><span class="s">"lidar_range.py"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><h3 id="실행-2">실행 <a href="#실행-2" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>roslaunch rviz_lidar lidar_range.launch
</pre></table></code></div></div><h3 id="토픽-내용-확인">토픽 내용 확인 <a href="#토픽-내용-확인" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>그림이 그려지기 전에 토픽이 잘 날아가고 있는지 봐야 한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nv">$ </span>rostopic list
...
/scan1
/scan2
/scan3
/scan4

<span class="nv">$ </span>rostopic <span class="nb">echo </span>scan1
header:
    <span class="nb">seq</span>: 24
    stamp:
        secs: 
        nsecs:
    frame_id: <span class="s2">"sensorXY"</span>
radiation_type: 0
field_of_type: 0.52333
min_range: 0.019999
max_range: 2.0
range: 0.4000
</pre></table></code></div></div><p>다 잘 나오면 된 것이다.</p><h3 id="rviz-설정">RVIZ 설정 <a href="#rviz-설정" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>fixed frame 지정<ul><li>원래는 map으로 되어 있기에 sensorXY로 바꿔야 한다.</ul><li>plugin 추가<ul><li>display 하단에 add 누르고 by topic 탭에서 /scan - range가 있다. 이를 누르고 ok</ul><li>토픽 이름 확인<ul><li>수신할 토픽이 잘 되어 있는지 확인</ul><li>생상 확인<ul><li>color 지정에서 자신이 원하는 색상 클릭</ul></ol><p>4개 모두 선택될 경우 겹쳐서 표시될 수 있어 확인이 어려울 수 있다.</p><p><br /></p><h2 id="라이다와-융합하여-시각화">라이다와 융합하여 시각화 <a href="#라이다와-융합하여-시각화" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>rosbag파일에서 토픽(/scan)을 발행하여 lidar_urdf.py로 받아지고, 이를 정제하여 4개의 토픽을 발행함으로써 rviz로 전달되게 한다.</p><p>1.파이썬 파일(lidar_urdf.py)</p><p>LaserScan 타입의 데이터를 Range 타입으로 변경해야 한다. /scan 토픽을 받아 scan1, scan2, scan3, scan4, 4개의 토픽으로 발행</p><p><img data-src="/assets/img/dev/week4/day4/laserrange.png" data-proofer-ignore></p><p><br /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">serial</span>
<span class="p">...</span>

<span class="k">def</span> <span class="nf">lidar_callback</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">lidar_points</span>
    <span class="n">lidar_points</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">ranges</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">"lidar"</span><span class="p">)</span>
<span class="p">...</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
    <span class="p">...</span>
    <span class="n">h</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"front"</span>
    <span class="n">msg</span><span class="p">.</span><span class="nb">range</span> <span class="o">=</span> <span class="n">lidar_points</span><span class="p">[</span><span class="mi">90</span><span class="p">]</span> <span class="c1"># 북을 전방을 두었을 때 이쪽이 0도 이므로, front는 3시방향이르모 90
</span>    <span class="p">...</span>

    <span class="n">h</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"back"</span>
    <span class="n">msg</span><span class="p">.</span><span class="nb">range</span> <span class="o">=</span> <span class="n">lidar_points</span><span class="p">[</span><span class="mi">270</span><span class="p">]</span> <span class="c1"># 9시방향이므로 270
</span></pre></table></code></div></div><blockquote><p>🎈 중요한 것은 frame_id의 이름과 urdf의 블록의 이름을 일치시켜야 한다.</p></blockquote><p><br /></p><p>2.URDF 모델링 파일(lidar_urdf.urdf)</p><p>중앙에 빨간색 박스를 만들고, 4방향에서 센서 프레임을 연결한다.</p><ul><li>base_link에 가로세로 20cm, red박스 baseplate를 만들어 연결<li>센서는 x,y, 축을 기준으로 중심에서 10cm씩 이동시켜서 박스의 끝부분에 배치</ul><p><br /></p><p>중앙 박스의 크기는 가로x세로x높이 = 0.2m x 0.2m x 0.07m</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"baseplate_to_front"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0.1 0 0"</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- xyz에서 연결위치는 중심에서 x축으로 10cm이동 --&gt;</span>
<span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"baseplate_to_back"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"back"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 3.14"</span> <span class="na">xyz=</span><span class="s">"-0.1 0 0"</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- xyz에서 연결위치는 중심에서 x축으로 -10cm이동, 방향은 z축을 기준으로 pi만큼 돌아야 한다. --&gt;</span>
</pre></table></code></div></div><div class="language-markdown highlighter-rouge"><div class="code-header"> <span data-label-text="Markdown"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>link - base_link -<span class="se">\&gt;</span> joint - base_link_to_baseplate -<span class="se">\&gt;</span> link - baseplate  -<span class="se">\&gt;</span> joint - baseplate_to_front -<span class="se">\&gt;</span> link - front 
                                                                          -<span class="se">\&gt;</span> joint - baseplate_to_back -<span class="se">\&gt;</span> link - back
</pre></table></code></div></div><p><br /></p><p>3.RVIZ 설정 파일(lidar_urdf.rviz)</p><p>rviz 프로그램에 들어가서 add -&gt; 4개의 range타입을 추가</p><p><br /></p><p>4.런치 파일(lidar_urdf.launch)</p><ul><li>박스 형상을 위한 모델링 파일(lidar_urdf.urdf)<li>RVIZ 설정 파일(lidar_urdf.rviz)<li>라이다 토픽 발행(lidar_topic.bag)<li>rosbag파일 실행(<code class="language-plaintext highlighter-rouge">&lt;node pkg="rosbag" type="play" output="screen" ... args="$(find rviz_lidar)/src/lidar_topic.bag"/&gt;</code>)<li>토픽 변환(lidar_urdf.py)</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- lidar_urdf.launch --&gt;</span>
<span class="nt">&lt;launch&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><p><br /></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>roslaunch rviz_lidar lidar_urdf.launch
</pre></table></code></div></div><p>이를 실행하면 원뿔들이 물체와의 거리에 따라 짧아졌다 길어졌다 한다.</p><p><br /></p><p><br /></p><h1 id="초음파-센서-ros-패키지">초음파 센서 ROS 패키지</h1><p>초음파 센서 : 장애물까지의 거리를 초음파를 송수신해서 알려주는 센서다.</p><p><img data-src="/assets/img/dev/week4/day4/ultrasonic.jpg" data-proofer-ignore></p><p><br /></p><p>초음파센서는 아두이노를 거쳐서 프로세스와 연결된다. 노드로 이 둘 사이를 통신한다.</p><p>my_ultra이름의 패키지를 생성할 것이고, 토픽의 이름은 /ultra으로 생성할 것이다.</p><p>토픽의 내용</p><ul><li>타입: sensor_msgs/Int32MultiArray<li>구성<ul><li>std_msgs/MultiArrayLayout layout<ul><li>std_msgs/MultiArrayDimension[] dim<li>string label<li>uint32 size<li>uint32 stride<li>unit32 data_offset</ul><li>int32[] data</ul></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>xycar_ws
  ⊢ build
  ⊢ devel
  ∟ src
      ∟ my_ultra
          ⊢ launch
              ∟ ultra_scan.launch
          ∟ src
              ∟ ultra_scan.py
</pre></table></code></div></div><h3 id="패키지-생성-1">패키지 생성 <a href="#패키지-생성-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>my_ultra 이름의 패키지 생성 / 서브 폴더 생성</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>xycar_ws/src<span class="nv">$ </span>caktin_create_pkg my_ultra std_msgs rospy
xycar_ws/src<span class="nv">$ </span><span class="nb">mkdir </span>launch
xycar_ws/src<span class="nv">$ </span><span class="nb">cd </span>launch
xycar_ws/src/launch<span class="nv">$ </span>gedit ultra_scan.launch
xycar_ws/src<span class="nv">$ </span><span class="nb">cd</span> ../src
</pre></table></code></div></div><ul><li>ultra_scan.py</ul><p>초음파센서로부터 주변 물체까지의 거리값을 받아 출력하는 코드다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="c1"># prepare using Int32MultiArray msg
</span><span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Int32MultiArray</span>

<span class="c1"># storage space
</span><span class="n">ultra_msg</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># define the callback function to implement, if the topic of ultrasound come in
</span><span class="k">def</span> <span class="nf">ultra_callback</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">ultra_msg</span>
    <span class="n">ultra_msg</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span>

<span class="c1"># mk node
</span><span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">"ultra_node"</span><span class="p">)</span>
<span class="c1"># define subcriber to receive msg type of Int32MultiArray
</span><span class="n">rospy</span><span class="p">.</span><span class="nc">Subcriber</span><span class="p">(</span><span class="s">"xycar_ultrasonic"</span><span class="p">,</span> <span class="n">Int32MultiArray</span><span class="p">,</span> <span class="n">ultra_callback</span><span class="p">)</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">ultra_msg</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">continue</span>
    
    <span class="c1"># print ultrasound data    
</span>    <span class="nf">print</span><span class="p">(</span><span class="n">ultra_msg</span><span class="p">)</span>

    <span class="c1"># sleep 0.5s
</span>    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></table></code></div></div><ul><li>ultra_scan.launch</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="c">&lt;!-- make ultrasonic device run --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"xycar_ultrasonic"</span> <span class="na">type=</span><span class="s">"xycar_ultrasonic.py"</span>
        <span class="na">name=</span><span class="s">"xycar_ultrasonic"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="nt">/&gt;</span>
    
    <span class="c">&lt;!-- implement file we just made --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"my_ultra"</span> <span class="na">type=</span><span class="s">"ultra_scan.py"</span> <span class="na">name=</span><span class="s">"my_ultra"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><h3 id="실행-3">실행 <a href="#실행-3" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>roslaunch my_ultra ultra_scan.launch
</pre></table></code></div></div><p>총 8개의 정보가 들어올 것이다. 이는 운전석을 0을 기준으로 시계방향으로 번호를 매긴다.</p><p><br /></p><h2 id="초음파-센서와-아두이노를-사용하여-ros-패키지-제작">초음파 센서와 아두이노를 사용하여 ROS 패키지 제작 <a href="#초음파-센서와-아두이노를-사용하여-ros-패키지-제작" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="초음파센서-ros-패키지">초음파센서 ROS 패키지 <a href="#초음파센서-ros-패키지" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>초음파센서를 제어하여 물체까지의 거리를 알아내고 그 정보를 ros 토픽으로 만들어 노드들에게 보낸다.</p><ol><li>초음파 센서<ul><li>물체로 초음파를 쏘고, 반사된 초음파 신호를 감지<li>처음 초음파를 쏜 시점과 반사파를 수신한 시점을 표시한 전기 신호인 펄스(pulse) 신호를 아두이노로 보냄</ul><li>아두이노<ul><li>초음파센서가 보내준 펄스신호를 받아 분석<li>초음파를 쏜 시점과 반사파를 받은 시점 사이의 시간차를 이용해서 물체까지의 거리를 계산하고 이를 ros에 알려준다.<li>serial 통신으로 ros에 보낸다. 간단하고 다른 소프트웨어 필요없이 보낼 수 있다.</ul></ol><blockquote><p>이처럼 작은 보드에서 돌아가는 소프트웨어를 펌웨어라 한다. 대체로 c언어로 개발되어 있다.</p></blockquote><ol><li>ros<ul><li>아두이노가 보내준 물체까지의 거리정보를 사용하기 좋은 형태로 적절히 가공<li>그것을 ROS 토픽에 담아 그게 필요한 노드들에게 Publish<li>header나 1:n, n:n 등의 방법을 구현하면 된다.</ul></ol><p><br /></p><h3 id="제작을-위한-1단계---하드웨어를-이해하자">제작을 위한 1단계 - 하드웨어를 이해하자 <a href="#제작을-위한-1단계---하드웨어를-이해하자" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>초음파 (ultrasonic wave)</p><ul><li>인간의 귀가 들을 수 있는 가청 주파수 대역보다 높은 진동수로 발생하는 파동<li>가청 진동수는 사람마다 다르지만 약 20Hz~20kHz</ul><p><img data-src="/assets/img/dev/week4/day3/wave.jpg" data-proofer-ignore></p><ul><li>초음파 센서는 초음파를 이용하여 센서로부터 사물까지의 직선거리를 측정한다.</ul><p>초음파센서</p><ul><li>물체로 초음파를 쏘고 반사된 초음파 신호를 감지<li>처음 초음파를 쏜 시점부터 반사파를 수신한 시점을 표시한 pulse 신호를 아두이노에게 보냄</ul><p><br /></p><h3 id="제작을-위한-2단계---아두이노를-이해하자">제작을 위한 2단계 - 아두이노를 이해하자 <a href="#제작을-위한-2단계---아두이노를-이해하자" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>아두이노</p><ul><li>컴퓨터가 다 알아서 할만큼 좋은 성능이라면 사용하지 않아도 된다.<li>초음파센서가 pulse 신호를 받아 분석<li>초음파를 쏜 시점과 반사파를 받은 시점의 시간차이를 이용해서 물체까지의 거리를 계산하고 이를 ROS에 알린다.</ul><p><img data-src="/assets/img/dev/week4/day4/aduino.png" data-proofer-ignore></p><p>각 센서의 Vcc,Trig,Echo,Gnd 를 각 핀에 연결한다.</p><ul><li>Vcc : 5V<li>Trig : D2<ul><li>아두이노 입장에서 D2는 받는 것</ul><li>Echo : D3<ul><li>아두이노 입장에서 D3는 내보내는 것</ul><li>Gnd : GND</ul><p><img data-src="/assets/img/dev/week4/day4/aduino_sonic.png" data-proofer-ignore></p><p>아두이노의 펌웨어를 개발하는 IDE가 존재한다. 아두이노 코드 작성할 때나 제작된 펌웨어를 아두이노에 적을 때 사용한다.</p><p><a href="https://www.arduino.cc/en/software">다운로드 링크</a></p><p>다운로드를 한 후 압축을 풀어 안에 있는 install.sh를 실행시키면 된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo</span> ~/Downloads/Arduino-1.8.19-linux64/arduino-1.8.19/install.sh
Adding desktop shortcut, menu item and file associations <span class="k">for </span>Arduino IDE ...
</pre></table></code></div></div><p>그 다음 실행</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>arduino
</pre></table></code></div></div><p>실행이 되면 <code class="language-plaintext highlighter-rouge">ultrasonic_1_fw.ino</code> 파일을 작성한다.</p><p>이 파일의 내용은 구글링하면 나온다.</p><p>소스 코드 (초음파센서가 보내는 신호로부터 거리정보 추출)</p><pre><code class="language-arduino">/*
HL-340 초음파 센서 아두이노 펌웨어
*/

#define trig 2 // 트리거 핀 선언
#define echo 3 // 에코 핀 선언

void setup()
{
    Serial.begin(9600);     // 통신속도 9600bps로 시리얼 통신 시작
    pinMode(trig, OUTPUT);  // 트리거 핀을 출력으로 선언
    pinMode(echo, INPUT);   // 에코핀을 입력으로 선선
}

void loop() {
    long duration, distance;    // 거리 측정을 위한 변수 선언
    // 트리거 핀으로 10us 동안 펄스 출력
    digitalWrite(trig, LOW);    // Trig 핀 Low
    delayMicroseconds(2);       // 2us 딜레이
    digitalWrite(trig, HIGH);   // Trig 핀 High
    delayMicroseconds(10);      // 2us 딜레이
    digitalWrite(trig, LOW);    // Trig 핀 Low

    // pulseln() 함수는 핀에서 펄스 신호를 읽어서 마이크로초 단위로 반환
    duration = pulseIn(echo, HIGH);
    distance = duration * 170 / 1000;   // 왕복시간이므로 340/2=170 곱하는걸로 계산, 마이크로초를 mm로 변환하기 위해 1000나눔
    Serial.print("Distance(mm): ");
    Serial.println(distance);           // 거리정보를 시리얼 모니터에 출력
    delay(100);
}
</code></pre><p><br /></p><p>아두이노가 pc에 연결되었는지를 확인해봐야 한다. 이를 위해</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>lsusb
Bus 004 Device 002: ID 0bc2:231a Seagate RSS LLC 
Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 003 Device 006: ID 2b7e:0134  
Bus 003 Device 005: ID 04e8:730b Samsung Electronics Co., Ltd 
Bus 003 Device 011: ID 04d9:1836 Holtek Semiconductor, Inc. 
Bus 003 Device 016: ID 1a86:7523 QinHeng Electronics HL-340 USB-Serial adapter
</pre></table></code></div></div><p>리스트 중에 자신의 장치 번호를 찾는다. 나의 경우 HL-340 이다.</p><blockquote><p>아두이노와 pc가 물리적으로 USB케이블로 연결되어 있으나 내부적으로는 serial통신이 이루어지고 있다. 따라서 이에 맞게 serial통신으로 맞춰서 짜야 한다. 이를 <strong>Serial over USB</strong>라 한다.</p></blockquote><p><br /></p><p>출력이 되었다면 하드웨어적으로는 통신이 되고 있다는 것이다. 그렇다면 아두이노에서 연결이 되고 있는지도 확인해봐야 한다.</p><p>tool 메뉴에서 board/ processor / port 확인</p><ol><li>board : arduion Nano<li>processor : ATmega328P<li>Port : /dev/ttyUSB0 또는 /dev/ttyACM0</ol><p>이것을 잘 선택하면 상단에 v(체크)를 눌러 디버깅이 가능해진다. 그 후 잘 동작되면 옆에 화살표를 클릭하면 코드를 펌웨어에 업로드 할 수 있다.</p><p>그 후 값이 어떤지 보려면 <code class="language-plaintext highlighter-rouge">tools -&gt; serial monitor</code>에 들아가면 출력이 될 것이다.</p><p><img data-src="/assets/img/dev/week4/day4/aduino_print.png" data-proofer-ignore></p><p><br /></p><h3 id="제작을-위한-3단계---리눅스-프로그래밍이-필요하다">제작을 위한 3단계 - 리눅스 프로그래밍이 필요하다. <a href="#제작을-위한-3단계---리눅스-프로그래밍이-필요하다" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>리눅스 ROS</p><ul><li>아두이노가 보내주는 물체까지의 거리정보를 사용하기 좋은 형태로 적절히 가공<li>ROS토픽에 담아 필요한 노드들에게 Publish</ul><p><br /></p><ul><li>패키지 생성</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>xycar_ws
  ⊢ build
  ⊢ devel
  ∟ src
      ∟ ultrasonic
          ⊢ launch
              ∟ ultra.launch
          ∟ src
              ⊢ ultrasonic_sub.py
              ∟ ultrasonic_pub.py
</pre></table></code></div></div><p><br /></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>패키지 생성
<span class="nv">$ </span>catkin_create_pkg ultrasonic std_msgs rospy

launch 파일 생성
ultrasonic<span class="nv">$ </span><span class="nb">mkdir </span>launch

새로만든 패키지 빌드
<span class="nv">$ </span>cm
</pre></table></code></div></div><p><br /></p><ul><li>소스코드 생성 (ultrasonic_pub.py)</ul><p>초음파센서가 보낸 거리정보를 토픽에 담아 publishing</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">serial</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Int32</span>

<span class="n">ser_front</span> <span class="o">=</span> <span class="n">serial</span><span class="p">.</span><span class="nc">Serial</span><span class="p">(</span> 
    <span class="n">port</span><span class="o">=</span><span class="s">'/dev/ttyUSB0'</span><span class="p">,</span> <span class="c1"># 아두이노가 연결된 포트
</span>    <span class="n">baudrate</span><span class="o">=</span><span class="mi">9600</span><span class="p">,</span>       <span class="c1"># 아두이노에서 선언한 통신 속도
</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">read_sensor</span><span class="p">():</span>
    <span class="n">serial_data</span> <span class="o">=</span> <span class="n">ser_front</span><span class="p">.</span><span class="nf">readline</span><span class="p">()</span> <span class="c1"># 시리얼 포트로 들어온 데이터를 받아옴
</span>    <span class="n">ser_front</span><span class="p">.</span><span class="nf">flushInput</span><span class="p">()</span>  <span class="c1"># 중간에 버퍼들이 있어서 그를 삭제해주는 flush
</span>    <span class="n">ser_front</span><span class="p">.</span><span class="nf">flushOutput</span><span class="p">()</span>
    <span class="n">ultrasonic_data</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="nb">str</span><span class="p">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">serial_data</span><span class="p">))</span> <span class="c1"># string을 숫자로 변환
</span>    <span class="n">msg</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ultrasonic_data</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">'ultrasonic_pub'</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="s">'ultrasonic'</span><span class="p">,</span> <span class="n">Int32</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="nc">Int32</span><span class="p">()</span>
    
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
        <span class="nf">read_sensor</span><span class="p">()</span> <span class="c1"># 시리얼포트에서 센서가 보내준 문자열 읽엇거 거리 정보 추출
</span>        <span class="n">pub</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>    
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># 토픽에 담아서 publish
</span>
    <span class="n">ser_front</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span> <span class="c1"># 끝나면 시리얼포트 닫기
</span></pre></table></code></div></div><ul><li>추가로 검증용으로 사용할 subscriber 노드도 생성 (ultrasonic_sub.py)</ul><p>publish의 메시지를 받아 출력한다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Int32</span>

<span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">'ultrasonic_sub'</span><span class="p">)</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="s">'ultrasonic'</span><span class="p">,</span> <span class="n">Int32</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">spin</span><span class="p">()</span>
</pre></table></code></div></div><ul><li>실행을 위한 launch 파일 만들기</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- ultra.launch --&gt;</span>
<span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"ultrasonic"</span> <span class="na">type=</span><span class="s">"ultrasonic_pub.py"</span> <span class="na">name=</span><span class="s">"ultrasonic_pub"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"ultrasonic"</span> <span class="na">type=</span><span class="s">"ultrasonic_sub.py"</span> <span class="na">name=</span><span class="s">"ultrasonic_sub"</span> <span class="na">output=</span><span class="s">"screen"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><p><br /></p><ul><li>실행</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>roslaunch ultrasonic ultra.launch
</pre></table></code></div></div><p>실행하면 초음파센서의 데이터가 숫자만 출력하게 될 것이다.</p><p><br /></p><h3 id="초음파-센서-4개를-지원하는-ros-패키지-제작하기">초음파 센서 4개를 지원하는 ROS 패키지 제작하기 <a href="#초음파-센서-4개를-지원하는-ros-패키지-제작하기" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>초음파센서 4개를 프로세서보드로 연결해야 한다. 그러려면 펌웨어(아두이노)를 조정하고, ROS관점에서는 4개의 방향이 있으므로 4개를 발행해줘야 한다.</p><p>노드는 <code class="language-plaintext highlighter-rouge">/ultra4_pub</code>로 하고, 토픽은 <code class="language-plaintext highlighter-rouge">/ultra4</code>, 메시지 타입은 <code class="language-plaintext highlighter-rouge">Int32MultiArray</code>로 한다.</p><p><br /></p><p>ultrasoinc_fw.ino를 수정하여 <code class="language-plaintext highlighter-rouge">ultrasonic_4_fw.ino</code> 파일 작성한다. 각 센서의 Vcc,Trig,Echo,Gnd를 각 핀에 연결한다. 각 센서를 연결하여 5V, Gnd를 아두이노 보드에 연결하고, 나머지는 각각 아두이노 보드에 연결한다.</p><p>거리정보는 <code class="language-plaintext highlighter-rouge">300mm 121mm 186mm 67mm</code> 의 형태로 4개를 전송한다.</p><p><br /></p><p>기존에 사용했던 ultrasonic 패키지를 사용하여 <code class="language-plaintext highlighter-rouge">ultra4.launch</code>, <code class="language-plaintext highlighter-rouge">ultra4_pub.py</code>, <code class="language-plaintext highlighter-rouge">ultra4_sub.py</code> , 3개의 파일을 생성한다.</p><ul><li>ultra4_pub.py</ul><p>초음파 센서가 보낸 거리정보를 토픽에 담아 publishing한다</p><ol><li>아두이노가 연결된 포트 지정 (usb 포트는 리눅스가 관리하기에 리눅스에게 요청)<li>def read_sensor() 생성(시리얼 데이터 한번에 문자열로 받아오고 문자열에서 숫자 4개를 추출하여 리스트에 담는다.)<li>main함수 (ultra4_pub 노드 생성, ultra4 토픽 발행, while문(아두이노에게 정보를 받아와서 토픽안에 잘 채워넣어 토픽을 발행), 시리얼을 닫고 정리)</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">Serial</span>
<span class="p">...</span>

<span class="n">FRONT</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">ser_front</span> <span class="o">=</span> <span class="n">serial</span><span class="p">.</span><span class="nc">Serial</span><span class="p">(</span>  <span class="c1"># 아두이노가 연결된 포트 지정
</span>    <span class="n">port</span><span class="o">=</span><span class="s">'/dev/ttyUSB0'</span><span class="p">,</span>
    <span class="n">baudrate</span><span class="o">=</span><span class="mi">9600</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">read_sensor</span><span class="p">():</span>
    <span class="n">sersor_data</span> <span class="o">=</span> <span class="n">ser_front</span><span class="p">.</span><span class="nf">readline</span><span class="p">()</span>
    <span class="n">ser_front</span><span class="p">.</span><span class="nf">flushInput</span><span class="p">()</span>
    <span class="n">ser_front</span><span class="p">.</span><span class="nf">flushOutput</span><span class="p">()</span>
    <span class="n">FRONT</span> <span class="o">=</span> <span class="nf">read_Sdata</span><span class="p">(</span><span class="n">sensor_data</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">FRONT</span>

<span class="k">def</span> <span class="nf">read_Ssdata</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
    <span class="n">s_data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">"mm"</span><span class="p">)</span>
    <span class="n">s_data</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">s_data</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">s_data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">s_data</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="p">...</span>
    <span class="n">ser_front</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><ul><li>ultra4_sub.py</ul><p>publisher의 메시지를 받아 출력한다.</p><ol><li>토픽에서 데이터를 꺼내서 출력<li>ultra4_sub 노드 생성<li>ultra4 토픽 구독 준비<li>ultra4 토픽을 받으면 callback 호출<li>무한 루프</ol><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Int32</span>

<span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">'ultrasonic_sub'</span><span class="p">)</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="s">'ultrasonic'</span><span class="p">,</span> <span class="n">Int32</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">spin</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><ul><li>ultra4.launch</ul><ol><li>토픽의 발행자 실행<li>토픽의 구독자 실행</ol><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"ultrasonic"</span> <span class="na">type=</span><span class="s">"ultrasonic_pub.py"</span> <span class="na">name=</span><span class="s">"ultrasonic_pub"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"ultrasonic"</span> <span class="na">type=</span><span class="s">"ultrasonic_sub.py"</span> <span class="na">name=</span><span class="s">"ultrasonic_sub"</span> <span class="na">output=</span><span class="s">"screen"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span> 
</pre></table></code></div></div><p><br /></p><p>실행</p><ol><li>연결 확인</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>lsusb
~~~~~~ HL-340 USB~~~
</pre></table></code></div></div><ol><li>펌웨어 프로그래밍</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>arduino
</pre></table></code></div></div><ol><li>아두이노가 연결된 리눅스 포트 확인</ol><p>tools메뉴에서 Board/Processor Port를 체크해야 한다.</p><ul><li>board : Arduino Nano<li>Processor : Atmega328P<li>Port : /dev/ttyUSB0 or /dev/ttyACM0</ul><ol><li>아두이노 펌웨어 소스코드</ol><p>초음파센서가 보내는 신호로부터 거리정보를 추출하는 소스코드다.</p><pre><code class="language-arduino">int trig[4] = {2,4,6,8}; // 센서를 꼽았던 포트 번호
int echo[4] = {3,5,7,9}; //
int i=0;

void setup() {
    Serial.begin(9600);
    for(i=0;i&lt;4;i++) {
        pinMode(trig[i],OUTPUT);    // TRIG 핀을 출력모드로 세팅
        pinMode(echo[i], INPUT);    // ECHO 핀을 입력모드로 세팅
    }
}

void loop() {
    long dur[4]={0.0,};
    long dist[4]={0.0,};

    for(i=0; i&lt;4; i++) {
        digitalWrite(trig[i],LOW);
        delayMicroseconds(2);
        digitalWrite(trig[i],HIGH);         // trig 신호를 high 상태로 변경
        delayMicroseconds(10);              // 10마이크로초 대기
        digitalWrite(trig[i],LOW);          // Trig 신호를 low 상태로 변경

        dur[i] = pulseIn(echo[i],HIGH);     // Echo 펄스에서 왕복시간을 계산해서 저장
        dist[i] = dur[i]*170/1000;          // 시간을 이동거리로 환산해서 저장
        if(dist[i]&gt;=2000 || dist[i]&lt;0) {    // 거리가 200cm이상이거나 0보다 작으면 0으로 설정
            dist[i]=0;
        }
    }

    Serial.print(dist[0]); //dist[0] 출력
    Serial.print("mm ");
    Serial.print(dist[1]);
    Serial.print("mm ");
    Serial.print(dist[2]);
    Serial.print("mm ");
    Serial.print(dist[3]);
    Serial.print("mm ");

    delay(50);
}
</code></pre><ol><li>컴파일 &amp; 업로드</ol><p>컴파일 및 업로드를 진행한다.</p><ol><li>결과 확인</ol><p>시리얼 모니터를 이용해서 아두이노의 출력값을 확인할 수 있다. tools -&gt; serial Monitor</p><ol><li>실행</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>roslaunch ultrasonic ultra4.launch
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/lidar1/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/lidar1.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/classlog/'>Classlog</a>, <a href='/categories/devcourse/'>devcourse</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ros/" class="post-tag no-text-decoration" >ros</a> <a href="/tags/urdf/" class="post-tag no-text-decoration" >urdf</a> <a href="/tags/rviz/" class="post-tag no-text-decoration" >rviz</a> <a href="/tags/devcourse/" class="post-tag no-text-decoration" >devcourse</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[데브코스] 4주차 - ROS nodes and topics for lidar sensors - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/lidar1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[데브코스] 4주차 - ROS nodes and topics for lidar sensors - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/lidar1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/lidar1/&amp;text=[데브코스] 4주차 - ROS nodes and topics for lidar sensors - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/lidar1/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[깃허브 프로필 꾸미기] github 프로필 만들기</a><li><a href="/posts/product/">[깃허브 프로필 꾸미기] productive box 만들기</a><li><a href="/posts/regex/">[데브코스] 2주차 - linux 기초(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation 과 StratifiedKFold</a><li><a href="/posts/cmake/">[데브코스] 17주차 - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/sensordriving/"><div class="card-body"> <em class="timeago small" date="2022-03-11 16:14:00 +0900" >Mar 11, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 4주차 - ROS Self-driving using sensors</h3><div class="text-muted small"><p> 라이다를 통한 장애물 회피 lidar_drive 패키지를 사용 lidar_gostop.py , lidar_gostop.launch 1 2 3 4 5 6 &amp;lt;!-- lidar_gostop.launch --&amp;gt; &amp;lt;launch&amp;gt; &amp;lt;include file=&quot;$(find xycar_motor)/launch/xyc...</p></div></div></a></div><div class="card"> <a href="/posts/rviz/"><div class="card-body"> <em class="timeago small" date="2022-03-08 19:00:00 +0900" >Mar 8, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 4주차 - ROS auto driving using Sensor</h3><div class="text-muted small"><p> RVIZ 기반 오도메트리 활용 odometry 오도미터(odometry): 차량이나 로봇이 주행하며 이동한 거리를 측정하는 기기 오도메트리(odomerty): 오도미터 등의 기기의 측정값으로 움직이는 사물의 위치를 측정하는 방법 자동차의 이동거리는 바퀴의 회전수로 계산한다. 핸들을 꺽을 때 앞 바퀴 두개가 서로 다르다. 이유...</p></div></div></a></div><div class="card"> <a href="/posts/urdf/"><div class="card-body"> <em class="timeago small" date="2022-03-10 01:47:00 +0900" >Mar 10, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 4주차 - ROS 3d modeling of Car based on urdf</h3><div class="text-muted small"><p> URDF란? URDF (Unified Robot Description Format) 란 로봇의 3D 형상 및 외관, 관성 등 물리적 특성 등을 XML 언어로 정의하는 것을 말한다. URDF로 정의된 로봇 모델은 RVIZ에서 3차원으로 보거나 Gazebo에서 물리 시뮬레이션이 가능하다. URDF 좌표계 및 단위 좌표계 위치나 크기를...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/urdf/" class="btn btn-outline-primary" prompt="Older"><p>[데브코스] 4주차 - ROS 3d modeling of Car based on urdf</p></a> <a href="/posts/filter/" class="btn btn-outline-primary" prompt="Newer"><p>[데브코스] 4주차 - Understanding and Using Filters</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>