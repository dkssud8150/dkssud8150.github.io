<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ" /><meta name="author" content="JaeHo YooN" /><meta property="og:locale" content="en" /><meta name="description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><meta property="og:description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><link rel="canonical" href="https://dkssud8150.github.io/posts/rvizsensorfusion/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/rvizsensorfusion/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-10T22:14:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo YooN"},"dateModified":"2022-05-02T16:15:21+09:00","datePublished":"2022-03-10T22:14:00+09:00","description":"Do focus on developing ‘your ability’ rather than waste time on making you famous.","headline":"[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/rvizsensorfusion/"},"url":"https://dkssud8150.github.io/posts/rvizsensorfusion/"}</script><title>[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/dev/week4/day4/sensorfusion.png" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore><h1 data-toc-skip>[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-03-10 22:14:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Thu, Mar 10, 2022, 10:14 PM +0900" >Mar 10, 2022</em> </span> <span> Updated <em class="timeago" date="2022-05-02 16:15:21 +0900 " data-toggle="tooltip" data-placement="bottom" title="Mon, May 2, 2022, 4:15 PM +0900" >May 2, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1829 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p><br /></p><h1 id="rviz에서-모터와-센서-통합하기">RVIZ에서 모터와 센서 통합하기</h1><p>RVIZ 가상공간에서 8자 주행하는 자이카에 라이다 센서와 IMU센서의 뷰어를 통합해본다. 3D 모델링된 차량이 8자 주행을 하면서 주변 장애물가지의 거리값을 Range로 표시하고 IMU 센싱값에 따라 차체가 기울어지도록 한다.</p><p><img data-src="/assets/img/dev/week4/day4/2022-03-18-00-39-22.png" alt="" data-proofer-ignore></p><ol><li>driver노드 -&gt; /xycar_motor토픽 -&gt; converter노드 -&gt; /joint_states -&gt; RVIZ viewer, rviz_odom 노드 -&gt; /odom 토픽 -&gt; rviz<li>lidar_topic.bag -&gt; rosbag -&gt; /scan 토픽 -&gt; lidar_urdf.py 파이썬 -&gt; scan1~4 토픽 4개 -&gt; rviz<li>imu_data.txt -&gt; imu_data_generator 노드 -&gt; /imu 토픽 -&gt; rviz</ol><p>odom노드는 imu토픽과 joint_states 토픽을 받아서 /odom 토픽을 발행해야 한다.</p><p><br /></p><p><br /></p><ol><li>패키지 이름 : rviz_all<li>urdf 파일 : rviz_all.urdf -&gt; xycar_3d.urdf + lidar_urdf.urdf<li>rviz 파일 : rviz_all.rviz -&gt; rviz_odom.rviz 복사<li>python 파일 : odom_imu.py<ul><li>rviz_odom.py를 수정, imu 토픽을 구독하여 획득한 쿼터니언 값을 odometry 데이터에 넣어준다.<li>odometry정보를 차체에 해당하는 base_link에 연결, imu값에 따라 차체가 움직이게 한다.</ul><li>launch 파일 : rviz_all.launch<ul><li>urdf, rviz, robot_state_publisher는 기본적으로 작성<li>노드 실행</ul><ul><li>자동차 8자 주행 : odom_8_drive.py, odom_imu.py, converter.py<li>라이다 토픽 발행 : rosbag, lidar_urdf.py<li>IMU 토픽 발행 : imu_generator.py</ul></ol><p><br /></p><p><br /></p><h2 id="1-패키지-제작">1. 패키지 제작 <a href="#1-패키지-제작" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>catkin_create_pkg rviz_all rospy tf geometry_msgs urdf rviz xacro
<span class="nv">$ </span>cm
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mkdir </span>rviz_all/launch rviz_all/urdf rviz_all/rviz
</pre></table></code></div></div><p><br /></p><h2 id="2-rviz_allurdf">2. rviz_all.urdf <a href="#2-rviz_allurdf" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>기존의 파일을 수정할 것이다.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" ?&gt;</span>
<span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">"xycar"</span> <span class="na">xmlns:xacro=</span><span class="s">"http://www.ros.org/wiki/xacro"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"base_link"</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!-- baselink =&gt; baseplate --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"baseplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"acrylic"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">"0.5 0.2 0.07"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>

  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"base_link_to_baseplate"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"base_link"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>


  <span class="c">&lt;!-- baseplate =&gt; front_mount --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"front_mount"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"blue"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"-0.105 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">"0.5 0.12 0.01"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>

  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"baseplate_to_front_mount"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front_mount"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0.105 0 -0.059"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>

  <span class="c">&lt;!-- lidar data --&gt;</span>
  <span class="c">&lt;!-- front --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"front"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"baseplate_to_front"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0.25 0 0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>

  <span class="c">&lt;!-- back --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"back"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"baseplate_to_back"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"back"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 3.14"</span> <span class="na">xyz=</span><span class="s">"-0.25 0 0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>

  <span class="c">&lt;!-- left --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"left"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"baseplate_to_left"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"left"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 1.57"</span> <span class="na">xyz=</span><span class="s">"0 0.1 0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>

  <span class="c">&lt;!-- right --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"right"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"baseplate_to_right"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"baseplate"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"right"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 -1.57"</span> <span class="na">xyz=</span><span class="s">"0 -0.1 0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>


  <span class="c">&lt;!-- 차체 --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"front_shaft"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"black"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"1.57 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">"0.285"</span> <span class="na">radius=</span><span class="s">"0.018"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"front_mount_to_front_shaft"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"front_mount"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front_shaft"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0.105 0 -0.059"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>


  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"rear_shaft"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"black"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"1.57 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">"0.285"</span> <span class="na">radius=</span><span class="s">"0.018"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"rear_mount_to_rear_shaft"</span> <span class="na">type=</span><span class="s">"fixed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"front_mount"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"rear_shaft"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"-0.305 0 -0.059"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>
  

  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"front_right_hinge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"white"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;sphere</span> <span class="na">radius=</span><span class="s">"0.015"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"front_right_hinge_joint"</span> <span class="na">type=</span><span class="s">"revolute"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"front_shaft"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front_right_hinge"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 -0.1425 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 0 1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">lower=</span><span class="s">"-0.34"</span> <span class="na">upper=</span><span class="s">"0.34"</span> <span class="na">velocity=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>


  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"front_left_hinge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"white"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;sphere</span> <span class="na">radius=</span><span class="s">"0.015"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"front_left_hinge_joint"</span> <span class="na">type=</span><span class="s">"revolute"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"front_shaft"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front_left_hinge"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0.1425 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 0 1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">lower=</span><span class="s">"-0.34"</span> <span class="na">upper=</span><span class="s">"0.34"</span> <span class="na">velocity=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>


  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"front_right_wheel"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"black"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"1.57 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">"0.064"</span> <span class="na">radius=</span><span class="s">"0.07"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"front_right_wheel_joint"</span> <span class="na">type=</span><span class="s">"continuous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"front_right_hinge"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front_right_wheel"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 1 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">velocity=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>


  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"front_left_wheel"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"black"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"1.57 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">"0.064"</span> <span class="na">radius=</span><span class="s">"0.07"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"front_left_wheel_joint"</span> <span class="na">type=</span><span class="s">"continuous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"front_left_hinge"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"front_left_wheel"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 1 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">velocity=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>

  
  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"rear_right_wheel"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"black"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"1.57 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">"0.064"</span> <span class="na">radius=</span><span class="s">"0.07"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"rear_right_wheel_joint"</span> <span class="na">type=</span><span class="s">"continuous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"rear_shaft"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"rear_right_wheel"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 -0.14 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 1 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">velocity=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>


  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">"rear_left_wheel"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"black"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"1.57 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;geometry&gt;</span>
        <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">"0.064"</span> <span class="na">radius=</span><span class="s">"0.07"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;/link&gt;</span>
  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"rear_left_wheel_joint"</span> <span class="na">type=</span><span class="s">"continuous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"rear_shaft"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"rear_left_wheel"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span> <span class="na">xyz=</span><span class="s">"0 0.14 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 1 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">velocity=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/joint&gt;</span>

  <span class="c">&lt;!-- 색상 정보 --&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"black"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"0.0 0.0 0.0 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"blue"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"0.0 0.0 0.8 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"green"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"0.0 0.8 0.0 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"grey"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"0.2 0.2 0.2 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"orange"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"1.0 0.423529411765 0.0392156862745 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"brown"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"0.870588235294 0.811764705882 0.764705882353 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"red"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"0.8 0.0 0.0 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"white"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"1.0 1.0 1.0 1.0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">"acrylic"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">"1.0 1.0 1.0 0.4"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/material&gt;</span>
<span class="nt">&lt;/robot&gt;</span>
</pre></table></code></div></div><p><br /></p><h2 id="3-rviz_allrviz">3. rviz_all.rviz <a href="#3-rviz_allrviz" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>이는 설정파일이므로 rviz로 들어가서 수정하면 되는데, 다른 rviz파일을 복사해서 수정하면 편하다.</p><ul><li>라이다센서의 시각화에 쓰이는 <code class="language-plaintext highlighter-rouge">Range</code> 설정<li>by_topic에서 scan1,2,3,4 에 대한 <code class="language-plaintext highlighter-rouge">Range</code> 설정<li>궤적 표시를 위해 <code class="language-plaintext highlighter-rouge">odometry</code> 추가<ul><li>topic = /odom 입력<li>keep = 100<li>shaft length = 0.05<li>head length = 0.1</ul></ul><p><code class="language-plaintext highlighter-rouge">save</code>하고 나간다.</p><p><br /></p><h2 id="4-rviz_alllaunch">4. rviz_all.launch <a href="#4-rviz_alllaunch" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">textfile=</span><span class="s">"$(find rviz_all)/urdf/rviz_all.urdf"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"use_gui"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rviz_visualizer"</span> <span class="na">pkg=</span><span class="s">"rviz"</span> <span class="na">type=</span><span class="s">"rviz"</span> <span class="na">required=</span><span class="s">"true"</span>
    <span class="na">args=</span><span class="s">"-d $(find rviz_all)/rviz/rviz_all.rviz"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"robot_state_publisher"</span> <span class="na">pkg=</span><span class="s">"robot_state_publisher"</span> <span class="na">type=</span><span class="s">"state_publisher"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"driver"</span> <span class="na">pkg=</span><span class="s">"rviz_xycar"</span> <span class="na">type=</span><span class="s">"odom_8_drive.py"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"odometry"</span> <span class="na">pkg=</span><span class="s">"rviz_xycar"</span> <span class="na">type=</span><span class="s">"rviz_odom.py"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"converter"</span> <span class="na">pkg=</span><span class="s">"rviz_xycar"</span> <span class="na">type=</span><span class="s">"converter.py"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rosbag_play"</span> <span class="na">pkg=</span><span class="s">"rosbag"</span> <span class="na">type=</span><span class="s">"play"</span> <span class="na">output=</span><span class="s">"screen"</span> 
        <span class="na">required=</span><span class="s">"true"</span> <span class="na">args=</span><span class="s">"$(find rviz_lidar)/src/lidar_topic.bag"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"lidar"</span> <span class="na">pkg=</span><span class="s">"rviz_lidar"</span> <span class="na">type=</span><span class="s">"lidar_urdf.py"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"imu"</span> <span class="na">pkg=</span><span class="s">"rviz_imu"</span> <span class="na">type=</span><span class="s">"imu_generator.py"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div><p><br /></p><h2 id="5-odom_imupy">5. odom_imu.py <a href="#5-odom_imupy" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>imu데이터를 차량의 odometry에 적용한다. odometry 데이터를 생성하는 rviz_odom.py를 수정하여 odom_imu를 제작한다. imu토픽을 구독하여 획득한 쿼터니언 값을 odometry 데이터에 넣는다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">math</span><span class="p">,</span> <span class="n">rospy</span><span class="p">,</span> <span class="n">tf</span>
<span class="kn">from</span> <span class="n">nav_msgs.msg</span> <span class="kn">import</span> <span class="n">Odometry</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">,</span> <span class="n">Twist</span><span class="p">,</span> <span class="n">Vector3</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">JointState</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">Imu</span>




<span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">Angle</span>
    <span class="n">Angle</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">position</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="s">"front_left_hinge_joint"</span><span class="p">)]</span>

<span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="s">'joint_states'</span><span class="p">,</span> <span class="n">JointState</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">callback_imu</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">Imudata</span>
    <span class="n">Imudata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span>
    <span class="n">Imudata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span>
    <span class="n">Imudata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span>
    <span class="n">Imudata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span>    

<span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="s">'imu'</span><span class="p">,</span> <span class="n">Imu</span><span class="p">,</span> <span class="n">callback_imu</span><span class="p">)</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="s">"odometry_publisher"</span><span class="p">)</span>

<span class="n">odom_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="s">"odom"</span><span class="p">,</span> <span class="n">Odometry</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">odom_broadcaster</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nc">TransformBroadcaster</span><span class="p">()</span>

<span class="n">cur_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
<span class="n">prv_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>

<span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Rate</span><span class="p">(</span><span class="mf">30.0</span><span class="p">)</span>

<span class="n">cur_speed</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">wheel_base</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">yaw</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Angle</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
    <span class="n">cur_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> 
    <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur_time</span> <span class="o">-</span> <span class="n">prv_time</span><span class="p">).</span><span class="nf">to_sec</span><span class="p">()</span>

    <span class="n">cur_steering_ang</span> <span class="o">=</span> <span class="n">Angle</span>
    <span class="n">cur_angluar_velocity</span> <span class="o">=</span> <span class="n">cur_speed</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">tan</span><span class="p">(</span><span class="n">cur_steering_ang</span><span class="p">)</span> <span class="o">/</span> <span class="n">wheel_base</span>

    <span class="n">x_dot</span> <span class="o">=</span> <span class="n">cur_speed</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">yaw</span><span class="p">)</span>
    <span class="n">y_dot</span> <span class="o">=</span> <span class="n">cur_speed</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">yaw</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">x_dot</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">y</span> <span class="o">+=</span> <span class="n">y_dot</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">yaw</span> <span class="o">+=</span> <span class="n">cur_angluar_velocity</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="n">odom_quat</span> <span class="o">=</span> <span class="n">Imudata</span>

    <span class="n">odom_broadcaster</span><span class="p">.</span><span class="nf">sendTransform</span><span class="p">(</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">odom_quat</span><span class="p">,</span>
        <span class="n">cur_time</span><span class="p">,</span>
        <span class="s">"base_link"</span><span class="p">,</span>
        <span class="s">"odom"</span>
    <span class="p">)</span>   

    <span class="n">odom</span> <span class="o">=</span> <span class="nc">Odometry</span><span class="p">()</span>
    <span class="n">odom</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">cur_time</span>
    <span class="n">odom</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"odom"</span>
    
    <span class="n">odom</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span> <span class="o">=</span> <span class="nc">Pose</span><span class="p">(</span><span class="nc">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nc">Quaternion</span><span class="p">(</span><span class="o">*</span><span class="n">odom_quat</span><span class="p">))</span>
    <span class="n">odom</span><span class="p">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="s">"base_link"</span>
    <span class="n">odom_pub</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">odom</span><span class="p">)</span>

    <span class="n">prv_time</span> <span class="o">=</span> <span class="n">cur_time</span>
    <span class="n">rate</span><span class="p">.</span><span class="nf">sleep</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><h2 id="실행-결과">실행 결과 <a href="#실행-결과" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>roslaunch rviz_all rviz_all.launch
</pre></table></code></div></div><p><br /></p><p><img data-src="/assets/img/dev/week4/day4/rviz_all_frame.png" data-proofer-ignore></p><p>이 그림은 urdf의 구성도이다. 어떻게 연결되었는지 볼 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>rosrun tf view_frames
</pre></table></code></div></div><p>이 식을 실행하면 구성도를 pdf로 추출해준다.</p><p><br /></p><p><img data-src="/assets/img/dev/week4/day4/rviz_all_rviz.png" data-proofer-ignore></p><p>이는 실행한 rviz화면이다. 8자 주행을 하고 있고, lidar 센서를 통해 얻은 거리 정보를 활용하여 원뿔 모양이 나타나고 있으며, Imu 센서를 통해 얻은 기울기 정보를 활용하여 차체가 기울기가 어떻게 되고 있는지를 볼 수 있다.</p><p><br /></p><p><img data-src="/assets/img/dev/week4/day4/rviz_all_rqtgraph.png" data-proofer-ignore></p><p>이는 rqt_graph이다.</p></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/rvizsensorfusion/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/rvizsensorfusion.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/classlog/'>Classlog</a>, <a href='/categories/devcourse/'>devcourse</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ros/" class="post-tag no-text-decoration" >ros</a> <a href="/tags/rviz/" class="post-tag no-text-decoration" >rviz</a> <a href="/tags/sensor/" class="post-tag no-text-decoration" >sensor</a> <a href="/tags/devcourse/" class="post-tag no-text-decoration" >devcourse</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/rvizsensorfusion/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/rvizsensorfusion/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/rvizsensorfusion/&amp;text=[데브코스] 4주차 - ROS Motor and sensor integration in RVIZ - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/rvizsensorfusion/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[깃허브 프로필 꾸미기] github 프로필 만들기</a><li><a href="/posts/product/">[깃허브 프로필 꾸미기] productive box 만들기</a><li><a href="/posts/regex/">[데브코스] 2주차 - linux 기초(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation 과 StratifiedKFold</a><li><a href="/posts/cmake/">[데브코스] 17주차 - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/rviz/"><div class="card-body"> <em class="timeago small" date="2022-03-08 19:00:00 +0900" >Mar 8, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 4주차 - ROS auto driving using Sensor</h3><div class="text-muted small"><p> RVIZ 기반 오도메트리 활용 odometry 오도미터(odometry): 차량이나 로봇이 주행하며 이동한 거리를 측정하는 기기 오도메트리(odomerty): 오도미터 등의 기기의 측정값으로 움직이는 사물의 위치를 측정하는 방법 자동차의 이동거리는 바퀴의 회전수로 계산한다. 핸들을 꺽을 때 앞 바퀴 두개가 서로 다르다. 이유...</p></div></div></a></div><div class="card"> <a href="/posts/sensor2/"><div class="card-body"> <em class="timeago small" date="2022-03-09 16:00:00 +0900" >Mar 9, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 4주차 - ROS Sensor devices</h3><div class="text-muted small"><p> 센서장치 카메라 센서 IMU 센서 라이다 센서 초음파 센서 Depth 카메라 센서 카메라 센서 1080P USB 카메라 170도 어안렌즈 -&amp;gt; 화면이 휘어지지만 openCV 툴을 사용하여 펼 수 있다. CMOS OV2710 Sensor (C...</p></div></div></a></div><div class="card"> <a href="/posts/lidar1/"><div class="card-body"> <em class="timeago small" date="2022-03-10 16:14:00 +0900" >Mar 10, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 4주차 - ROS nodes and topics for lidar sensors</h3><div class="text-muted small"><p> 라이다 센서 ROS 패키지 라이다 센서 ROS 패키지를 xycar_lidar로 만든다. 토픽의 이름은 /scan으로 할 것이다. /scan 토픽안에는 타입 : sensor_msgs\/LaserScan 구성 std_msgs/Header header # 시퀀스 번호, 시간, 아이디를 담는다. uid32 seq ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/filter/" class="btn btn-outline-primary" prompt="Older"><p>[데브코스] 4주차 - Understanding and Using Filters</p></a> <a href="/posts/sensordriving/" class="btn btn-outline-primary" prompt="Newer"><p>[데브코스] 4주차 - ROS Self-driving using sensors</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>