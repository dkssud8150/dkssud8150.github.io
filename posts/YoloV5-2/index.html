<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="You Only Look Once v5 - Github" /><meta name="author" content="JaeHo-YooN" /><meta property="og:locale" content="en" /><meta name="description" content="Train Custom Data" /><meta property="og:description" content="Train Custom Data" /><link rel="canonical" href="https://dkssud8150.github.io/posts/YoloV5-2/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/YoloV5-2/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-06T13:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="You Only Look Once v5 - Github" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo-YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo-YooN"},"dateModified":"2022-04-06T13:18:24+09:00","datePublished":"2021-09-06T13:00:00+09:00","description":"Train Custom Data","headline":"You Only Look Once v5 - Github","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/YoloV5-2/"},"url":"https://dkssud8150.github.io/posts/YoloV5-2/"}</script><title>You Only Look Once v5 - Github | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>You Only Look Once v5 - Github</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>You Only Look Once v5 - Github</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo-YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-09-06 13:00:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Mon, Sep 6, 2021, 1:00 PM +0900" >Sep 6, 2021</em> </span> <span> Updated <em class="timeago" date="2022-04-06 13:18:24 +0900 " data-toggle="tooltip" data-placement="bottom" title="Wed, Apr 6, 2022, 1:18 PM +0900" >Apr 6, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4038 words"> <em>22 min</em> read</span></div></div></div><div class="post-content"><h2 id="train-custom-data"><a href="https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data">Train Custom Data</a> <a href="#train-custom-data" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>https://github.com/ultralytics/yolov5/blob/master/tutorial.ipynb</p><h3 id="prepare-start">Prepare start <a href="#prepare-start" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>ì‹œì‘ ì „ í™˜ê²½ ì„¤ì •ì„ ìœ„í•´ repogitory ë¥¼ clone í•˜ê³ , requiements.txtë¥¼ ì„¤ì¹˜í•œë‹¤.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>git clone https://github.com/ultralytics/yolov5
<span class="nb">cd </span>yolov5
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</pre></table></code></div></div><h3 id="train-on-custom-data">Train on Custom Data <a href="#train-on-custom-data" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>COCO128 Dataset ì„ ì‚¬ìš©í•  ê²ƒì´ë‹¤. ì´ëŠ” ì´ 128ê°œì˜ classë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤.</ol><p><a href="https://github.com/ultralytics/yolov5/blob/master/data/coco128.yaml">data/coco128.yaml</a> ì€ <code class="language-plaintext highlighter-rouge">path</code> ë¥¼ í†µí•´ dataset root ë¥¼ ì„¤ì •, <code class="language-plaintext highlighter-rouge">train</code>/<code class="language-plaintext highlighter-rouge">val</code>/<code class="language-plaintext highlighter-rouge">test</code> image directories(txt file about image paths) ì„¤ì •, number of classes , <code class="language-plaintext highlighter-rouge">nc</code>ì™€ <code class="language-plaintext highlighter-rouge">class names</code> ì„¤ì •</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1"># Train/val/test sets as 1) dir: path/to/imgs, 2) file: path/to/imgs.txt, or 3) list: [path/to/imgs1, path/to/imgs2, ..]</span>
<span class="na">path</span><span class="pi">:</span> <span class="s">../datasets/coco128</span>  <span class="c1"># dataset root dir</span>
<span class="na">train</span><span class="pi">:</span> <span class="s">images/train2017</span>  <span class="c1"># train images (relative to 'path') 128 images</span>
<span class="na">val</span><span class="pi">:</span> <span class="s">images/train2017</span>  <span class="c1"># val images (relative to 'path') 128 images</span>
<span class="na">test</span><span class="pi">:</span>  <span class="c1"># test images (optional)</span>

<span class="c1"># Classes</span>
<span class="na">nc</span><span class="pi">:</span> <span class="m">80</span>  <span class="c1"># number of classes</span>
<span class="na">names</span><span class="pi">:</span> <span class="pi">[</span> <span class="s1">'</span><span class="s">person'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bicycle'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">car'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">motorcycle'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">airplane'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bus'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">train'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">truck'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">boat'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">traffic</span><span class="nv"> </span><span class="s">light'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">fire</span><span class="nv"> </span><span class="s">hydrant'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">stop</span><span class="nv"> </span><span class="s">sign'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">parking</span><span class="nv"> </span><span class="s">meter'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bench'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bird'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cat'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">dog'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">horse'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">sheep'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cow'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">elephant'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bear'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">zebra'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">giraffe'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">backpack'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">umbrella'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">handbag'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">tie'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">suitcase'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">frisbee'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">skis'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">snowboard'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">sports</span><span class="nv"> </span><span class="s">ball'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">kite'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">baseball</span><span class="nv"> </span><span class="s">bat'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">baseball</span><span class="nv"> </span><span class="s">glove'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">skateboard'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">surfboard'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">tennis</span><span class="nv"> </span><span class="s">racket'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bottle'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">wine</span><span class="nv"> </span><span class="s">glass'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cup'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">fork'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">knife'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">spoon'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bowl'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">banana'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">apple'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">sandwich'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">orange'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">broccoli'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">carrot'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">hot</span><span class="nv"> </span><span class="s">dog'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">pizza'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">donut'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cake'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">chair'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">couch'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">potted</span><span class="nv"> </span><span class="s">plant'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">bed'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">dining</span><span class="nv"> </span><span class="s">table'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">toilet'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">tv'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">laptop'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">mouse'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">remote'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">keyboard'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cell</span><span class="nv"> </span><span class="s">phone'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">microwave'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">oven'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">toaster'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">sink'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">refrigerator'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">book'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">clock'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">vase'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">scissors'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">teddy</span><span class="nv"> </span><span class="s">bear'</span><span class="pi">,</span>
         <span class="s1">'</span><span class="s">hair</span><span class="nv"> </span><span class="s">drier'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">toothbrush'</span> <span class="pi">]</span>  <span class="c1"># class names</span>
</pre></table></code></div></div><ol><li>Create Labels</ol><p><a href="https://github.com/openvinotoolkit/cvat">CVAT</a> ë‚˜ <a href="https://www.makesense.ai/">makesense.ai</a> ì—ì„œ íˆ´ì„ ì‚¬ìš©í•˜ì—¬ coco set ì—ì„œ yolo format ìœ¼ë¡œ ë³€í™˜ì‹œì¼œì¤˜ì•¼ í•œë‹¤.</p><ol><li>Organize Directories</ol><p><img data-src="/assets/img/2021-09-05/dir.png" alt="Full-width image" data-proofer-ignore></p><p>yolov5/data directoryì— <code class="language-plaintext highlighter-rouge">image</code> ì™€ <code class="language-plaintext highlighter-rouge">label</code> í´ë”ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— ê°ê° <code class="language-plaintext highlighter-rouge">train</code> ê³¼ <code class="language-plaintext highlighter-rouge">val</code> í´ë”ë¥¼ ë” ë§Œë“ ë‹¤.</p><p>ê·¸ë¦¬ê³  ë‹¤ìš´ë°›ì€ coco íŒŒì¼ë“¤ì„ imageì™€ labelì„ train ê³¼ valì— ì ì ˆíˆ ë¶„ë¦¬í•˜ì—¬ ë„£ëŠ”ë‹¤.</p><ol><li>Select a Model</ol><p>yolov5 ì˜ 4ê°€ì§€ ì¢…ë¥˜ ì¤‘ ì ì ˆí•œ ëª¨ë¸ì„ ì„ íƒí•œë‹¤. sì˜ ê²½ìš° ê°€ì¥ ì‘ê³ , ë¹ ë¥´ë‹¤.</p><ol><li>train</ol><p>coco128.yaml, yolov5.pt íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ yolov5s ëª¨ë¸ì„ í›ˆë ¨ì‹œí‚¨ë‹¤.</p><p>coco128.yamlì˜ ê²½ìš° ì´ë¯¸ì§€ì™€ ë¼ë²¨ì„ yolo formatìœ¼ë¡œ ë³€í™˜í•´ì•¼ ì‘ë™ëœë‹¤.</p><p>yolov5.ptëŠ” ë¯¸ë¦¬ í›ˆë ¨ëœ pretrained weights ì´ë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># Train YOLOv5s on COCO128 for 3 epochs</span>
<span class="nv">$ </span>python train.py <span class="nt">--img</span> 640 <span class="nt">--batch</span> 16 <span class="nt">--epochs</span> 3 <span class="nt">--data</span> coco128.yaml <span class="nt">--weights</span> yolov5s.pt <span class="nt">--cache</span>
</pre></table></code></div></div><p>â€“cache ëŠ” ë¬´ì—‡ì¸ê°€</p><h3 id="inference">Inference <a href="#inference" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">weights</code> = yolov5s.pt</p><p><code class="language-plaintext highlighter-rouge">conf</code> = confidenceë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°’ì´ë‹¤.</p><p><code class="language-plaintext highlighter-rouge">source</code> = data/images/</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">!</span>python detect.py <span class="nt">--weights</span> yolov5s.pt <span class="nt">--img</span> 640 <span class="nt">--conf</span> 0.25 <span class="nt">--source</span> data/images/Image<span class="o">(</span><span class="nv">filename</span><span class="o">=</span><span class="s1">'runs/detect/exp/zidane.jpg'</span>, <span class="nv">width</span><span class="o">=</span>600<span class="o">)</span>
</pre></table></code></div></div><h3 id="validate">Validate <a href="#validate" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Coco val2017 dataset ì„ í™œìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¸ë‹¤.</p><p><code class="language-plaintext highlighter-rouge">data</code> ëŠ” coco.yaml</p><p><code class="language-plaintext highlighter-rouge">weights</code> ëŠ” yolov5.pt</p><p><code class="language-plaintext highlighter-rouge">iou</code> ëŠ” 0.65</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># Download COCO val2017</span>
torch.hub.download_url_to_file<span class="o">(</span><span class="s1">'https://github.com/ultralytics/yolov5/releases/download/v1.0/coco2017val.zip'</span>, <span class="s1">'tmp.zip'</span><span class="o">)</span>

<span class="o">!</span>unzip <span class="nt">-q</span> tmp.zip <span class="nt">-d</span> ../datasets <span class="o">&amp;&amp;</span> <span class="nb">rm </span>tmp.zip


<span class="c"># Run YOLOv5x on COCO val2017</span>
<span class="o">!</span>python val.py <span class="nt">--weights</span> yolov5x.pt <span class="nt">--data</span> coco.yaml <span class="nt">--img</span> 640 <span class="nt">--iou</span> 0.65 <span class="nt">--half</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">half</code> ëŠ” deviceì˜ í•œ ì¢…ë¥˜ë¡œ halfê°€ ìˆë‹¤ë©´ cpu ëŒ€ì‹  ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p><h3 id="test">Test <a href="#test" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>coco test2017 datasetì„ ë‹¤ìš´ë°›ì•„ ì‹¤í–‰í•œë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># Download COCO test-dev2017</span>
torch.hub.download_url_to_file<span class="o">(</span><span class="s1">'https://github.com/ultralytics/yolov5/releases/download/v1.0/coco2017labels.zip'</span>, <span class="s1">'tmp.zip'</span><span class="o">)</span>
<span class="o">!</span>unzip <span class="nt">-q</span> tmp.zip <span class="nt">-d</span> ../ <span class="o">&amp;&amp;</span> <span class="nb">rm </span>tmp.zip <span class="c"># unzip labels</span>
<span class="o">!</span><span class="nv">f</span><span class="o">=</span><span class="s2">"test2017.zip"</span> <span class="o">&amp;&amp;</span> curl http://images.cocodataset.org/zips/<span class="nv">$f</span> <span class="nt">-o</span> <span class="nv">$f</span> <span class="o">&amp;&amp;</span> unzip <span class="nt">-q</span> <span class="nv">$f</span> <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nv">$f</span>  <span class="c"># 7GB,  41k images</span>
%mv ./test2017 ../coco/images  <span class="c"># move to /coco</span>

<span class="c"># Run YOLOv5s on COCO test-dev2017 using --task test</span>
<span class="o">!</span>python val.py <span class="nt">--weights</span> yolov5s.pt <span class="nt">--data</span> coco.yaml <span class="nt">--task</span> <span class="nb">test</span>
</pre></table></code></div></div><p><br /></p><p><br /></p><h2 id="load-from-pytorch-hub"><a href="https://github.com/ultralytics/yolov5/issues/36">Load From Pytorch Hub</a> <a href="#load-from-pytorch-hub" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>ğŸ“š ì—¬ê¸°ì„œëŠ” Pytorch Hub(https://pytorch.org/hub/ultralytics_yolov5) ì—ì„œ yolov5 ğŸš€ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•œë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">torch</span>
<span class="kn">from</span> <span class="n">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="c1"># Model
</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">)</span>

<span class="c1"># Images
</span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'zidane.jpg'</span><span class="p">,</span> <span class="s">'bus.jpg'</span><span class="p">]:</span>
    <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">download_url_to_file</span><span class="p">(</span><span class="s">'https://ultralytics.com/images/'</span> <span class="o">+</span> <span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>  <span class="c1"># download 2 images
</span><span class="n">img1</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s">'zidane.jpg'</span><span class="p">)</span>  <span class="c1"># PIL image
</span><span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'bus.jpg'</span><span class="p">)[...,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># OpenCV image (BGR to RGB)
</span><span class="n">imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">img1</span><span class="p">,</span> <span class="n">img2</span><span class="p">]</span>  <span class="c1"># batch of images
</span>
<span class="c1"># Inference
</span><span class="n">results</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">imgs</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">640</span><span class="p">)</span>  <span class="c1"># includes NMS
</span>
<span class="c1"># Results
</span><span class="n">results</span><span class="p">.</span><span class="nf">print</span><span class="p">()</span>  
<span class="n">results</span><span class="p">.</span><span class="nf">save</span><span class="p">()</span>  <span class="c1"># or .show()
</span>
<span class="n">results</span><span class="p">.</span><span class="n">xyxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># img1 predictions (tensor)
</span><span class="n">results</span><span class="p">.</span><span class="nf">pandas</span><span class="p">().</span><span class="n">xyxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># img1 predictions (pandas)
#      xmin    ymin    xmax   ymax  confidence  class    name
# 0  749.50   43.50  1148.0  704.5    0.874023      0  person
# 1  433.50  433.50   517.5  714.5    0.687988     27     tie
# 2  114.75  195.75  1095.0  708.0    0.624512      0  person
# 3  986.00  304.00  1028.0  420.0    0.286865     27     tie
</span></pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">## default Model ì „ì²´ architecture
</span><span class="k">class</span> <span class="nc">AutoShape</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="c1"># YOLOv5 input-robust model wrapper for passing cv2/np/PIL/torch inputs. Includes preprocessing, inference and NMS
</span>    <span class="n">conf</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># NMS confidence threshold
</span>    <span class="n">iou</span> <span class="o">=</span> <span class="mf">0.45</span>  <span class="c1"># NMS IoU threshold
</span>    <span class="n">classes</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># (optional list) filter by class
</span>    <span class="n">max_det</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># maximum number of detections per image
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">autoshape</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">LOGGER</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s">'AutoShape already enabled, skipping... '</span><span class="p">)</span>  <span class="c1"># model already converted to model.autoshape()
</span>        <span class="k">return</span> <span class="n">self</span>

    <span class="nd">@torch.no_grad</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c1"># Inference from various sources. For height=640, width=1280, RGB images example inputs are:
</span>        <span class="c1">#   file:       imgs = 'data/images/zidane.jpg'  # str or PosixPath
</span>        <span class="c1">#   URI:             = 'https://ultralytics.com/images/zidane.jpg'
</span>        <span class="c1">#   OpenCV:          = cv2.imread('image.jpg')[:,:,::-1]  # HWC BGR to RGB x(640,1280,3)
</span>        <span class="c1">#   PIL:             = Image.open('image.jpg') or ImageGrab.grab()  # HWC x(640,1280,3)
</span>        <span class="c1">#   numpy:           = np.zeros((640,1280,3))  # HWC
</span>        <span class="c1">#   torch:           = torch.zeros(16,3,320,640)  # BCHW (scaled to size=640, 0-1 values)
</span>        <span class="c1">#   multiple:        = [Image.open('image1.jpg'), Image.open('image2.jpg'), ...]  # list of images
</span></pre></table></code></div></div><p>default modelì„ ë¶„ì„í•´ë³´ì.</p><p>inference ë¥¼ ìœ„í•œ hyperparameters setting ì„ í•œë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">model</span><span class="p">.</span><span class="n">conf</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># confidence threshold (0-1)
</span><span class="n">model</span><span class="p">.</span><span class="n">iou</span> <span class="o">=</span> <span class="mf">0.45</span>  <span class="c1"># NMS IoU threshold (0-1)
</span><span class="n">model</span><span class="p">.</span><span class="n">classes</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># (optional list) filter by class, i.e. = [0, 15, 16] for persons, cats and dogs
</span>
<span class="n">results</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">imgs</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">320</span><span class="p">)</span>  <span class="c1"># custom inference size
</span></pre></table></code></div></div><h3 id="input-channel">input channel <a href="#input-channel" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>pretrained yolov5 model ì˜ <code class="language-plaintext highlighter-rouge">input channel</code>=4 ë¡œ ë³€ê²½í•˜ë ¤ë©´</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></table></code></div></div><p>ì´ ê²½ìš°, pretrained output layersê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” output layers ë¥¼ ì œì™¸í•œ pretrained weights ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. output layersëŠ” ramdom weights ë¡œ ì´ˆê¸°í™” ëœë‹¤. <br /></p><h3 id="number-of-classes">number of classes <a href="#number-of-classes" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>ë˜, nc, <code class="language-plaintext highlighter-rouge">number of classes</code>=10ìœ¼ë¡œ ì„¤ì •í•˜ë ¤ë©´</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></table></code></div></div><p>ì´ ê²½ìš°ì—ë„ ë§ˆì°¬ê°€ì§€ë¡œ, pretrained output layersê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” output layers ë¥¼ ì œì™¸í•œ pretrained weights ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. output layersëŠ” ramdom weights ë¡œ ì´ˆê¸°í™” ëœë‹¤.</p><p><br /></p><h3 id="force-reload">force reload <a href="#force-reload" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>ìœ„ì˜ ë‘ ê°€ì§€ ë°©ë²•ì—ì„œ ë¬¸ì œê°€ ìƒê¸´ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">force_reload=True</code> ë¥¼ í†µí•´ ê¸°ì¡´ ìºì‹œë¥¼ ì‚­ì œí•˜ê³  pytorch hubì—ì„œ ìµœì‹  yolov5 ë²„ì „ì„ ìƒˆë¡œ ë‹¤ìš´í•  ìˆ˜ ìˆë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">,</span> <span class="n">force_reload</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># force reload
</span></pre></table></code></div></div><p><br /></p><h3 id="screenshot">screenshot <a href="#screenshot" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>desktop screenshot ì—ì„œ inference ë¥¼ í•˜ë ¤ë©´</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">torch</span>
<span class="kn">from</span> <span class="n">PIL</span> <span class="kn">import</span> <span class="n">ImageGrab</span>

<span class="c1"># Model
</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">)</span>

<span class="c1"># Image
</span><span class="n">img</span> <span class="o">=</span> <span class="n">ImageGrab</span><span class="p">.</span><span class="nf">grab</span><span class="p">()</span>  <span class="c1"># take the screenshot
</span>
<span class="c1"># Inference
</span><span class="n">results</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="training">Training <a href="#training" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>inference ê°€ ì•„ë‹Œ training ì—ì„œ yolov5ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•ŒëŠ”, <code class="language-plaintext highlighter-rouge">autoshape=False</code> í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì´ˆê¸° weightsë¥¼ ëœë¤í•˜ê²Œ ì„¤ì •í•˜ê³  ì‹¶ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">pretrained=False</code> í•´ì•¼ í•œë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">,</span> <span class="n">autoshape</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># load pretrained
</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">,</span> <span class="n">autoshape</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># load scratch
</span></pre></table></code></div></div><h3 id="base64-results">Base64 Results <a href="#base64-results" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>API serviceë¡œ ê²°ê³¼ë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” <a href="https://github.com/ultralytics/yolov5/tree/master/utils/flask_rest_api">Flask REST API</a> ë˜ëŠ” <a href="https://github.com/ultralytics/yolov5/pull/2291">#2291</a> ë¥¼ ì°¸ê³ í•´ë¼. ì•„ë˜ëŠ” ê·¸ì— ëŒ€í•œ ì˜ˆì‹œë¡œ Bask64ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ê°€ì ¸ì™”ë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">results</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>  <span class="c1"># inference
</span>
<span class="n">results</span><span class="p">.</span><span class="n">imgs</span> <span class="c1"># array of original images (as np array) passed to model for inference
</span><span class="n">results</span><span class="p">.</span><span class="nf">render</span><span class="p">()</span>  <span class="c1"># updates results.imgs with boxes and labels
</span><span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">results</span><span class="p">.</span><span class="n">imgs</span><span class="p">:</span>
    <span class="n">buffered</span> <span class="o">=</span> <span class="nc">BytesIO</span><span class="p">()</span>
    <span class="n">img_base64</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nf">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img_base64</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">buffered</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">"JPEG"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">(</span><span class="n">buffered</span><span class="p">.</span><span class="nf">getvalue</span><span class="p">()).</span><span class="nf">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>  <span class="c1"># base64 encoded image with results
</span></pre></table></code></div></div><h3 id="json-results">JSON Results <a href="#json-results" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>JSON í˜•íƒœë¡œ ì¶œë ¥í•˜ê³ ì í•œë‹¤ë©´ <code class="language-plaintext highlighter-rouge">to_json()</code> ë°©ë²•ì„ í™œìš©í•œ <code class="language-plaintext highlighter-rouge">.pandas()</code> ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. <code class="language-plaintext highlighter-rouge">orient</code> ì¸ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ json í˜•ì‹ì„ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.</p><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_json.html">to_json() ì°¸ê³  ë¸”ë¡œê·¸</a></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">results</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>  <span class="c1"># inference
</span>
<span class="n">results</span><span class="p">.</span><span class="nf">pandas</span><span class="p">().</span><span class="n">xyxy</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s">"records"</span><span class="p">)</span>  <span class="c1"># JSON img1 predictions
</span></pre></table></code></div></div><h3 id="other-models">other models <a href="#other-models" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>yolov5s.pt ëŒ€ì‹ ì— custom VOC-trained Yolov5 model ì¸ <code class="language-plaintext highlighter-rouge">best.pt</code>ë¥¼ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'custom'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">'path/to/best.pt'</span><span class="p">)</span>  <span class="c1"># default
</span></pre></table></code></div></div><h3 id="export-onnx-torchscript-coreml">export ONNX, TorchScript, CoreML <a href="#export-onnx-torchscript-coreml" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>ğŸ“š ì—¬ê¸°ì„œëŠ” Pytorch ì—ì„œ ONNX ë‚˜ TorchScript ë¡œ YOLOv5 ğŸš€ ë¥¼ ì¶”ì¶œí•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤.</p><p><code class="language-plaintext highlighter-rouge">export.py</code>ë¥¼ ì‚¬ìš©í•˜ë©´ ONNX, TorchScript, CoreML ë“±ìœ¼ë¡œë„ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python export.py <span class="nt">--weights</span> yolov5s.pt <span class="nt">--img</span> 640 <span class="nt">--batch</span> 1  <span class="c"># export at 640x640 with batch size 1</span>
</pre></table></code></div></div><h2 id="test-time-augmentation">[Test-Time Augmentation] <a href="#test-time-augmentation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>ğŸ“š ì—¬ê¸°ì„œëŠ” testë‚˜ inference ë™ì•ˆ mAP ì™€ recall(ì¬í˜„ìœ¨) ì„ í–¥ìƒì‹œí‚¤ëŠ” TTA(test Time Augmentaion) ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤.</p><p><code class="language-plaintext highlighter-rouge">val.py</code> ì— ëª…ë ¹ì„ ì¶”ê°€í•˜ì—¬ TTAë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•˜ê³ , í–¥ìƒëœ ê²°ê³¼ë¥¼ ìœ„í•´ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì•½ 30% ëŠ˜ë¦°ë‹¤.</p><p>TTAë¥¼ í™œì„±í™”ëœ ìƒíƒœì—ì„œ inference í•˜ë©´ ì¼ë°˜ì ìœ¼ë¡œ image ê°€ 3ê°œì˜ ë‹¤ë¥¸ í•´ìƒë„ë¡œ ì²˜ë¦¬ë˜ê³ , NMS ì´ì „ì— ì¶œë ¥ì´ ë³‘í•©ë˜ê¸° ë•Œë¬¸ì— ì‹œê°„ì´ 2~3ë°°ì •ë„ ë” ì†Œìš”ëœë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python val.py <span class="nt">--weights</span> yolov5x.pt <span class="nt">--data</span> coco.yaml <span class="nt">--img</span> 832 <span class="nt">--augment</span> <span class="nt">--half</span>
</pre></table></code></div></div><h3 id="inference-with-tta">inference with TTA <a href="#inference-with-tta" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">detect.py</code> ë¥¼ í™œìš©í•œ TTA inference ëŠ” <code class="language-plaintext highlighter-rouge">val.py</code> TTA ì™€ ë™ì¼í•˜ê²Œ <code class="language-plaintext highlighter-rouge">--augment</code> ë¥¼ ì„¤ì •í•œë‹¤.</p><h3 id="pytorch-hub-tta">Pytorch Hub TTA <a href="#pytorch-hub-tta" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>pytorch Hub ì—ì„œ TTA ëŠ” ìë™ìœ¼ë¡œ í†µí•©ë˜ì–´ ìˆë‹¤. inference ì‹œì— <code class="language-plaintext highlighter-rouge">augment=True</code> ë¥¼ ì…ë ¥ì‹œí‚¤ë©´ ëœë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">torch</span>

<span class="c1"># Model
</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">hub</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s">'ultralytics/yolov5'</span><span class="p">,</span> <span class="s">'yolov5s'</span><span class="p">)</span>  <span class="c1"># or yolov5m, yolov5x, custom
</span>
<span class="c1"># Images
</span><span class="n">img</span> <span class="o">=</span> <span class="s">'https://ultralytics.com/images/zidane.jpg'</span>  <span class="c1"># or file, PIL, OpenCV, numpy, multiple
</span>
<span class="c1"># Inference
</span><span class="n">results</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># &lt;--- TTA inference
</span>
<span class="c1"># Results
</span><span class="n">results</span><span class="p">.</span><span class="nf">print</span><span class="p">()</span>  <span class="c1"># or .show(), .save(), .crop(), .pandas(), etc.
</span></pre></table></code></div></div><h3 id="customize">Customize <a href="#customize" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">models/yolo.py</code> ì—ì„œ <code class="language-plaintext highlighter-rouge">forward_augment()</code>ë¥¼ ìˆ˜ì •í•˜ì—¬ TTAë¥¼ customize í•  ìˆ˜ ìˆë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">forward_augment</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> 
    <span class="n">img_size</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># height, width 
</span>    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">]</span>  <span class="c1"># scales 
</span>    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>  <span class="c1"># flips (2-ud, 3-lr) 
</span>    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># outputs 
</span>    <span class="k">for</span> <span class="n">si</span><span class="p">,</span> <span class="n">fi</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span> 
        <span class="n">xi</span> <span class="o">=</span> <span class="nf">scale_img</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">flip</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span> <span class="k">if</span> <span class="n">fi</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">gs</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">stride</span><span class="p">.</span><span class="nf">max</span><span class="p">()))</span> 
        <span class="n">yi</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">forward_once</span><span class="p">(</span><span class="n">xi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># forward 
</span>        <span class="c1"># cv2.imwrite(f'img_{si}.jpg', 255 * xi[0].cpu().numpy().transpose((1, 2, 0))[:, :, ::-1])  # save 
</span>        <span class="n">yi</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_descale_pred</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">img_size</span><span class="p">)</span> 
        <span class="n">y</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">None</span>  <span class="c1"># augmented inference, train 
</span></pre></table></code></div></div><h2 id="model-ensembling"><a href="https://github.com/ultralytics/yolov5/issues/318">Model Ensembling</a> <a href="#model-ensembling" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>ğŸ“š ì—¬ê¸°ì„œëŠ” test ë‚˜ inference ë™ì•ˆ mAP ì™€ recall ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ì„œ ensemblingì„ YOLOv5 ğŸš€ ëª¨ë¸ì— ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤.</p><p>From https://www.sciencedirect.com/topics/computer-science/ensemble-modeling:</p><blockquote><p>ì•™ìƒë¸” ëª¨ë¸ë§ì€ ë‹¤ì–‘í•œ ëª¨ë¸ë§ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ë‹¤ë¥¸ êµìœ¡ ë°ì´í„° ì„¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë‹¤ì–‘í•œ ëª¨ë¸ì„ ìƒì„±í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ì•™ìƒë¸” ëª¨ë¸ì€ ê° ê¸°ë³¸ ëª¨ë¸ì˜ ì˜ˆì¸¡ì„ ì§‘ê³„í•˜ê³  ë³´ì´ì§€ ì•ŠëŠ” ë°ì´í„°ì— ëŒ€í•´ ìµœì¢… ì˜ˆì¸¡ì„ í•œ ë²ˆ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì•™ìƒë¸” ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ë™ê¸°ëŠ” ì˜ˆì¸¡ì˜ ì¼ë°˜í™” ì˜¤ë¥˜ë¥¼ ì¤„ì´ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.</p><p>ê¸°ë³¸ ëª¨í˜•ì´ ë‹¤ì–‘í•˜ê³  ë…ë¦½ì ì¸ ê²½ìš° ì•™ìƒë¸” ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•  ë•Œ ëª¨í˜•ì˜ ì˜ˆì¸¡ ì˜¤ì°¨ëŠ” ê°ì†Œí•©ë‹ˆë‹¤. ê·¸ ì ‘ê·¼ë²•ì€ ì˜ˆì¸¡ì„ í•  ë•Œ êµ°ì¤‘ì˜ ì§€í˜œë¥¼ ì¶”êµ¬í•œë‹¤. ì•™ìƒë¸” ëª¨ë¸ì€ ëª¨ë¸ ë‚´ì— ì—¬ëŸ¬ ê¸°ë³¸ ëª¨ë¸ì´ ìˆì§€ë§Œ ë‹¨ì¼ ëª¨ë¸ë¡œ ì‘ë™ ë° ìˆ˜í–‰ë©ë‹ˆë‹¤.</p></blockquote><p><br /></p><h3 id="ensembling-test">Ensembling Test <a href="#ensembling-test" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>test ë‚˜ inference ì‹œì— <code class="language-plaintext highlighter-rouge">--weights</code> ì— ë‹¤ë¥¸ ëª¨ë¸ì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ensembling í•˜ì—¬ í‰ê°€í•  ìˆ˜ ìˆë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python val.py <span class="nt">--weights</span> yolov5x.pt yolov5l6.pt <span class="nt">--data</span> coco.yaml <span class="nt">--img</span> 640 <span class="nt">--half</span>
</pre></table></code></div></div><h3 id="ensembling-inference">Ensembling Inference <a href="#ensembling-inference" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>inference ì‹œì—ë„ ë™ì¼í•˜ê²Œ <code class="language-plaintext highlighter-rouge">--weights</code>ì— ë‘ ê°œë¥¼ ì…ë ¥ì‹œí‚¤ë©´ ëœë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python detect.py <span class="nt">--weights</span> yolov5x.pt yolov5l6.pt <span class="nt">--img</span> 640 <span class="nt">--source</span> data/images
</pre></table></code></div></div><h2 id="pruning--sparsity"><a href="https://github.com/ultralytics/yolov5/issues/304">Pruning / Sparsity</a> <a href="#pruning--sparsity" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>ğŸ“š ì—¬ê¸°ì„œëŠ” YOLOv5 ğŸš€ ëª¨ë¸ì— pruning ì„ ì ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤.</p><ul><li>Pruning</ul><p><code class="language-plaintext highlighter-rouge">torch_utils.prune()</code> ì„ ì´ìš©í•˜ì—¬ pruned model ì„ testì— ì ìš©í•  ìˆ˜ ìˆë‹¤. <code class="language-plaintext highlighter-rouge">val.py</code> ì— ì•„ë˜ì˜ ì½”ë“œë¥¼ ì…ë ¥í•˜ì—¬ ì—…ë°ì´íŠ¸ í•˜ë©´ ëœë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>
<span class="c1"># Half 
</span>
<span class="c1">#-------- ì¶”ê°€ --------
# Prune
</span><span class="kn">from</span> <span class="n">utils.torch_utils</span> <span class="kn">import</span> <span class="n">prune</span>
<span class="nf">prune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="c1">#----------------------
</span>
<span class="c1"># configure
</span><span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
</pre></table></code></div></div><p>30% pruned output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>...
Fusing layers... 
Model Summary: 476 layers, 87730285 parameters, 0 gradients
Pruning model...  0.3 global sparsity
...
</pre></table></code></div></div><p>output ì„ í†µí•´ pruning í›„ ëª¨ë¸ì—ì„œ 30%ì˜ sparsity ë¥¼ ë‹¬ì„±í–ˆë‹¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ëŠ” layerì´ 0ì¸ nn.conv2d ì˜ weights parameter ê°€ 30% ë§Œ ìˆ˜í–‰í–ˆë‹¤ëŠ” ëœ»ì´ë‹¤.</p><p>inference ì‹œê°„ì€ ë°”ë€Œì§€ ì•Šìœ¼ë‚˜, modelì˜ AP ì™€ AP scores ì€ ê°ì†Œí–ˆë‹¤.</p><h2 id="hyperparameter-evolution"><a href="https://github.com/ultralytics/yolov5/issues/607">Hyperparameter Evolution</a> <a href="#hyperparameter-evolution" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>ğŸ“š ì—¬ê¸°ì„œëŠ” YOLOv5 ğŸš€ ì˜ hyperparameter evolution ì„ ì„¤ëª…í•œë‹¤. hyperparameter evolution ì´ë€ optimization ì„ ìœ„í•´ GA(genetic algorithm) ì„ ì‚¬ìš©í•œ hyperparameter optimization ì˜ í•œ ì¢…ë¥˜ì´ë‹¤.</p><p>ML control ì˜ Hyperparameters ì€ ìµœì ì˜ ê°’ì„ ì°¾ëŠ” ê²ƒì´ ì–´ë µë‹¤. grid searchì™€ ê°™ì€ ì „í†µì ì¸ ë°©ë²•ì€ 1) ë†’ì€ ì°¨ì›, 2) ì°¨ì› ê°„ì˜ ë¶ˆí™•ì‹¤í•œ ìƒê´€ê´€ê³„, 3) ê° ì§€ì ì—ì„œ ì í•©ì„±ì„ í‰ê°€í•˜ëŠ” ë¹„ìš©ì´ ë„ˆë¬´ ë§ì´ ë°œìƒ í•¨ìœ¼ë¡œì¨ ë¹ ë¥´ê²Œ ë‹¤ë£¨ê¸° ì–´ë µë‹¤. ê·¸ë˜ì„œ GAê°€ hyperparameter ê²€ìƒ‰ì— ì í•©í•œ í›„ë³´ê°€ ë  ìˆ˜ ìˆë‹¤.</p><h3 id="install-hyperparameter">Install Hyperparameter <a href="#install-hyperparameter" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>yolov5 ëŠ” train ì— ì‚¬ìš©ë˜ëŠ” hyperparameterì´ 30ê°œ ì •ë„ ì‚¬ìš©ëœë‹¤. ì´ê²ƒë“¤ì€ <code class="language-plaintext highlighter-rouge">/data</code> directory ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì²˜ìŒì˜ ì¢‹ì€ ì‹œì‘ì€ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ë§Œë“ ë‹¤. ì• ë§¤í•˜ë‹¤ë©´, yolov5 coco training ì˜ parameterì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1"># yolov5/data/hyps/hyp.scratch.yaml
# Hyperparameters for COCO training from scratch 
# python train.py --batch 40 --cfg yolov5m.yaml --weights '' --data coco.yaml --img 640 --epochs 300 
# See tutorials for hyperparameter evolution https://github.com/ultralytics/yolov5#tutorials 
</span>  
  
<span class="n">lr0</span><span class="p">:</span> <span class="mf">0.01</span>  <span class="c1"># initial learning rate (SGD=1E-2, Adam=1E-3) 
</span><span class="n">lrf</span><span class="p">:</span> <span class="mf">0.2</span>  <span class="c1"># final OneCycleLR learning rate (lr0 * lrf) 
</span><span class="n">momentum</span><span class="p">:</span> <span class="mf">0.937</span>  <span class="c1"># SGD momentum/Adam beta1 
</span><span class="n">weight_decay</span><span class="p">:</span> <span class="mf">0.0005</span>  <span class="c1"># optimizer weight decay 5e-4 
</span><span class="n">warmup_epochs</span><span class="p">:</span> <span class="mf">3.0</span>  <span class="c1"># warmup epochs (fractions ok) 
</span><span class="n">warmup_momentum</span><span class="p">:</span> <span class="mf">0.8</span>  <span class="c1"># warmup initial momentum 
</span><span class="n">warmup_bias_lr</span><span class="p">:</span> <span class="mf">0.1</span>  <span class="c1"># warmup initial bias lr 
</span></pre></table></code></div></div><h3 id="define-fitness">Define Fitness <a href="#define-fitness" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>fitnessëŠ” ìš°ë¦¬ê°€ ìµœëŒ€í•œ í™œìš©í•˜ê³ ì í•˜ëŠ” ê°’ì´ë‹¤. yolov5ì—ì„œ ìš°ë¦¬ëŠ” mAP@0.5(weightì˜ 10%) ì™€ mAP@0.5:0.95(90%ë¥¼ ë‚¨ê¹€) ê³¼ ê°™ì€ ê°€ì¤‘ì¹˜ ê²°í•©ì˜ default fitnessë¥¼ ê°€ì§€ê³  ìˆë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># yolov5/utils/metrics.py
</span><span class="k">def</span> <span class="nf">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> 
    <span class="c1"># Model fitness as a weighted combination of metrics 
</span>    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>  <span class="c1"># weights for [P, R, mAP@0.5, mAP@0.5:0.95] 
</span>    <span class="nf">return </span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
</pre></table></code></div></div><h3 id="evolve">Evolve <a href="#evolve" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>ì´ ì˜ˆì œì—ì„œ base scenario ëŠ” ì‚¬ì „ í›ˆë ¨ëœ yolov5s ë¥¼ ì‚¬ìš©í•˜ì—¬ COCO128 ì„ 10 epochs ë™ì•ˆ finetuning í•œë‹¤.</p><p><code class="language-plaintext highlighter-rouge">--evolve</code> ë¥¼ í†µí•´ epochì„ ì§„í–‰í•˜ë©´ì„œ hyperparameterì„ ìµœì í™”í•œë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c"># single-GPU</span>
python train.py <span class="nt">--epochs</span> 10 <span class="nt">--data</span> coco128.yaml <span class="nt">--weights</span> yolov5s.pt <span class="nt">--cache</span> <span class="nt">--evolve</span>

<span class="c"># Multi-GPU</span>
<span class="k">for </span>i <span class="k">in </span>0 1 2 3<span class="p">;</span> <span class="k">do
  </span><span class="nb">nohup </span>python train.py <span class="nt">--epochs</span> 10 <span class="nt">--data</span> coco128.yaml <span class="nt">--weights</span> yolov5s.pt <span class="nt">--cache</span> <span class="nt">--evolve</span> <span class="nt">--device</span> <span class="nv">$i</span> <span class="o">&gt;</span> evolve_gpu_<span class="nv">$i</span>.log &amp;
<span class="k">done</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">--evolve</code> ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 300ë²ˆì„ ë°˜ë³µí•˜ë©´ì„œ hyperparamemterë¥¼ ìµœì í™”í•˜ì§€ë§Œ, <code class="language-plaintext highlighter-rouge">--evolve 1000</code> ê³¼ ê°™ì´ ì‘ì„±í•˜ë©´ 1000ë²ˆ ë°˜ë³µìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ë°˜ë³µí•˜ë©´ì„œ ê°€ì¥ ìµœì ì˜ parameterë¥¼ <code class="language-plaintext highlighter-rouge">runs/evolve/hyp_evolved.yaml</code> ì— ì €ì¥í•œë‹¤.</p><p>ìµœì†Œí•œ 300ë²ˆì€ í•´ì•¼ ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. ë˜, evolution ìì²´ë„ ì¼ë°˜ì ìœ¼ë¡œ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ê³  ë¹„ì‹¼ë°, ìˆ˜ì²œë²ˆì˜ ë°˜ë³µì„ í•˜ê²Œ ë˜ë©´ ë§ì€ ì–‘ì˜ GPUë¥¼ ì‚¬ìš©í•˜ê²Œ ë  ê²ƒì´ë‹¤.</p><h2 id="transfer-learning-with-frozen-layers"><a href="https://github.com/ultralytics/yolov5/issues/1314">Transfer Learning with Frozen Layers</a> <a href="#transfer-learning-with-frozen-layers" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>ğŸ“š ì—¬ê¸°ì„œëŠ” transfer learning ì‹œì— Yolov5 ğŸš€ layer ë¥¼ frozen ì‹œí‚¤ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤. transfer learning ì€ ìƒˆë¡œìš´ dataì— ëŒ€í•œ modelì„ ë¹ ë¥´ê²Œ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤. ì¼ë¶€ initial weights ë¥¼ ê³ ì •ì‹œí‚¤ê³ , ë‚˜ë¨¸ì§€ weights ëŠ” lossë¥¼ ê³„ì‚°í•˜ëŠ”ë° ì‚¬ìš©ë˜ê³ , optimizerì— ì˜í•´ ì—…ë°ì´íŠ¸ëœë‹¤. ì´ëŠ” ì›ë˜ë³´ë‹¤ í›¨ì”¬ ì ì€ ë¹„ìš©ì´ ë“ ë‹¤. ì •í™•ë„ëŠ” ë‹¤ì†Œ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë‚˜, training time ì„ ë‹¨ì¶•ì‹œí‚¬ ìˆ˜ ìˆë‹¤.</p><h3 id="before-start">Before start <a href="#before-start" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>git clone https://github.com/ultralytics/yolov5
<span class="nb">cd </span>yolov5
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt wandb <span class="c"># add W&amp;B for logging</span>
</pre></table></code></div></div><h3 id="frozen-backbone">Frozen Backbone <a href="#frozen-backbone" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">train.py</code> ì™€ ë™ì¼í•œ architecture ë¥¼ ì‚¬ìš©í•˜ë ¤ëŠ” ë¶€ë¶„ì€ training ì‹œì‘ ì „ì— <code class="language-plaintext highlighter-rouge">grad=False</code> ë¡œ ì„¤ì •í•˜ë©´ <code class="language-plaintext highlighter-rouge">frozen</code>ëœë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1"># yolov5/train.py
</span> <span class="c1"># Freeze 
</span> <span class="n">freeze</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s">'model.</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s">.'</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">freeze</span><span class="p">)]</span>  <span class="c1"># layers to freeze 
</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="nf">named_parameters</span><span class="p">():</span> 
     <span class="n">v</span><span class="p">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># train all layers 
</span>     <span class="k">if</span> <span class="nf">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freeze</span><span class="p">):</span> 
         <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'freezing </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">'</span><span class="p">)</span> 
         <span class="n">v</span><span class="p">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">False</span> 


<span class="c1">#ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡
</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="nf">named_parameters</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="c1"># Output
</span><span class="n">model</span><span class="p">.</span><span class="mf">0.</span><span class="n">conv</span><span class="p">.</span><span class="n">conv</span><span class="p">.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">0.</span><span class="n">conv</span><span class="p">.</span><span class="n">bn</span><span class="p">.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">0.</span><span class="n">conv</span><span class="p">.</span><span class="n">bn</span><span class="p">.</span><span class="n">bias</span>
<span class="n">model</span><span class="p">.</span><span class="mf">1.</span><span class="n">conv</span><span class="p">.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">1.</span><span class="n">bn</span><span class="p">.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">1.</span><span class="n">bn</span><span class="p">.</span><span class="n">bias</span>
<span class="n">model</span><span class="p">.</span><span class="mf">2.</span><span class="n">cv1</span><span class="p">.</span><span class="n">conv</span><span class="p">.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">2.</span><span class="n">cv1</span><span class="p">.</span><span class="n">bn</span><span class="p">.</span><span class="n">weight</span>
<span class="p">...</span>
<span class="n">model</span><span class="p">.</span><span class="mf">23.</span><span class="n">m</span><span class="p">.</span><span class="mf">0.</span><span class="n">cv2</span><span class="p">.</span><span class="n">bn</span><span class="p">.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">23.</span><span class="n">m</span><span class="p">.</span><span class="mf">0.</span><span class="n">cv2</span><span class="p">.</span><span class="n">bn</span><span class="p">.</span><span class="n">bias</span>
<span class="n">model</span><span class="p">.</span><span class="mf">24.</span><span class="n">m</span><span class="p">.</span><span class="mf">0.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">24.</span><span class="n">m</span><span class="p">.</span><span class="mf">0.</span><span class="n">bias</span>
<span class="n">model</span><span class="p">.</span><span class="mf">24.</span><span class="n">m</span><span class="p">.</span><span class="mf">1.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">24.</span><span class="n">m</span><span class="p">.</span><span class="mf">1.</span><span class="n">bias</span>
<span class="n">model</span><span class="p">.</span><span class="mf">24.</span><span class="n">m</span><span class="p">.</span><span class="mf">2.</span><span class="n">weight</span>
<span class="n">model</span><span class="p">.</span><span class="mf">24.</span><span class="n">m</span><span class="p">.</span><span class="mf">2.</span><span class="n">bias</span>
</pre></table></code></div></div><p>yolov5 ì—ì„œ backbone ì€ 0~9 layerì— í•´ë‹¹í•˜ë¯€ë¡œ backbone ê³ ì •ì„ ìœ„í•´ 9 layer ê¹Œì§€ freeze í•œë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python train.py <span class="nt">--freeze</span> 10
</pre></table></code></div></div><p>ëª¨ë“  layerì„ ê³ ì •í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í•˜ë©´ ëœë‹¤.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python train.py <span class="nt">--freeze</span> 24
</pre></table></code></div></div><p><img data-src="https://user-images.githubusercontent.com/26833433/98394485-22081580-205b-11eb-9e37-1f9869fe91d8.png" alt="image" data-proofer-ignore></p><p>ëª¨ë“  layer freeze ì‹œ ì •í™•ë„ê°€ ë–¨ì–´ì§€ê³ , backboneë§Œ freeze í•´ë„ ì¼ë°˜ì ì¸ ëª¨ë¸ë³´ë‹¤ ë–¨ì–´ì§€ì§€ë§Œ, ì†ë„ê°€ ë¹¨ë¼ì§€ê³ , ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ë„ ì¤„ì–´ë“ ë‹¤.</p><ul><li><strong>Appendix</strong></ul><p>repo ê¸°ëŠ¥ì„ ê²€ì¦í•˜ì—¬ í…ŒìŠ¤íŠ¸í•œë‹¤.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="c1">###### Reproduce
</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s">'yolov5s'</span><span class="p">,</span> <span class="s">'yolov5m'</span><span class="p">,</span> <span class="s">'yolov5l'</span><span class="p">,</span> <span class="s">'yolov5x'</span><span class="p">:</span>
  <span class="err">!</span><span class="n">python</span> <span class="n">val</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="p">{</span><span class="n">x</span><span class="p">}.</span><span class="n">pt</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco</span><span class="p">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">img</span> <span class="mi">640</span> <span class="o">--</span><span class="n">conf</span> <span class="mf">0.25</span> <span class="o">--</span><span class="n">iou</span> <span class="mf">0.45</span>  <span class="c1"># speed
</span>  <span class="err">!</span><span class="n">python</span> <span class="n">val</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="p">{</span><span class="n">x</span><span class="p">}.</span><span class="n">pt</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco</span><span class="p">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">img</span> <span class="mi">640</span> <span class="o">--</span><span class="n">conf</span> <span class="mf">0.001</span> <span class="o">--</span><span class="n">iou</span> <span class="mf">0.65</span>  <span class="c1"># mAP
</span>
<span class="c1">###### Unit tests
</span><span class="o">%%</span><span class="n">shell</span>
<span class="n">export</span> <span class="n">PYTHONPATH</span><span class="o">=</span><span class="s">"$PWD"</span>  <span class="c1"># to run *.py. files in subdirectories
</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">runs</span>  <span class="c1"># remove runs/
</span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">yolov5s</span><span class="p">;</span> <span class="n">do</span>  <span class="c1"># models
</span>  <span class="n">python</span> <span class="n">train</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="err">$</span><span class="n">m</span><span class="p">.</span><span class="n">pt</span> <span class="o">--</span><span class="n">epochs</span> <span class="mi">3</span> <span class="o">--</span><span class="n">img</span> <span class="mi">320</span> <span class="o">--</span><span class="n">device</span> <span class="mi">0</span>  <span class="c1"># train pretrained
</span>  <span class="n">python</span> <span class="n">train</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="s">''</span> <span class="o">--</span><span class="n">cfg</span> <span class="err">$</span><span class="n">m</span><span class="p">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">epochs</span> <span class="mi">3</span> <span class="o">--</span><span class="n">img</span> <span class="mi">320</span> <span class="o">--</span><span class="n">device</span> <span class="mi">0</span>  <span class="c1"># train scratch
</span>  <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="mi">0</span> <span class="n">cpu</span><span class="p">;</span> <span class="n">do</span>  <span class="c1"># devices
</span>    <span class="n">python</span> <span class="n">detect</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="err">$</span><span class="n">m</span><span class="p">.</span><span class="n">pt</span> <span class="o">--</span><span class="n">device</span> <span class="err">$</span><span class="n">d</span>  <span class="c1"># detect official
</span>    <span class="n">python</span> <span class="n">detect</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="n">runs</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">exp</span><span class="o">/</span><span class="n">weights</span><span class="o">/</span><span class="n">best</span><span class="p">.</span><span class="n">pt</span> <span class="o">--</span><span class="n">device</span> <span class="err">$</span><span class="n">d</span>  <span class="c1"># detect custom
</span>    <span class="n">python</span> <span class="n">val</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="err">$</span><span class="n">m</span><span class="p">.</span><span class="n">pt</span> <span class="o">--</span><span class="n">device</span> <span class="err">$</span><span class="n">d</span> <span class="c1"># val official
</span>    <span class="n">python</span> <span class="n">val</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="n">runs</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">exp</span><span class="o">/</span><span class="n">weights</span><span class="o">/</span><span class="n">best</span><span class="p">.</span><span class="n">pt</span> <span class="o">--</span><span class="n">device</span> <span class="err">$</span><span class="n">d</span> <span class="c1"># val custom
</span>  <span class="n">done</span>
  <span class="n">python</span> <span class="n">hubconf</span><span class="p">.</span><span class="n">py</span>  <span class="c1"># hub
</span>  <span class="n">python</span> <span class="n">models</span><span class="o">/</span><span class="n">yolo</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">cfg</span> <span class="err">$</span><span class="n">m</span><span class="p">.</span><span class="n">yaml</span>  <span class="c1"># inspect
</span>  <span class="n">python</span> <span class="n">export</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">weights</span> <span class="err">$</span><span class="n">m</span><span class="p">.</span><span class="n">pt</span> <span class="o">--</span><span class="n">img</span> <span class="mi">640</span> <span class="o">--</span><span class="n">batch</span> <span class="mi">1</span>  <span class="c1"># export
</span><span class="n">done</span>

<span class="c1">###### Profile
</span><span class="kn">from</span> <span class="n">utils.torch_utils</span> <span class="kn">import</span> <span class="n">profile</span>

<span class="n">m1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="nc">SiLU</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="nf">profile</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">640</span><span class="p">),</span> <span class="n">ops</span><span class="o">=</span><span class="p">[</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>


<span class="c1">###### Evolve
</span><span class="err">!</span><span class="n">python</span> <span class="n">train</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">img</span> <span class="mi">640</span> <span class="o">--</span><span class="n">batch</span> <span class="mi">64</span> <span class="o">--</span><span class="n">epochs</span> <span class="mi">100</span> <span class="o">--</span><span class="n">data</span> <span class="n">coco128</span><span class="p">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">weights</span> <span class="n">yolov5s</span><span class="p">.</span><span class="n">pt</span> <span class="o">--</span><span class="n">cache</span> <span class="o">--</span><span class="n">noautoanchor</span> <span class="o">--</span><span class="n">evolve</span>
<span class="err">!</span><span class="n">d</span><span class="o">=</span><span class="n">runs</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">evolve</span> <span class="o">&amp;&amp;</span> <span class="n">cp</span> <span class="n">evolve</span><span class="p">.</span><span class="o">*</span> <span class="err">$</span><span class="n">d</span> <span class="o">&amp;&amp;</span> <span class="nb">zip</span> <span class="o">-</span><span class="n">r</span> <span class="n">evolve</span><span class="p">.</span><span class="nb">zip</span> <span class="err">$</span><span class="n">d</span> <span class="o">&amp;&amp;</span> <span class="n">gsutil</span> <span class="n">mv</span> <span class="n">evolve</span><span class="p">.</span><span class="nb">zip</span> <span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">bucket</span>  <span class="c1"># upload results (optional)
</span>
<span class="c1">### VOC
</span><span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">([</span><span class="mi">64</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span> <span class="p">[</span><span class="s">'yolov5s'</span><span class="p">,</span> <span class="s">'yolov5m'</span><span class="p">,</span> <span class="s">'yolov5l'</span><span class="p">,</span> <span class="s">'yolov5x'</span><span class="p">]):</span>  <span class="c1"># zip(batch_size, model)
</span>  <span class="err">!</span><span class="n">python</span> <span class="n">train</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span> <span class="p">{</span><span class="n">b</span><span class="p">}</span> <span class="o">--</span><span class="n">weights</span> <span class="p">{</span><span class="n">m</span><span class="p">}.</span><span class="n">pt</span> <span class="o">--</span><span class="n">data</span> <span class="n">VOC</span><span class="p">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">epochs</span> <span class="mi">50</span> <span class="o">--</span><span class="n">cache</span> <span class="o">--</span><span class="n">img</span> <span class="mi">512</span> <span class="o">--</span><span class="n">nosave</span> <span class="o">--</span><span class="n">hyp</span> <span class="n">hyp</span><span class="p">.</span><span class="n">finetune</span><span class="p">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">project</span> <span class="n">VOC</span> <span class="o">--</span><span class="n">name</span> <span class="p">{</span><span class="n">m</span><span class="p">}</span>
</pre></table></code></div></div><p><br /></p><p><br /></p><h2 id="reference">reference <a href="#reference" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>â€œyolov5 github tutorialâ€ - https://colab.research.google.com/drive/1uFK2FT-0c3rmrUoJoKq8QVcKCsbdwxRb<li>â€œë¹µí˜• YOLOV5 train Maskâ€ - https://colab.research.google.com/drive/1E8lRvkLVWs9vijUI1S7febGSQ2eb6hzm#scrollTo=9EflbG16Zt21<li>â€œHow to train YOLOv5 on a custom dataset code - roboflowâ€ - https://colab.research.google.com/drive/1gDZ2xcTOgR39tGGs-EZ6i3RTs16wmzZQ#scrollTo=GD9gUQpaBxNa<li>â€œYOLOV5 Mask Wearing Dataset - roboflowâ€ - https://public.roboflow.com/object-detection/mask-wearing<li>â€œYOLOV5 fake or real - kaggleâ€ - https://www.kaggle.com/orkatz2/yolov5-fake-or-real-single-model-l-b-0-753?scriptVersionId=37672232</ul><p><br /></p></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/YoloV5-2/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/YoloV5-2.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/review/'>Review</a>, <a href='/categories/object-detection/'>Object Detection</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/object-detection/" class="post-tag no-text-decoration" >Object Detection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=You Only Look Once v5 - Github - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/YoloV5-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=You Only Look Once v5 - Github - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/YoloV5-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/YoloV5-2/&amp;text=You Only Look Once v5 - Github - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/YoloV5-2/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[ê¹ƒí—ˆë¸Œ í”„ë¡œí•„ ê¾¸ë¯¸ê¸°] github í”„ë¡œí•„ ë§Œë“¤ê¸°</a><li><a href="/posts/product/">[ê¹ƒí—ˆë¸Œ í”„ë¡œí•„ ê¾¸ë¯¸ê¸°] productive box ë§Œë“¤ê¸°</a><li><a href="/posts/regex/">[ë°ë¸Œì½”ìŠ¤] 2ì£¼ì°¨ - linux ê¸°ì´ˆ(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation ê³¼ StratifiedKFold</a><li><a href="/posts/cmake/">[ë°ë¸Œì½”ìŠ¤] 17ì£¼ì°¨ - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tusimple/"><div class="card-body"> <em class="timeago small" date="2022-04-29 03:20:00 +0900" >Apr 29, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ë…¼ë¬¸ ë¦¬ë·°] Ultra Fast Structure-aware Deep Lane Detection</h3><div class="text-muted small"><p> Lane Detectionì— ëŒ€í•œ ë…¼ë¬¸ì„ ë¦¬ë·°í•œ ë‚´ìš©ì…ë‹ˆë‹¤. í˜¼ì ê³µë¶€í•˜ê¸° ìœ„í•´ ì •ë¦¬í•œ ë‚´ìš©ìœ¼ë¡œ ì´í•´ê°€ ì•ˆë˜ëŠ” ë¶€ë¶„ë“¤ì´ ë§ì„ ê±°ë¼ ìƒê°ë©ë‹ˆë‹¤. ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ë´ì£¼ì„¸ìš”. Abstract ìµœê·¼ Lane detection ë°©ë²•ë“¤ì€ í”½ì…€ ë‹¨ìœ„ì˜ segmentation ê¸°ë°˜ì˜ ë°©ë²•ìœ¼ë¡œ ë‹¤ì–‘í•œ í™˜ê²½ê³¼ ì²˜ë¦¬ ì†ë„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë…¸ë ¥í•´ì™”ë‹¤. ì‚¬ëŒì˜ ì¸ì§€ ì‹œ...</p></div></div></a></div><div class="card"> <a href="/posts/YoloV5/"><div class="card-body"> <em class="timeago small" date="2021-09-05 13:00:00 +0900" >Sep 5, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ë…¼ë¬¸ ë¦¬ë·°] You Only Look Once v5 - blog</h3><div class="text-muted small"><p> YOLO review ì…ë ¥ëœ ì´ë¯¸ì§€ëŠ” low-level feature ì—ì„œ high-level featureê°€ ë˜ê³ , classificationì„ ìœ„í•´ trainable classifierë¥¼ ê±°ì¹œë‹¤. YoloëŠ” ì•ì„œ ì •ë¦¬í•œ ê²ƒì„ ì°¸ê³ í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤. ê°„ë‹¨íˆ ë¦¬ë·°í•˜ìë©´, bounding box regression ê³¼ classific...</p></div></div></a></div><div class="card"> <a href="/posts/MMdetection/"><div class="card-body"> <em class="timeago small" date="2021-12-22 13:00:00 +0900" >Dec 22, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ë…¼ë¬¸ ë¦¬ë·°] MMDetection: Open MMLab Detection Toolbox and Benchmark</h3><div class="text-muted small"><p> MMDetectionì— ëŒ€í•œ ë…¼ë¬¸ì„ ë¦¬ë·°í•œ ë‚´ìš©ì…ë‹ˆë‹¤. í˜¼ì ê³µë¶€í•˜ê¸° ìœ„í•´ ì •ë¦¬í•œ ë‚´ìš©ìœ¼ë¡œ ì´í•´ê°€ ì•ˆë˜ëŠ” ë¶€ë¶„ë“¤ì´ ë§ì„ ê±°ë¼ ìƒê°ë©ë‹ˆë‹¤. ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ë´ì£¼ì„¸ìš”. Abstract mmdetectionì€ object detectionê³¼ instance segmentationì„ ë‹¤ë£¨ëŠ” ìœ ëª…í•˜ê³  ë‹¤ì–‘í•œ ëª¨ë¸ì„ í•˜ë‚˜ì˜ toolboxë¡œ êµ¬í˜„í•œ ì¼ì¢…ì˜ í”Œë«í¼ì´ë‹¤...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/YoloV5/" class="btn btn-outline-primary" prompt="Older"><p>[ë…¼ë¬¸ ë¦¬ë·°] You Only Look Once v5 - blog</p></a> <a href="/posts/SORT/" class="btn btn-outline-primary" prompt="Newer"><p>Simple Online and Realtime Tracking</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>