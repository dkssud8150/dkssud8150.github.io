<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window" /><meta name="author" content="JaeHo YooN" /><meta property="og:locale" content="en" /><meta name="description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><meta property="og:description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><link rel="canonical" href="https://dkssud8150.github.io/posts/warping/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/warping/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-29T15:01:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo YooN"},"dateModified":"2022-04-11T18:50:51+09:00","datePublished":"2022-03-29T15:01:00+09:00","description":"Do focus on developing ‘your ability’ rather than waste time on making you famous.","headline":"[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/warping/"},"url":"https://dkssud8150.github.io/posts/warping/"}</script><title>[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-03-29 15:01:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Tue, Mar 29, 2022, 3:01 PM +0900" >Mar 29, 2022</em> </span> <span> Updated <em class="timeago" date="2022-04-11 18:50:51 +0900 " data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 11, 2022, 6:50 PM +0900" >Apr 11, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5442 words"> <em>30 min</em> read</span></div></div></div><div class="post-content"><p><br /></p><h1 id="warping">Warping</h1><p>사전적으로 뒤틀림이라는 의미로, 영상에서 말하는 warping은 이동, 회전, 크기 변환 등을 말한다. 찌그러진 이미지를 복원할 수도 있다.</p><h2 id="ros-환경-설정">ROS 환경 설정 <a href="#ros-환경-설정" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>1.패키지 생성</p><ul><li><code class="language-plaintext highlighter-rouge">sliding_drive</code> 패키지를 생성</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>catkin_create_pkg sliding_drive std_msgs rospy
</pre></table></code></div></div><p><br /></p><p>2.src 폴더 아래 girl.png, chess.png 파일 복사</p><p><br /></p><h2 id="translation-변환">Translation 변환 <a href="#translation-변환" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>1.평행이동</strong></p><ul><li>이미지를 이동하려면 원래 있던 좌표에 이동시키련느 거리만큼 더하면 된다.<ul><li>x_new = x_old + d1<li>y_new = y_old + d2</ul></ul><p>이를 변환 행렬로 표현하면</p><p><img data-src="/assets\img\dev\week7\day2\matrix.png" data-proofer-ignore></p><p>따라서</p><ul><li>x_old + d1 = 1 * x_old + 0 * y_old + d1<li>y_old + d2 = 0 * x_old + 1 * y_old + d2</ul><p><br /></p><p><code class="language-plaintext highlighter-rouge">dst = cv2.warpAffine(src, matrix, dsize, dst, flags, borderMode, borderValue)</code></p><ul><li>src : 원본 이미지, numpy 배열<li>matrix : 2x3 변환 행렬, dtype=float32<li>dsize : 결과 이미지의 크기<li>dst : option,결과 이미지<li>flags : option, 보간법 알고리즘 플래그<ul><li>cv2.INTER_LINEAR : default, 인접한 4개 픽셀 값에 거리 가중치 사용<li>cv2.INTER_NEAREST : 가장 가까운 픽셀 값 아용<li>cv2.INTER_AREA : 픽셀 영역 관계를 이용한 재샘플링<li>cv2.INTER_CUBIC : 인접한 16개 픽셀 값에 거리 가중치 사용</ul><li>borderMode : option, 외곽영역 보정 플래그<ul><li>cv2.BORDER_CONSTANT : 고정 색상 값<li>cv2.BORDER_REPLICATE : 가장자리 복제<li>cv2.BORDER_WRAP : 반복<li>cv2.BORDER_REFLECT : 반사</ul><li>borderValue : option, 외곽영역 보정 플래그가 cv2.BORDER_CONSTANT일경우 사용할 색상 값</ul><p><br /></p><ul><li><strong>translation.py</strong></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'girl.png'</span><span class="p">)</span><span class="mi">0</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span>

<span class="n">mtrx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">dx</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">dy</span><span class="p">]])</span>

<span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,</span> <span class="p">(</span><span class="n">cols</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">rows</span><span class="o">+</span><span class="n">dy</span><span class="p">))</span>

<span class="n">dst2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,</span> <span class="p">(</span><span class="n">cols</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">rows</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="bp">None</span><span class="p">,</span> <span class="n">cv2_INTER_LENEAR</span><span class="p">,</span> <span class="n">cv2_BORDER_CONSTANT</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

<span class="n">dst3</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,</span> <span class="p">(</span><span class="n">cols</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">rows</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="bp">None</span><span class="p">,</span> <span class="n">cv2_INTER_LENEAR</span><span class="p">,</span> <span class="n">cv2_BORDER_RELECT</span><span class="p">)</span>

<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"dst"</span><span class="p">,</span><span class="n">dst</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"constant"</span><span class="p">,</span><span class="n">dst2</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"reflect"</span><span class="p">,</span><span class="n">dst3</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">destroyAllWindows</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><ul><li>실행<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python translation.py
</pre></table></code></div></div></ul><p><br /></p><p>2.확대축소</p><p>일정 비율로 확대 및 축소</p><p>기존 좌표에 특정 값을 곱하면 된다.</p><ul><li>x_new = a1 * x_old = a1 * x_old + 0 * y_old + 0 * 1<li>y_new = 0 * x_old = a1 * x_old + a2 * y_old + 0 * 1</ul><p>이를 변환 행렬로 표현하면 다음과 같다.</p><p><img data-src="/assets\img\dev\week7\day2\matrix2.png" data-proofer-ignore></p><p><br /></p><ul><li><strong>scaling.py</strong></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'girl.png'</span><span class="p">)</span><span class="mi">0</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">mtrx_small</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">mtrx_big</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,</span> <span class="n">m_small</span><span class="p">,</span> <span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="nf">int</span><span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)))</span>

<span class="n">dst2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,</span> <span class="n">m_small</span><span class="p">,</span> <span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="nf">int</span><span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)),</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cv2_INTER_AREA</span><span class="p">)</span>

<span class="n">dst3</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,</span> <span class="n">m_big</span><span class="p">,</span> <span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="nf">int</span><span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">dst4</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,</span> <span class="n">m_big</span><span class="p">,</span> <span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="nf">int</span><span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="mi">2</span><span class="p">)),</span><span class="bp">None</span><span class="p">,</span> <span class="n">cv2_INTER_CUBIC</span><span class="p">)</span>

<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"small"</span><span class="p">,</span><span class="n">dst</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"small_inter_area"</span><span class="p">,</span><span class="n">dst2</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"big"</span><span class="p">,</span><span class="n">dst3</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"big_inter_cubic"</span><span class="p">,</span><span class="n">dst4</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">destroyAllWindows</span><span class="p">()</span>
</pre></table></code></div></div><p>이미지를 축소할 때는 INTER_AREA를 권장하고, 확대할 때는 INTER_LINEAR 또는 CUBIC을 추천한다.</p><p><br /></p><p><br /></p><p>affine 이외에 다른 함수를 이용해서도 크기를 조정할 수 있다.</p><p><code class="language-plaintext highlighter-rouge">cv2.resize(src,dsize,dst,fx,fy,interpolation)</code></p><ul><li>src : 입력 원본 이미지<li>dsize : 출력 영상 크기, 지정하지 않으면 fx,fy 배율을 적용<li>fx,fy : 크기 배율, dsize를 입력하면 dsize를 우선 적용함<li>interpolation : 보간법 알고리즘<li>dst : 결과 이미지</ul><p><br /></p><ul><li><strong>resizing.py</strong></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'girl.png'</span><span class="p">)</span>
<span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">dst1</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="nf">int</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_AREA</span><span class="p">)</span>

<span class="n">dst2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_CUBIC</span><span class="p">)</span>

<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"small"</span><span class="p">,</span><span class="n">dst</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"small_inter_area"</span><span class="p">,</span><span class="n">dst2</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">destroyAllWindows</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><ul><li>실행<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python resizing.py
</pre></table></code></div></div></ul><p><br /></p><p>3.회전</p><p>이미지 회전을 위한 변환 행렬식은 다음과 같다.</p><p><img data-src="/assets/img/dev/week7/day2/matrix3.png" data-proofer-ignore></p><p>이 2x2 행렬은 2x3을 요구하는 affine행렬에서는 사용할 수 없고, 사용히려면 2x3행렬로 변환해야 한다. 변환해주는 cv2.getRotationMatrix2D 함수가 존재한다.</p><p>회전 행렬을 직접 구현한 코드이다.</p><ul><li><strong>rotation1.py</strong></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'girl.png'</span><span class="p">)</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">d45</span> <span class="o">=</span> <span class="mf">45.0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
<span class="n">d90</span> <span class="o">=</span> <span class="mf">90.0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>

<span class="n">mtrx1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">d45</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">d45</span><span class="p">),</span><span class="n">cols</span><span class="o">//</span><span class="mi">2</span><span class="p">],[</span><span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">d45</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">d45</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rows</span><span class="o">//</span><span class="mi">4</span><span class="p">]])</span> 

<span class="n">mtrx2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">d90</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">d90</span><span class="p">),</span><span class="n">cols</span><span class="p">],[</span><span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">d90</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">d90</span><span class="p">),</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">dst1</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx1</span><span class="p">,(</span><span class="n">cols</span><span class="p">,</span><span class="n">rows</span><span class="p">))</span>
<span class="n">dst2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx2</span><span class="p">,(</span><span class="n">cols</span><span class="p">,</span><span class="n">rows</span><span class="p">))</span>

<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"45"</span><span class="p">,</span><span class="n">dst</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"90"</span><span class="p">,</span><span class="n">dst2</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">destroyAllWindows</span><span class="p">()</span>
</pre></table></code></div></div><p>컴퓨터는 반시계를 +로 잡기 때문에 시계방향으로 돌리기 위해 -1을 곱했고, 원점을 화면의 중간으로 잡기 위해 마지막 인자를 주었다.</p><p><br /></p><p>회전 행렬을 함수를 사용하여 구현한 코드이다.</p><p><code class="language-plaintext highlighter-rouge">mtrx = cv2.getRotationMatrix2D(center, angle, scale)</code></p><ul><li>Center : 회전축 중심 좌표<li>angle : 회전할 각도, 60진법<li>scale : 확대 축소 비율</ul><p><br /></p><ul><li><strong>rotation2.py</strong></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'girl.png'</span><span class="p">)</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">d45</span> <span class="o">=</span> <span class="mf">45.0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
<span class="n">d90</span> <span class="o">=</span> <span class="mf">90.0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>

<span class="n">mtrx1</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">getRotationMatrix2D</span><span class="p">((</span><span class="n">cols</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">rows</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">45</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">mtrx2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">getRotationMatrix2D</span><span class="p">((</span><span class="n">cols</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">rows</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">90</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="n">dst1</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx1</span><span class="p">,(</span><span class="n">cols</span><span class="p">,</span><span class="n">rows</span><span class="p">))</span>
<span class="n">dst2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx2</span><span class="p">,(</span><span class="n">cols</span><span class="p">,</span><span class="n">rows</span><span class="p">))</span>

<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"45"</span><span class="p">,</span><span class="n">dst</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"90"</span><span class="p">,</span><span class="n">dst2</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">destroyAllWindows</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><h2 id="affine-변환">Affine 변환 <a href="#affine-변환" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Affine 변환 행렬은 2x3 행렬로 cv2.getAffineTranform 함수를 통해서 얻을 수 있다.</p><ul><li><strong>affine.py</strong></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'chess.png'</span><span class="p">)</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">pts1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],[</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">],[</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">]])</span>

<span class="n">pts2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">],[</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">],[</span><span class="mi">100</span><span class="p">,</span><span class="mi">250</span><span class="p">]])</span>

<span class="n">mtrx</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">getAffineTransform</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span><span class="n">pts2</span><span class="p">)</span>

<span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">mtrx</span><span class="p">,(</span><span class="n">cols</span><span class="p">,</span><span class="n">rows</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">),</span><span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="s">'input'</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">),</span><span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">dst</span><span class="p">),</span> <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="s">'output'</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><h2 id="perspective-변환">Perspective 변환 <a href="#perspective-변환" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>원근법을 적용한 변환으로 직선의 성질만 유지가 되고 선의 평행성은 유지되지 않는 변환이다. 즉 원근법이 되어 있는 이미지를 평평하게 펴준다. 반대의 변환도 가능하다.</p><p><code class="language-plaintext highlighter-rouge">cv2.getPerspectiveTransform</code> 함수를 통해서 얻을 수 있다. 이동할 4개의 점의 좌표가 필요하다. 결과값은 3x3 행렬이다. <code class="language-plaintext highlighter-rouge">cv2.warpPerpective()</code>함수에 변환 행렬값을 적용하면 이미지가 변환된다. 점의 순서는 좌상단부터 시작하여 반시계방향이다.</p><p><br /></p><ul><li><strong>perspective.py</strong></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">cv2</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="s">'chess.png'</span><span class="p">)</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">pts1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">280</span><span class="p">],[</span><span class="mi">380</span><span class="p">,</span><span class="mi">20</span><span class="p">],[</span><span class="mi">380</span><span class="p">,</span><span class="mi">280</span><span class="p">]])</span>

<span class="n">pts2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">float32</span><span class="p">([[</span><span class="mi">100</span><span class="p">,</span><span class="mi">20</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">280</span><span class="p">],[</span><span class="mi">300</span><span class="p">,</span><span class="mi">20</span><span class="p">],[</span><span class="mi">380</span><span class="p">,</span><span class="mi">280</span><span class="p">]])</span>

<span class="n">cv2</span><span class="p">.</span><span class="nf">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">20</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="mi">20</span><span class="p">,</span><span class="mi">280</span><span class="p">),</span><span class="mi">20</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="mi">380</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">20</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cv2</span><span class="p">.</span><span class="nf">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="mi">380</span><span class="p">,</span><span class="mi">380</span><span class="p">),</span><span class="mi">20</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">mtrx</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">getPerspectiveTransform</span><span class="p">(</span><span class="n">pts1</span><span class="p">,</span> <span class="n">pts2</span><span class="p">)</span>

<span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpPerspective</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mtrx</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">),</span><span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="s">'input'</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">),</span><span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">dst</span><span class="p">),</span> <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="s">'output'</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><p><br /></p><p>이 변환을 차선 검출에 적용한다면 perspective 변환을 적용할 것이다. 이렇게 변환한 영상을 bird eye view라고 한다. 이렇게 변환한다면 차선을 찾기가 편하게 된다.</p><p><br /></p><p><br /></p><h1 id="원근-변환을-이용한-차선-이미지-영상처리">원근 변환을 이용한 차선 이미지 영상처리</h1><p>perspective 변환을 통해 차선을 찾는다.</p><h2 id="원근-변환과-슬라이딩-윈도우">원근 변환과 슬라이딩 윈도우 <a href="#원근-변환과-슬라이딩-윈도우" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>단계</p><ol><li>camera calibration<li>bird`s eye view<li>이미지 임계값 및 이진화<li>슬라이딩 윈도우로 차선 위치 파악<li>파악된 차선 위치 원본이미지에 표시</ol><p><br /></p><h3 id="1-camera-calibration카메라-보정">1. Camera Calibration(카메라 보정) <a href="#1-camera-calibration카메라-보정" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>카메라는 곡면 렌즈를 사용해서 이미지를 형성하기 때문에 왜곡되어 보인다. 왜곡됨으로 인해 물체의 크기, 모양이 변경되기도 하고, 시야의 위치에 따라 모양이 변경되기도 한다. 따라서 이 왜곡을 변화시켜야 한다.</p><p>또한, 렌즈-이미지 센서와의 거리, 렌즈와 이미지 센서가 이루는 각도 등에 의해서도 왜곡이 발생할 수 있다. 실제적으로 보이게 보정하는 것을 camera calibration이라 한다.</p><p>체스보드는 정사각형으로 이루어져 있으므로 컴퓨터가 인식하기 쉽다. 그래서 체스판을 사용해서 왜곡을 보정할 수 있다.</p><p><br /></p><p>1-1. 자동으로 체스판을 찾아서 패턴을 매핑</p><ul><li>cv2.findchessboardCorners(), cv2.drawchessboardcorners() 함수 사용<ul><li>cv2.findchessboardCorners() : 체스 판의 코너들을 찾는다.<li>cv2.drawchessboardcorners() : 찾은 체스 판의 코너들을 그린다.</ul></ul><p>1-2. 교정 및 undistortion 계산</p><ul><li>cv2.calibrateCamera(), cv2.undistort() 함수 사용<ul><li>cv2.calibrateCamera() : camera matrix, 왜곡 계수, 회전/변환 벡터들을 리턴<li>cv2.undistort() : 이미지를 펴서 왜곡을 없어지게 한다.</ul></ul><p><br /></p><p>체스판을 통해 얻어진 calibrate를 통해 차선이미지를 calibration을 진행할 수 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">img_paths</span><span class="p">;</span>
	<span class="n">glob</span><span class="p">(</span><span class="s">"./data/*.bmp"</span><span class="p">,</span> <span class="n">img_paths</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">path</span> <span class="o">:</span> <span class="n">img_paths</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Mat</span> <span class="n">img</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Image load failed: "</span> <span class="o">&lt;&lt;</span> <span class="n">path</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">img_size</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

		<span class="n">Mat</span> <span class="n">gray</span><span class="p">;</span>
		<span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">COLOR_BGR2GRAY</span><span class="p">);</span>

		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">corners</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="n">found</span> <span class="o">=</span> <span class="n">findChessboardCorners</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">corners</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">TermCriteria</span> <span class="n">criteria</span><span class="p">(</span><span class="n">TermCriteria</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">EPS</span> <span class="o">|</span> <span class="n">TermCriteria</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">MAX_ITER</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">);</span>
			<span class="n">cornerSubPix</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">Size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">criteria</span><span class="p">);</span>

			<span class="n">obj_pts</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">objp</span><span class="p">);</span>
			<span class="n">img_pts</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">corners</span><span class="p">);</span>

			<span class="n">drawChessboardCorners</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pattern_size</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">found</span><span class="p">);</span>
			<span class="n">imshow</span><span class="p">(</span><span class="s">"img"</span><span class="p">,</span> <span class="n">img</span><span class="p">);</span>
			<span class="n">waitKey</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">destroyAllWindows</span><span class="p">();</span>

	<span class="c1">// Calculate intrinsic_matrix, distortion_coeffs</span>
	<span class="n">Mat</span> <span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="n">distortion_coeffs</span><span class="p">;</span>

	<span class="n">calibrateCamera</span><span class="p">(</span><span class="n">obj_pts</span><span class="p">,</span> <span class="n">img_pts</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="n">distortion_coeffs</span><span class="p">,</span> <span class="c1">// 왜곡 계수</span>
		<span class="n">noArray</span><span class="p">(),</span> <span class="n">noArray</span><span class="p">(),</span> <span class="n">CALIB_ZERO_TANGENT_DIST</span> <span class="o">|</span> <span class="n">CALIB_FIX_PRINCIPAL_POINT</span><span class="p">);</span>

    <span class="c1">// save them in a XML file</span>
    <span class="n">FileStorage</span> <span class="nf">fs</span><span class="p">(</span><span class="s">"intrinsics.xml"</span><span class="p">,</span> <span class="n">FileStorage</span><span class="o">::</span><span class="n">WRITE</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>저장된 정보는 불러올 수 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="c1">// Load intrinsic_matrix, distortion_coeffs from a XML file</span>
	<span class="n">FileStorage</span> <span class="n">fs</span><span class="p">(</span><span class="s">"intrinsics.xml"</span><span class="p">,</span> <span class="n">FileStorage</span><span class="o">::</span><span class="n">READ</span><span class="p">);</span>
    <span class="n">Mat</span> <span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="n">distortion_coeffs</span><span class="p">;</span>
	<span class="n">fs</span><span class="p">[</span><span class="s">"camera_matrix"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">intrinsic_matrix</span><span class="p">;</span>
	<span class="n">fs</span><span class="p">[</span><span class="s">"distortion_coefficients"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">distortion_coeffs</span><span class="p">;</span>

    <span class="n">Mat</span> <span class="n">map1</span><span class="p">,</span> <span class="n">map2</span><span class="p">;</span>     
	<span class="n">initUndistortRectifyMap</span><span class="p">(</span><span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="n">distortion_coeffs</span><span class="p">,</span> <span class="n">noArray</span><span class="p">(),</span>
		<span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">CV_16SC2</span><span class="p">,</span> <span class="n">map1</span><span class="p">,</span> <span class="n">map2</span><span class="p">);</span>

    <span class="n">Mat</span> <span class="n">frame</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="n">frame</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>

		<span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span>
		<span class="n">remap</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">map1</span><span class="p">,</span> <span class="n">map2</span><span class="p">,</span> <span class="n">INTER_LINEAR</span><span class="p">);</span>

        <span class="n">imshow</span><span class="p">(</span><span class="s">"frame"</span><span class="p">,</span> <span class="n">frame</span><span class="p">);</span>
		<span class="n">imshow</span><span class="p">(</span><span class="s">"dst"</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><br /></p><p><br /></p><h3 id="2-birds-eye-view">2. Bird’s eye View <a href="#2-birds-eye-view" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>왜곡이 없는 차선 이미지를 bird’s eye view 구도로 변환한다. 원근 변환을 하는 것이므로 <code class="language-plaintext highlighter-rouge">cv2.getPerspectiveTransform(src,dst)</code>를 사용하여 원근 변환 행렬을 얻는다.</p><p><br /></p><p><code class="language-plaintext highlighter-rouge">원래 이미지 -\&gt; 조감도 -\&gt; 원래 이미지</code> 의 방식으로 두 번 변환해야 한다.</p><p><br /></p><p>원근 변환을 위한 4개의 점을 어떻게 얻을까?</p><p>위에서 도로를 내려다 볼때 직사각형을 나타내야 하므로 사다리꼴 모양의 4개 점을 찾아야 한다. 색상이나 속성 등을 분석해서 선택한다.</p><p><br /></p><h3 id="3-이미지-이진화">3. 이미지 이진화 <a href="#3-이미지-이진화" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>임계값을 주어 이진화를 진행한다. 그를 위해 이미지를 grayscale로 변환한 후 이진화한다.</p><ul><li><strong>색상 표현</strong></ul><ol><li>HSV<ul><li>H: 색조, S: 채도, V: 명도<li>명도가 낮을 수록 검은색, 명도가 낮고 채도가 낮을 수록 흰색</ul><li>LAB<ul><li>사람 눈이 감지할 수 있는 색차와 색공간에서 수치로 표현한 색차를 거의 일치시킬 수 있는 색공간<li>L: 명도, A: Red and Green, B: Yellow and Blue<li><strong>노란색 차선을 인식할 때 B를 사용하면 좋은 성능을 낼 수 있다고 한다.</strong></ul><li>HLS<ul><li>색상 균형, HSV의 V를 L로 바꾼 것<li>H: 색조, L: 밝기, S: 채도<li>밝기가 낮을 수록 검은색, 밝기가 높을 수록 흰색<li><strong>흰색 차선을 인식할 때 L을 사용하면 좋은 성능을 낸다고 한다.</strong></ul></ol><p><br /></p><h3 id="4-슬라이딩-윈도우">4. 슬라이딩 윈도우 <a href="#4-슬라이딩-윈도우" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>차선을 찾는 방법</p><ul><li><strong>히스토그램</strong></ul><p>도로 이미지에 보정, 임계값 및 원근 변화을 적용하여 차선이 두드러지는 이진 이미지를 얻은 후 어떤 픽셀이 라인의 일부이고 이게 왼쪽인지 오른쪽인지를 결정해야 한다. 이를 위해 히스토그램을 사용한다. 각 열에 따라 픽셀 개수를 더하면 히스토그램에서 가장 눈에 띄는 두 개의 <strong>peak</strong>, 즉 높은 막대기 2개가 생성되고, 이 2개의 위치가 <strong>차선의 x위치</strong>라 할 수 있다.</p><p><br /></p><ul><li><strong>슬라이딩 윈도우</strong> 선 중심 주변에 배치된 슬라이딩 윈도우를 사용해서 프레임 상단까지 선을 찾아 따라가게 하여 곡선을 찾는다. 방금 찾은 히스토그램의 차선 x위치의 시작점, 즉 제일 하단점을 이용하여 첫 윈도우의 위치를 정한다. 그 위도우안의 점들의 평균점을 기준으로 바로 위에 쌓는다. 그렇게 최상단까지 쌓다보면 곡선을 찾을 수 있다.</ul><p>파악을 한 후 윈도우의 중심을 통해 선을 그리는데, <code class="language-plaintext highlighter-rouge">polyfit</code> 함수를 사용해서 2차원을 찾아준다. 이 선은 원본 이미지에 차선을 그리기 위한 선이다. 이 2차원 함수 2개사이의 영역을 <code class="language-plaintext highlighter-rouge">polygon</code> 함수를 통해 다각형을 원본 이미지에 그린다.</p><p><br /></p><ul><li>실행 결과</ul><p><img data-src="/assets\img\dev\week7\day2\lanedetect.png" data-proofer-ignore></p><p><br /></p><p><br /></p><h2 id="차선-인식-구현">차선 인식 구현 <a href="#차선-인식-구현" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>summary 1. Image read 2. warping (원근 변환) 3. gaussian blur (노이즈 제거) 4. threshold (이진 이미지 변환) 5. histogram (차선 위치 추출) 6. sliding window (윈도우 생성) 7. polyfit (2차 함수 그래프로 차선 그리기) 8. 차선 영역 표시 (원본 이미지에 영역 오버레이) 9. 핸들 조향각 결정 10. 핸들 조종</p></blockquote><p><br /></p><p><br /></p><h3 id="1-작업-환경-설정">1. 작업 환경 설정 <a href="#1-작업-환경-설정" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>필요한 파일</strong></p><ul><li><code class="language-plaintext highlighter-rouge">sliding_drive</code> 패키지에서 작업<li><code class="language-plaintext highlighter-rouge">sliding_find.py</code><li><code class="language-plaintext highlighter-rouge">car_track1.avi</code>,<code class="language-plaintext highlighter-rouge">road_video1.mp4</code>,<code class="language-plaintext highlighter-rouge">road_video2.mp4</code></ul><p><br /></p><ul><li><strong>sliding_find.py</strong></ul><ol><li>영상 프레임 추출<li>카메라 calibration 설정값을 통해 이미지 보정<li>원근 변환을 통해 bird’s eye view로 변환<li>노이즈 제거, HLS포맷으로 변경, 이진화 처리<li>히스토그램을 통해 좌우 차선 시작 위치 파악<li>슬라이딩 윈도우를 좌우 9개씩 쌓아 올리기<li>9개 윈도우 안의 중앙점을 모두 지나는 2차함수 찾기<li>원본 이미지에 차선 영역을 표시하는 영역 오버레이</ol><p><br /></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding: utf-8 -*-
</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">cv2</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">copy</span>

<span class="n">width</span> <span class="o">=</span> <span class="mi">640</span>
<span class="n">height</span> <span class="o">=</span> <span class="mi">480</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nc">VideoCapture</span><span class="p">(</span><span class="s">"xycar_track1.mp4"</span><span class="p">)</span>
<span class="n">window_title</span> <span class="o">=</span> <span class="s">'camera'</span>

<span class="c1"># 1.
</span><span class="n">warp_img_w</span> <span class="o">=</span> <span class="mi">320</span> <span class="c1"># w * 1/2
</span><span class="n">warp_img_h</span> <span class="o">=</span> <span class="mi">240</span> <span class="c1"># h * 1/2
</span>
<span class="n">warpx_margin</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">warpy_margin</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># 2.
</span><span class="n">nwindows</span> <span class="o">=</span> <span class="mi">9</span>

<span class="c1"># 3.
</span><span class="n">margin</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c1"># 4.
</span><span class="n">minpixel</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">lane_bin_th</span> <span class="o">=</span> <span class="mi">145</span>

<span class="c1"># 5.
</span><span class="n">warp_src</span>  <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">230</span><span class="o">-</span><span class="n">warpx_margin</span><span class="p">,</span> <span class="mi">300</span><span class="o">-</span><span class="n">warpy_margin</span><span class="p">],</span>  
    <span class="p">[</span><span class="mi">45</span><span class="o">-</span><span class="n">warpx_margin</span><span class="p">,</span>  <span class="mi">450</span><span class="o">+</span><span class="n">warpy_margin</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">445</span><span class="o">+</span><span class="n">warpx_margin</span><span class="p">,</span> <span class="mi">300</span><span class="o">-</span><span class="n">warpy_margin</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">610</span><span class="o">+</span><span class="n">warpx_margin</span><span class="p">,</span> <span class="mi">450</span><span class="o">+</span><span class="n">warpy_margin</span><span class="p">]</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># 6.
</span><span class="n">warp_dst</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">warp_img_h</span><span class="p">],</span>
    <span class="p">[</span><span class="n">warp_img_w</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="n">warp_img_w</span><span class="p">,</span> <span class="n">warp_img_h</span><span class="p">]</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># 7.
</span><span class="n">calibrated</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">if</span> <span class="n">calibrated</span><span class="p">:</span>
    <span class="n">mtx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">422.037858</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">245.895397</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">435.589734</span><span class="p">,</span> <span class="mf">163.625535</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="p">])</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.289296</span><span class="p">,</span> <span class="mf">0.061035</span><span class="p">,</span> <span class="mf">0.001786</span><span class="p">,</span> <span class="mf">0.015238</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">cal_mtx</span><span class="p">,</span> <span class="n">cal_roi</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">getOptimalNewCameraMatrix</span><span class="p">(</span><span class="n">mtx</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

<span class="c1"># 8.
</span><span class="k">def</span> <span class="nf">calibrate_image</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
    <span class="k">global</span> <span class="n">mtx</span><span class="p">,</span> <span class="n">dst</span>
    <span class="k">global</span> <span class="n">cal_mtx</span><span class="p">,</span> <span class="n">cal_roi</span>
    
    <span class="n">tf_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">undistort</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">mtx</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cal_mtx</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cal_roi</span>
    <span class="n">tf_image</span> <span class="o">=</span> <span class="n">tf_image</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">resize</span><span class="p">(</span><span class="n">tf_image</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

<span class="c1"># 9.
</span><span class="k">def</span> <span class="nf">warp_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="n">m_to_dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">getPerspectiveTransform</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="n">m_to_src</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">getPerspectiveTransform</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
    <span class="n">warp_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpPerspective</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">m_to_dst</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">warp_img</span><span class="p">,</span> <span class="n">m_to_dst</span><span class="p">,</span> <span class="n">m_to_src</span>

<span class="c1"># 10.
</span><span class="k">def</span> <span class="nf">warp_process_image</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">nwindows</span>
    <span class="k">global</span> <span class="n">margin</span>
    <span class="k">global</span> <span class="n">minpixel</span>
    <span class="k">global</span> <span class="n">lane_bin_th</span>

    <span class="c1"># 11.
</span>    <span class="n">blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nc">GaussianBlur</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># take the value, only B(yellow and blue) to detect yellow line easily
</span>    <span class="c1"># but, in video, there is no yellow line, so in this code, do not take B
</span>    <span class="c1"># _, _, B = cv2.split(cv2.cvtColor(blur, cv2.COLOR_BGR2LAB))
</span>
    <span class="c1"># 12.
</span>    <span class="n">_</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="nf">cvtColor</span><span class="p">(</span><span class="n">blur</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2HLS</span><span class="p">))</span>

    <span class="c1"># 13.
</span>    <span class="n">_</span><span class="p">,</span> <span class="n">lane</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">threshold</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">lane_bin_th</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>

    <span class="c1"># 14.
</span>    <span class="n">histogram</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">lane</span><span class="p">[</span><span class="n">lane</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">:,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># 15.
</span>    <span class="n">midpoint</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">int</span><span class="p">(</span><span class="n">histogram</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># 16.
</span>    <span class="n">leftx_current</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">histogram</span><span class="p">[:</span><span class="n">midpoint</span><span class="p">])</span>

    <span class="c1"># 17.
</span>    <span class="n">rightx_current</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="n">midpoint</span><span class="p">:])</span> <span class="o">+</span> <span class="n">midpoint</span>

    <span class="c1"># 18.
</span>    <span class="n">window_height</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">int</span><span class="p">(</span><span class="n">lane</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">nwindows</span><span class="p">)</span>
    <span class="n">nz</span> <span class="o">=</span> <span class="n">lane</span><span class="p">.</span><span class="nf">nonzero</span><span class="p">()</span>

    <span class="n">left_lane_inds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">right_lane_inds</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="c1"># 19.
</span>    <span class="n">out_img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">dstack</span><span class="p">((</span><span class="n">lane</span><span class="p">,</span> <span class="n">lane</span><span class="p">,</span> <span class="n">lane</span><span class="p">))</span><span class="o">*</span><span class="mi">255</span>

    <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">nwindows</span><span class="p">):</span>

        <span class="c1"># 20.
</span>        <span class="n">win_yl</span> <span class="o">=</span> <span class="n">lane</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">window</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">window_height</span>
        <span class="n">win_yh</span> <span class="o">=</span> <span class="n">lane</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">window</span><span class="o">*</span><span class="n">window_height</span>

        <span class="c1"># 21.
</span>        <span class="n">win_xll</span> <span class="o">=</span> <span class="n">leftx_current</span> <span class="o">-</span> <span class="n">margin</span>
        <span class="n">win_xlh</span> <span class="o">=</span> <span class="n">leftx_current</span> <span class="o">+</span> <span class="n">margin</span>
        <span class="n">win_xrl</span> <span class="o">=</span> <span class="n">rightx_current</span> <span class="o">-</span> <span class="n">margin</span>
        <span class="n">win_xrh</span> <span class="o">=</span> <span class="n">rightx_current</span> <span class="o">+</span> <span class="n">margin</span>

        <span class="c1"># 22.
</span>        <span class="n">cv2</span><span class="p">.</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">out_img</span><span class="p">,(</span><span class="n">win_xll</span><span class="p">,</span><span class="n">win_yl</span><span class="p">),(</span><span class="n">win_xlh</span><span class="p">,</span><span class="n">win_yh</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> 
        <span class="n">cv2</span><span class="p">.</span><span class="nf">rectangle</span><span class="p">(</span><span class="n">out_img</span><span class="p">,(</span><span class="n">win_xrl</span><span class="p">,</span><span class="n">win_yl</span><span class="p">),(</span><span class="n">win_xrh</span><span class="p">,</span><span class="n">win_yh</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># 23.
</span>        <span class="n">good_left_inds</span> <span class="o">=</span> <span class="p">((</span><span class="n">nz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">win_yl</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">win_yh</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">win_xll</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">win_xlh</span><span class="p">)).</span><span class="nf">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">good_right_inds</span> <span class="o">=</span> <span class="p">((</span><span class="n">nz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">win_yl</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">win_yh</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">win_xrl</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">win_xrh</span><span class="p">)).</span><span class="nf">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">left_lane_inds</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">good_left_inds</span><span class="p">)</span>
        <span class="n">right_lane_inds</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">good_right_inds</span><span class="p">)</span>

        <span class="c1"># 24.
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">good_left_inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">minpixel</span><span class="p">:</span>
            <span class="n">leftx_current</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">good_left_inds</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">good_right_inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">minpixel</span><span class="p">:</span>        
            <span class="n">rightx_current</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">good_right_inds</span><span class="p">]))</span>

        <span class="c1"># 25.
</span>        <span class="n">lx</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">leftx_current</span><span class="p">)</span>
        <span class="n">ly</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">win_yl</span> <span class="o">+</span> <span class="n">win_yh</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rx</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">rightx_current</span><span class="p">)</span>
        <span class="n">ry</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">win_yl</span> <span class="o">+</span> <span class="n">win_yh</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># 26.
</span>    <span class="n">left_lane_inds</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">(</span><span class="n">left_lane_inds</span><span class="p">)</span>
    <span class="n">right_lane_inds</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">(</span><span class="n">right_lane_inds</span><span class="p">)</span>

    <span class="c1">#left_fit = np.polyfit(nz[0][left_lane_inds], nz[1][left_lane_inds], 2)
</span>    <span class="c1">#right_fit = np.polyfit(nz[0][right_lane_inds] , nz[1][right_lane_inds], 2)
</span>
    <span class="c1"># 27.
</span>    <span class="n">lfit</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">polyfit</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">ly</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">lx</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">rfit</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">polyfit</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">ry</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># 28.
</span>    <span class="n">out_img</span><span class="p">[</span><span class="n">nz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">left_lane_inds</span><span class="p">],</span> <span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">left_lane_inds</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">out_img</span><span class="p">[</span><span class="n">nz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">right_lane_inds</span><span class="p">]</span> <span class="p">,</span> <span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">right_lane_inds</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
    <span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="s">"viewer"</span><span class="p">,</span> <span class="n">out_img</span><span class="p">)</span>
    
    <span class="c1">#return left_fit, right_fit
</span>    <span class="k">return</span> <span class="n">lfit</span><span class="p">,</span> <span class="n">rfit</span>

<span class="k">def</span> <span class="nf">draw_lane</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">warp_img</span><span class="p">,</span> <span class="n">m_to_src</span><span class="p">,</span> <span class="n">left_fit</span><span class="p">,</span> <span class="n">right_fit</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">warp_img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ploty</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

    <span class="c1"># 29.
</span>    <span class="n">color_warp</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">warp_img</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="c1"># 30.
</span>    <span class="n">left_fitx</span> <span class="o">=</span> <span class="n">left_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ploty</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">left_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ploty</span> <span class="o">+</span> <span class="n">left_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">right_fitx</span> <span class="o">=</span> <span class="n">right_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ploty</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">right_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ploty</span> <span class="o">+</span> <span class="n">right_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># 31.
</span>    <span class="n">pts_left</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="nf">transpose</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">([</span><span class="n">left_fitx</span><span class="p">,</span> <span class="n">ploty</span><span class="p">]))])</span>
    <span class="n">pts_right</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="nf">flipud</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">transpose</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">([</span><span class="n">right_fitx</span><span class="p">,</span> <span class="n">ploty</span><span class="p">])))])</span> 
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">hstack</span><span class="p">((</span><span class="n">pts_left</span><span class="p">,</span> <span class="n">pts_right</span><span class="p">))</span>

    <span class="c1"># 31.
</span>    <span class="n">color_warp</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">fillPoly</span><span class="p">(</span><span class="n">color_warp</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">int_</span><span class="p">([</span><span class="n">pts</span><span class="p">]),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">newwarp</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">warpPerspective</span><span class="p">(</span><span class="n">color_warp</span><span class="p">,</span> <span class="n">m_to_src</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">addWeighted</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">newwarp</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">cap</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">frame</span><span class="p">.</span><span class="n">size</span> <span class="o">==</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">height</span><span class="o">*</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
        <span class="k">continue</span>

    <span class="nf">print</span><span class="p">(</span><span class="s">"start"</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">cap</span><span class="p">.</span><span class="nf">isOpened</span><span class="p">():</span>
        
        <span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>

        <span class="n">image</span> <span class="o">=</span> <span class="nf">calibrate_image</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">warp_img</span><span class="p">,</span> <span class="n">m_to_dst</span><span class="p">,</span> <span class="n">m_to_src</span> <span class="o">=</span> <span class="nf">warp_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">warp_src</span><span class="p">,</span> <span class="n">warp_dst</span><span class="p">,</span> <span class="p">(</span><span class="n">warp_img_w</span><span class="p">,</span> <span class="n">warp_img_h</span><span class="p">))</span>
        <span class="n">left_fit</span><span class="p">,</span> <span class="n">right_fit</span> <span class="o">=</span> <span class="nf">warp_process_image</span><span class="p">(</span><span class="n">warp_img</span><span class="p">)</span>
        <span class="n">lane_img</span> <span class="o">=</span> <span class="nf">draw_lane</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">warp_img</span><span class="p">,</span> <span class="n">m_to_src</span><span class="p">,</span> <span class="n">left_fit</span><span class="p">,</span> <span class="n">right_fit</span><span class="p">)</span>

        <span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">window_title</span><span class="p">,</span> <span class="n">lane_img</span><span class="p">)</span>

        <span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="nf">start</span><span class="p">()</span>
</pre></table></code></div></div><blockquote><p>1.기존의 크기보다 1/2 크기의 출력 영상에 대한 크기</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre>2.슬라이딩 윈도우 개수

3.슬라이딩 윈도우 넓이

4.선을 그리기 위해 최소한 있어야할 점의 개수, lane_binary_threshold(선을 판단하기 위한 이진화의 임계값)

5.변환 전 좌표 행렬

6.변환 후 좌표 행렬

7.자이카 카메라로 촬영된 동영상이므로 자이카 카메라의 calibration보정값을 사용한다.

8.위에서 구한 보정 행렬값을 적용하여 이미지를 반듯하게 수정하는 함수

9.변환 전과 후의 4개 점 좌표를 전달받아서 이미지를 원근 변환 처리하여 새로운 이미지를 만든다.

10.이미지를 처리하는 함수

11.5x5 kernel filter을 적용한 가우시안 블러링

12.흰색선을 잘 찾기 위해 HLS로 변환한 후 L값만 추출, 영상에서 노란색선이 없어서 LAB으로 변환은 하지 않았으나 있다면 LAB로 변환하여 B값만 추출한다.

13.임계값을 이용하여 이진화한다. lane은 이진화된 조감도 이미지의 행렬(320,240)일 것이다.

14.히스토그램의 x,y축을 정의한다. x축 : 픽셀의 x좌표값, y축 : 특정 x좌표값을 갖는 모든 흰색 픽셀의 개수

15.x축을 반으로 나누어 왼쪽 차선과 오른쪽 차선을 구분한다.

16.왼쪽 절반 구역에서 흰색 픽셀의 개수가 가장 많은 위치를 슬라이딩 윈도우 중심 좌표로 두어 왼쪽 윈도우의 시작 위치로 잡는다. 시작 위치에서만 이 값을 사용하고 나머지는 아래의 평균값을 사용한다.

17.픽셀의 개수가 가장 많은 위치를 오른쪽 윈도우의 시작 위치를 잡는다.

18.1개의 윈도우의 높이를 구함

19.

20.각 윈도우의 상단, 하단 y좌표

21.윈도우 넓이를 구하는데, win_xlh - win_xll = 윈도우 가로 값, xrh-xrl = 윈도우 세로 값

22.윈도우마다 사각형 그리기, (dst, 좌상단 좌표,우하단 좌표,색상,두께)

23.슬라이딩 윈도우 박스 하나 안에 있는 흰색 픽셀의 x좌표들을 모두 모든다. 왼쪽 오른쪽은 따로 계산한다. zero가 아닌 것들에 대한 점들을 다 구하고 x좌표만 추출한다.

24.위에서 구한 x좌표 리스트에서 흰색점이 5개 이상인 경우에 한해서 x좌표의 평균값을 구한다. 이 값을 위에 쌓을 슬라이딩 윈도우의 중심점으로 사용한다.

25.슬라이딩 윈도우의 중심점을 저장한다. 이는 2차함수 그릴 때 사용한다.

26.

27.슬라이딩 윈도우의 중심 좌표 9개를 가지고 2차함수를 만들어낸다.

28.기존 하얀색 차선 픽셀을 왼쪽 오른쪽 각각 파란색과 빨간색으로 색상 변경

29.zeros matrix, warp_img 크기의 0으로 된 행렬을 생성한다.

30.

31.구해놓은 2차함수의 상수들을 이용해서 사다리꼴 이미지 외곽선 픽셀 좌표를 계산한다.

32.사다리꼴 이미지를 칼라로 그리고 거꾸로 원근 변환하여 원본 이미지와 오버레이 한다. &gt;
</pre></table></code></div></div><p><br /></p><p><br /></p><h2 id="ros에서-슬라이딩-윈도우-기반-차선-인식-주행">ROS에서 슬라이딩 윈도우 기반 차선 인식 주행 <a href="#ros에서-슬라이딩-윈도우-기반-차선-인식-주행" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>sliding_drive.launch</ul><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
  <span class="c">&lt;!-- 노드 실행 : 자이카 모터 제어기 구동 --&gt;</span>
  <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">"$(find xycar_motor)/launch/xycar_motor.launch"</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- 노드 실행 : 자이카 카메라 구동 --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"usb_cam"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="na">pkg=</span><span class="s">"usb_cam"</span> <span class="na">type=</span><span class="s">"usb_cam_node"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"video_device"</span> <span class="na">value=</span><span class="s">"/dev/videoCAM"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"autoexposure"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"exposure"</span> <span class="na">value=</span><span class="s">"50"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"image_width"</span> <span class="na">value=</span><span class="s">"640"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"image_height"</span> <span class="na">value=</span><span class="s">"480"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"pixel_format"</span> <span class="na">value=</span><span class="s">"yuyv"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"camera_frame_id"</span> <span class="na">value=</span><span class="s">"usb_cam"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"io_method"</span> <span class="na">value=</span><span class="s">"mmap"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>

  <span class="c">&lt;!-- 노드 실행 : 슬라이딩 윈도우 기반 주행 프로그램인 sliding_drive.py 실행 --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"auto_drive"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="na">pkg=</span><span class="s">"sliding_drive"</span> <span class="na">type=</span><span class="s">"sliding_drive.py"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/launch&gt;</span>

</pre></table></code></div></div><p><br /></p><p><br /></p><ul><li>sliding_drive.py</ul><p>작업 흐름도</p><ol><li>카메라 노드가 보내는 토픽에서 영상 프레임 추출<li>카메라 calibration 설정값으로 이미지 보정<li>원근 변환으로 차선 이미지를 Bird’s eye view로 변환<li>openCV영상처리<ul><li>Gaussian blur (노이즈 제거)<li>cvtColor (BGR2HLS)<li>threshold (이진화 처리)</ul><li>히스토그램을 사용해서 좌우 차선의 시작 위치 파악<li>슬라이딩 윈도우를 좌우 9개씩 쌓아 올리기<li>왼쪽 오른쪽 차선의 위치 찾기<li>적절한 조향값 계산하고, 모터 제어 토픽 발행</ol><p><br /></p><p>차선에 대한 2차함수가 쌓여 있고, 윈도우가 총 9개 있을 때, 내가 보고자 하는 윈도우의 번호에 있는 x좌표를 구해서 두개의 평균을 구한다. 그리고 그것과 이미지의 중앙값을 비교하여 조향각을 결정한다.</p><p><code class="language-plaintext highlighter-rouge">/usb_cam -\&gt; /usb_cam/image_raw/ -\&gt; /sliding_drive -\&gt; /xycar_motor -\&gt; /xycar_motor</code></p></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/warping/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/warping.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/classlog/'>Classlog</a>, <a href='/categories/devcourse/'>devcourse</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/devcourse/" class="post-tag no-text-decoration" >devcourse</a> <a href="/tags/sliding-window/" class="post-tag no-text-decoration" >sliding window</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/warping/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/warping/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/warping/&amp;text=[데브코스] 7주차 - ROS wraping transformation and lane detection by sliding window - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/warping/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[깃허브 프로필 꾸미기] github 프로필 만들기</a><li><a href="/posts/product/">[깃허브 프로필 꾸미기] productive box 만들기</a><li><a href="/posts/regex/">[데브코스] 2주차 - linux 기초(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation 과 StratifiedKFold</a><li><a href="/posts/cmake/">[데브코스] 17주차 - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/start/"><div class="card-body"> <em class="timeago small" date="2022-02-14 13:00:00 +0900" >Feb 14, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 카테고리 설명 및 개요</h3><div class="text-muted small"><p> 데브코스라는 교육을 받으면서 배웠던 내용을 기재하고자 한다. 최대한 많은 내용을 담고 싶지만, 저작권으로 인해 적지 못하는 부분도 많을 것 같다. 원래는 노션에 기록하고 있었지만, 매번 블로그에 기재하던 것처럼 블로그에 업로드해야 계속 기록에 남기도 하고 다음 번에도 계속 볼 것 같다.</p></div></div></a></div><div class="card"> <a href="/posts/algorithm/"><div class="card-body"> <em class="timeago small" date="2022-02-15 13:00:00 +0900" >Feb 15, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 1주차 - 알고리즘 문제 풀기 (1)</h3><div class="text-muted small"><p> 코드에 대한 주석들은 추후에 달도록 하겠습니다. 현재는 블로그 정리만 하려고 올리는 것입니다. 자료구조와 알고리즘 자료구조 문자열 (str) “this is a string” 리스트 (list) [4,9,2,7] 사전 (dict) {‘a’:2, ‘bc’,:6} 순서쌍 (tuple), 집합 (set), … 해결할 문제에...</p></div></div></a></div><div class="card"> <a href="/posts/algorithm2/"><div class="card-body"> <em class="timeago small" date="2022-02-17 13:00:00 +0900" >Feb 17, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 1주차 - 알고리즘 문제 풀기 (2)</h3><div class="text-muted small"><p> 스택 (stack) 스택: 자료를 보관할 수 있는 선형 구조 x.isempty() : 스택이 비어있는지 판단한다. x.peek() : 스택에 가장 나중에 저장된 데이터 원소를 참조한다. x.size() x.push() x.pop() 단, 넣을 때는 한 쪽 끝에서 밀어 넣어야 하는 push 연산, 꺼낼 때는 같은 쪽에서 뽑아 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/git/" class="btn btn-outline-primary" prompt="Older"><p>[데브코스] 7주차 - GitHub로 협업하기</p></a> <a href="/posts/yolo/" class="btn btn-outline-primary" prompt="Newer"><p>[논문 리뷰] YOLO-based lane detection system</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>