<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[데브코스] 6주차 - OpenCV Image Geometric Transformation" /><meta name="author" content="JaeHo YooN" /><meta property="og:locale" content="en" /><meta name="description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><meta property="og:description" content="Do focus on developing ‘your ability’ rather than waste time on making you famous." /><link rel="canonical" href="https://dkssud8150.github.io/posts/opencv3/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/opencv3/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-22T14:01:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[데브코스] 6주차 - OpenCV Image Geometric Transformation" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo YooN"},"dateModified":"2022-04-13T13:35:06+09:00","datePublished":"2022-03-22T14:01:00+09:00","description":"Do focus on developing ‘your ability’ rather than waste time on making you famous.","headline":"[데브코스] 6주차 - OpenCV Image Geometric Transformation","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/opencv3/"},"url":"https://dkssud8150.github.io/posts/opencv3/"}</script><title>[데브코스] 6주차 - OpenCV Image Geometric Transformation | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[데브코스] 6주차 - OpenCV Image Geometric Transformation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/dev/week6/day2/geometric.png" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore><h1 data-toc-skip>[데브코스] 6주차 - OpenCV Image Geometric Transformation</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-03-22 14:01:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Tue, Mar 22, 2022, 2:01 PM +0900" >Mar 22, 2022</em> </span> <span> Updated <em class="timeago" date="2022-04-13 13:35:06 +0900 " data-toggle="tooltip" data-placement="bottom" title="Wed, Apr 13, 2022, 1:35 PM +0900" >Apr 13, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6421 words"> <em>35 min</em> read</span></div></div></div><div class="post-content"><p><br /></p><h1 id="컬러-영상-처리의-기초">컬러 영상 처리의 기초</h1><h2 id="컬러-영상의-픽셀-값-참조">컬러 영상의 픽셀 값 참조 <a href="#컬러-영상의-픽셀-값-참조" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>OpenCV에서 컬러 영상 표현 방법<ul><li>빨강,초록, 파랑 색 성분을 256단계로 표현<li>opencv에서는 RGB순서가 아니라 <strong>BGR</strong>순서임</ul><li>OpenCV에서 컬러 영상 다루기</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">img1</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"lenna.bmp"</span><span class="p">,</span><span class="n">IMREAD_COLOR</span><span class="p">);</span>
<span class="n">Mat</span> <span class="nf">img2</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span> <span class="c1">// 3 channels</span>

<span class="n">Mat</span> <span class="n">img3</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"lenna.bmp"</span><span class="p">,</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
<span class="n">Mat</span> <span class="n">img4</span><span class="p">;</span>
<span class="n">cvtColor</span><span class="p">(</span><span class="n">img3</span><span class="p">,</span><span class="n">img4</span><span class="p">,</span><span class="n">COLOR_GRAY2BGR</span><span class="p">);</span> <span class="c1">// 눈으로 보기에는 동일하게 회색으로 나오게 된다. 이 때는 B=G=R 값이 같기 때문이다. 그러므로 1픽셀당 3byte를 차지하고 있다.</span>

<span class="n">circle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">Point</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span> <span class="mi">100</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// grayscale이므로 밝기가 된다. 그래서 색이 아닌 밝기가 255</span>
<span class="n">circle</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span><span class="n">Point</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span> <span class="mi">100</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// truecolor이므로 bgr순서의 스칼라값이 된다. 그래서 파란색</span>
</pre></table></code></div></div><p><br /></p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"lenna.bmp"</span><span class="p">);</span>

<span class="n">Mat</span> <span class="n">dst</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">src</span><span class="p">;</span> <span class="c1">// 이렇게 하면 파란색으로 된다.</span>
</pre></table></code></div></div><p><img data-src="/assets\img\dev\week6\day1\colorconverterbefore.png" data-proofer-ignore></p><p>이 결과는 올바르지 않다. 이 코드는 <code class="language-plaintext highlighter-rouge">Mat dst = Scalar(255,0,0,0) -src;</code>로 인식되므로 blue성분만 처리된다.</p><p><br /></p><p><br /></p><p>따라서 아래와 같이 3채널로 지정해줘야 반전이 된다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span> <span class="o">-</span> <span class="n">src</span><span class="p">;</span> 
</pre></table></code></div></div><p><img data-src="/assets\img\dev\week6\day1\colorconverter.png" data-proofer-ignore></p><p><br /></p><p>반전을 직접 구현하면 다음과 같다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="nf">dst</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dst</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//Blue</span>
        <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//Green</span>
        <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">//Red</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>여기서 중요한 것은 원래는 uchar이었던 자료형대신 <code class="language-plaintext highlighter-rouge">Vec3b</code> 자료형을 사용해야 한다. 전체 구현</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="cm">/* 1번째 방법 */</span>
<span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//Blue</span>
<span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//Green</span>
<span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">//Red</span>

<span class="cm">/* 2번째 방법 */</span>
<span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Vec3b</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>

<span class="cm">/* 3번째 방법 */</span>
<span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">Vec3b</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span> <span class="o">-</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</pre></table></code></div></div><p>이 3가지 방법은 다 동일하게 동작한다.</p><p><br /></p><p><br /></p><h1 id="이동-변환과-전단-전환">이동 변환과 전단 전환</h1><ul><li>강체변환(Rigid-body) : 크기 및 각도가 보존되는 변환 (translation,rotation)<li>유사변환(similarity) : 크기는 변하고 각도는 보존되는 변환 (scaling)<li>선형변환(linear) : vector공간에서의 이동<li>affine : 선형변환과 이동변환까지 포함, 선의 수평선은 유지<li>perspective : affine 변환에 수평성도 유지되지 않음, 원근 변환</ul><h2 id="영상의-기하학적-변환geometric-transformation">영상의 기하학적 변환(geometric transformation) <a href="#영상의-기하학적-변환geometric-transformation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>영상을 구성하는 픽셀의 배치 구조를 변경함으로써 전체 영상의 모양을 바꾸는 작업이다. 전처리 작업, 영상 정합(image registration), 왜곡 제거 등이 이에 해당한다.</p><p><img data-src="/assets/img/dev/week6/day2/geometric.png" data-proofer-ignore></p><h3 id="영상의-이동-변환">영상의 이동 변환 <a href="#영상의-이동-변환" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>이동 변환(translation transform)</p><ul><li>가로 또는 세로 방향으로 영상을 특정 크기만큼 이동시키는 변환<li>x축과 y축 방향으로의 이동 변위를 지정할 수 있다.</ul><p><img data-src="/assets\img\dev\week6\day2\translation.png" data-proofer-ignore></p><p>출력 영상을 (x’, y’)이라 할 때</p><ul><li>x’ = x + a<li>y’ = y + b</ul><p>이를 행렬로 표기하면 다음과 같다.</p><p><img data-src="/assets\img\dev\week6\day2\matrix.png" data-proofer-ignore></p><p>아래 행렬에서 1은 행렬의 수식을 위해 존재하는 추가항이다. 이 때, 2x3 행렬을 <code class="language-plaintext highlighter-rouge">2x3 어파인 변환 행렬</code>이라 한다.</p><p><br /></p><ul><li>코드 구현</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"lenna.bmp"</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>

<span class="n">Mat</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">zeros</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_8UC1</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">x_</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">y_</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">x_</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">x_</span> <span class="o">&gt;=</span> <span class="n">dst</span><span class="p">.</span><span class="n">cols</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">y_</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">y_</span> <span class="o">&gt;=</span> <span class="n">dst</span><span class="p">.</span><span class="n">rows</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
			<span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y_</span><span class="p">,</span> <span class="n">x_</span><span class="p">)</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
</pre></table></code></div></div><p>그레이 스케일 영상을 (100,100) 이동하는 변환 프로그램을 나타낸 것이다. 이중 for 루프를 이용하여 직접 구현했다. 이를 구현한 이유는 OpenCV에서는 이동 변환이나 전단 변환에 대한 함수가 따로 지원되지 않아서 알고리즘을 직접 구현하거나 행렬을 직접 생성해서 warpAffine을 시킬 수 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">trans</span> <span class="o">=</span> <span class="p">(</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// (1 0 100; 0 1 100) ==&gt; 가로 100, 세로 100 이동하는 이동 변환 행렬</span>

<span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span> 
<span class="n">warpAffine</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">Size</span><span class="p">());</span> 
</pre></table></code></div></div><p><img data-src="/assets\img\dev\week6\day2\trans1.png" data-proofer-ignore></p><p><br /></p><p>행렬(trans)에서 1대신 0.5씩 주면 1/2배 축소되어 출력되는 것을 볼 수 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">trans</span> <span class="o">=</span> <span class="p">(</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> 

<span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span> 
<span class="n">warpAffine</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="mi">700</span><span class="p">));</span> <span class="c1">// 사이즈를 키워서 하게 되면 이동을 하면서 사라진 부분까지 볼 수 있다. Size(700,700)</span>
</pre></table></code></div></div><p><img data-src="/assets\img\dev\week6\day2\trans0.5.png" data-proofer-ignore></p><p>이를 통해 크기 변환과 이동 변환을 함께 줄 수 있다.</p><p><br /></p><p><br /></p><h3 id="영상의-전단-변환shear-transformation">영상의 전단 변환(shear transformation) <a href="#영상의-전단-변환shear-transformation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>직사각형 형태의 영상을 한쪽 방향으로 밀어서 평행사변형 모양으로 변형되는 변환, 층밀림 변환이라고도 한다. 가로 방향 또는 세로 방향으로 정의된다.</p><p><img data-src="/assets\img\dev\week6\day2\sheartheory.png" data-proofer-ignore></p><p>첫번째는 x좌표가 이동하는 형태를 통해 변형되는 것이고, 두번째는 y좌표가 변형되는 것이다.</p><p><br /></p><ul><li>코드 구현</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="nf">dst</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">rows</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">src</span><span class="p">.</span><span class="n">type</span><span class="p">(),</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

<span class="kt">double</span> <span class="n">m</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ny</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
    <span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>코드를 자세히 살펴보게 되면, 먼저 dst의 크기를 원래 크기의 1.5배 해줌으로써 나중에 예외처리를 하지 않아도 되도록 또는 이미즹 변형된 형태를 보기 위해서 1.5배 해주었다. x, 즉 rows방향만 변형되기 때문에, cols에 대해서는 크기를 늘려주지 않은 것을 볼 수 있다.</p><p>그 후 for 루프를 도는데, (y+m*x)에서 m이 0.5이므로 최대 원본의 1.5배까지 커지도록 되어 있음을 알 수 있다.</p><p>마지막으로 결과 영상의 픽셀 값을 입력 영상의 픽셀 값으로 집어 넣어주면 된다.</p><p><img data-src="/assets\img\dev\week6\day2\shear.png" data-proofer-ignore></p><p><br /></p><p><br /></p><h3 id="영상의-크기-변환scale-transform">영상의 크기 변환(scale transform) <a href="#영상의-크기-변환scale-transform" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>영상의 크기를 원보 영상보다 크게 또는 작게 만드는 변환을 말한다. x축과 y축 방향으로의 스케일 비율(scale factor)를 지정할 수 있다.</p><p><img data-src="/assets\img\dev\week6\day2\scale.png" data-proofer-ignore></p><p>이 때, scale factor을 보면 <code class="language-plaintext highlighter-rouge">Sx = w'/w</code>,<code class="language-plaintext highlighter-rouge">Sy = h'/h</code> 로 표현된다.</p><p><br /></p><ul><li>코드 구현</ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">zeros</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">rows</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x_</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y_</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y_</span><span class="p">,</span> <span class="n">x_</span><span class="p">)</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="/assets\img\dev\week6\day2scaletrans.png" data-proofer-ignore></p><p>단순히 2배로 키우게 되면 중간중간에 검정색이 존재하게 된다. 위의 코드를 <strong>순방향 매핑(foreward mapping)</strong>이라고 하는데, 입력 영상의 좌표만큼을 for문을 돌면서 입력 영상의 좌표값을 출력 영상의 좌표값으로 설정하는 코드를 맗한다. 이 경우 채워지지 않은 픽셀이 존재하게 된다. 이 문제를 해결하기 위해 <strong>역방향 매핑</strong>을 진행한다.</p><h4 id="역방향-매핑backward-mapping">역방향 매핑(backward mapping) <a href="#역방향-매핑backward-mapping" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>순방향 매핑의 경우</p><ul><li>x’ = Sx * x<li>y’ = Sy * y</ul><p>그러나 역방향 매핑의 경우</p><ul><li>x = x’ / Sx<li>y = y’ / Sy</ul><p>를 통해 결과 영상의 좌표(x’,y’)에서 원본 영상의 좌표(x,y)를 참조하도록 만든다. 이를 코드로 구현하면 다음과 같다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"lenna.bmp"</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
<span class="n">Mat</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">zeros</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">rows</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y_</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y_</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x_</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x_</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x_</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y_</span><span class="p">,</span> <span class="n">x_</span><span class="p">)</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="/assets\img\dev\week6\day2scaletransback.png" data-proofer-ignore></p><p>픽셀값들이 계단형태로 나오고 있다. 그 이유는 scale factor이 4라고 가정할 때, <code class="language-plaintext highlighter-rouge">x_ = 0,1,2,3</code> 일 때는 x=0 인 픽셀값을 참조하고, <code class="language-plaintext highlighter-rouge">x_ = 4,5,6,7</code>일 때는 x=1인 픽셀값을 참조하기 때문이다. 이 문제를 해결하기 위해 <strong>보간법</strong>을 사용한다.</p><p><br /></p><h4 id="보간법">보간법 <a href="#보간법" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>역방향 매핑에 의한 크기 변환 시, 참조해야 할 입력 영상의 (x,y) 좌표가 실수 좌표일 경우</p><ul><li>(x,y)와 가장 가까운 정수 좌표의 픽셀 값을 참조하거나<li>(x,y) 근방의 정수 좌표 픽셀 값을 이용하여 실수 좌표 위치의 픽셀 값을 추정해야 한다.</ul><p>보간법은 실수 좌표 상에서의 픽셀 값을 결정하기 위해 <strong>주변 픽셀 값을 이용하여 값을 추정</strong>하는 방법을 말한다.</p><p><br /></p><p>주요 보간법</p><ul><li><strong>최근방 이웃 보간법</strong>(nearest neighbor interpolation)<li><strong>양선형 보간법</strong>(bilinear interpolation)<li>3차 보간법(cubic interpolation)<li>스플라인 보간법(spline interpolation)<li>란쵸스 보간법(lanczos interpolation)</ul><p><br /></p><p>가장 단순한 방법은 <code class="language-plaintext highlighter-rouge">최근방 이웃 보간법</code>이다. 즉 가장 가까운 위치에 있는 픽셀의 값을 참조하는 방법을 말한다. 장점은 빠르고 구현하기 쉽다. 단점으로는 계단 현상이 발생한다. 방금 우리가 해봤던 방법이 이에 해당한다.</p><p><br /></p><p>이 계단 현상을 해결하기 위해 <code class="language-plaintext highlighter-rouge">양선형 보간법</code>을 많이 사용한다. 실수 좌표를 둘러싸고 있는 네 개의 픽셀 값에 가중치를 곱한 값들의 선형 합으로 결과 영상의 픽셀 값을 구하는 방법이다. 최근방 이웃 보간법에 비해서는 느리지만 비교적 빠르며 계단 현상이 크게 감소한다.</p><p><br /></p><ul><li>양선형 보간법 구현 방법</ul><p>실수 좌표를 둘러싸고 있는 네 개의 픽셀 값을 이용해야 한다. 예를 들어 점(double p,double q)가 있다고 하고, 이를 (10.3,20.5) 에 해당한다고 하면</p><p>이를 둘러싼 4개의 픽셀 값은 (10,20),(11,20),(10,21),(11,21) 이 될 것이다.</p><p><img data-src="/assets\img\dev\week6\day2\bilinear.png" data-proofer-ignore></p><p>a,b,c,d는 픽셀 값의 크기를 의미한다. 이를 통해 x는 (1-p) * a 와 p * b 를 더하면 된다.</p><ul><li>x = (1-p)a + pb<li>y = (1-p)c + pd<li>z = (1-q)x + qy</ul><p>z는 보간법을 통해 얻은 해당 픽셀의 픽셀 값이다. 따라서 우리는 z만 쓰면 된다.</p><ul><li><strong>코드 구현</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">resizeBilinear</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">,</span> <span class="n">Mat</span><span class="o">&amp;</span> <span class="n">dst</span><span class="p">,</span> <span class="n">Size</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dst</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">;</span>	<span class="kt">double</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">sx</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">dst</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 가로 방향 scale factor</span>
	<span class="kt">double</span> <span class="n">sy</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">dst</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 세로 방향 scale factor</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rx</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
			<span class="n">x1</span> <span class="o">=</span> <span class="n">cvFloor</span><span class="p">(</span><span class="n">rx</span><span class="p">);</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">cvFloor</span><span class="p">(</span><span class="n">ry</span><span class="p">);</span>
			<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">x2</span> <span class="o">==</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="p">)</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">src</span><span class="p">.</span><span class="n">rows</span><span class="p">)</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">rx</span> <span class="o">-</span> <span class="n">x1</span><span class="p">;</span><span class="n">q</span> <span class="o">=</span> <span class="n">ry</span> <span class="o">-</span> <span class="n">y1</span><span class="p">;</span>

			<span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>  <span class="c1">// src.at&lt;uchar&gt;(y1, x1) == x1,y1에서의 픽셀 값, a</span>
				<span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>  <span class="c1">// b</span>
				<span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>  <span class="c1">// c</span>
				<span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">src</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">x2</span><span class="p">);</span>  <span class="c1">// b</span>

			<span class="n">dst</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>코드에서 (x1,y1),(x2,y2)는 아래 그림을 참고하면 된다.</p><p><img data-src="/assets\img\dev\week6\day2\graph.png" data-proofer-ignore></p><p><br /></p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"camera.bmp"</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Image load failed!"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span>
	<span class="n">resizeBilinear</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">));</span>

	<span class="n">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"dst"</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
	<span class="n">waitKey</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>이 코드를 실행하게 되면 아래와 같다. 아래는 1024,1024 크기로 키운 결과이다.</p><p><img data-src="/assets\img\dev\week6\day2\cameraman.png" data-proofer-ignore></p><p><br /></p><p><br /></p><ul><li>3차 보간법(bicubic interpolation)</ul><p>방금까지는 2차원 보간법을 진행했다. 그러나 3차 즉 3차원의 픽셀값을 계산하는 방법이다. 그래서 총 16개의 픽셀 값에 3차 함수를 이용한 가중치를 부여하여 결과 영상 픽셀의 값을 계산한다.</p><p>이는 그냥 직접 구현하기보다 OpenCV에서 제공하는 함수를 사용해볼 것이다.</p><p><br /></p><p><br /></p><p>위의 코드들은 알고리즘을 직접 구현했다. 그러나 OpenCV의 <code class="language-plaintext highlighter-rouge">resize()</code>라는 함수를 통해 쉽게 사용할 수 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">resize</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">src</span><span class="p">,</span> <span class="n">OutputArray</span> <span class="n">dst</span><span class="p">,</span><span class="n">Size</span> <span class="n">dsize</span><span class="p">,</span> <span class="kt">double</span> <span class="n">fx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">double</span> <span class="n">fy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="n">INTER_LINEAR</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>src,dst : 입력, 출력 영상<li>dsize : 결과 영상의 크기, Size()로 지정하면 fx,fy에 의해 자동 결정된다.<li>fx,fy : x,y방향 스케일 비율, dsize값이 0일 때 유효하다.<li>interpolation : 보간법 지정 상수<ul><li>INTER_NEAREST : 최근방 이웃 보간법<li><strong>INTER_LINEAR</strong> : 양선형 보간법 (2x2 이웃 픽셀 참조)<li>INTER_CUBIC : 3차회선 보간법 (4x4 이웃 픽셀 참조)<li>INTER_LANCZOS4 : Lanczos 보간법 (8x8 이웃 픽셀 참조)<li>INTER_AREA : 영상 축소 시 효과적인 방법</ul></ul><p><br /></p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"rose.bmp"</span><span class="p">);</span>

<span class="n">Mat</span> <span class="n">dst1</span><span class="p">,</span> <span class="n">dst2</span><span class="p">,</span> <span class="n">dst3</span><span class="p">,</span> <span class="n">dst4</span><span class="p">;</span>
<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst1</span><span class="p">,</span> <span class="n">Size</span><span class="p">(),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">INTER_NEAREST</span><span class="p">);</span> 
<span class="c1">// 이를 1번더 한 이유는 이미지를 불러올 때 시간이 걸려서 정확한 판단이 잘 안될 수 있기 때문에 미리 1번 불러와서 정확한 시간을 측정하기 위함</span>

<span class="n">tm</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst1</span><span class="p">,</span> <span class="n">Size</span><span class="p">(),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">INTER_NEAREST</span><span class="p">);</span>
<span class="n">tm</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"INTER_NEAREST: "</span> <span class="o">&lt;&lt;</span> <span class="n">tm</span><span class="p">.</span><span class="n">getTimeMilli</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"ms. "</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="n">tm</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span> <span class="c1">// reset을 하지 않을 경우 뒤에 측정한 것이 앞에 것과 합쳐져 출력된다.</span>
<span class="n">tm</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst2</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1280</span><span class="p">));</span>
<span class="n">tm</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"INTER_LINEAR: "</span> <span class="o">&lt;&lt;</span> <span class="n">tm</span><span class="p">.</span><span class="n">getTimeMilli</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"ms. "</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="n">tm</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="n">tm</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst3</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1280</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">INTER_CUBIC</span><span class="p">);</span>
<span class="n">tm</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"INTER_CUBIC: "</span> <span class="o">&lt;&lt;</span> <span class="n">tm</span><span class="p">.</span><span class="n">getTimeMilli</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"ms. "</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="n">tm</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="n">tm</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst4</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1280</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">INTER_LANCZOS4</span><span class="p">);</span>
<span class="n">tm</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"INTER_LANCZOS4: "</span> <span class="o">&lt;&lt;</span> <span class="n">tm</span><span class="p">.</span><span class="n">getTimeMilli</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"ms. "</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

<span class="n">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="s">"dst1"</span><span class="p">,</span> <span class="n">dst1</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)));</span>
<span class="n">imshow</span><span class="p">(</span><span class="s">"dst2"</span><span class="p">,</span> <span class="n">dst2</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)));</span>
<span class="n">imshow</span><span class="p">(</span><span class="s">"dst3"</span><span class="p">,</span> <span class="n">dst3</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)));</span>
<span class="n">imshow</span><span class="p">(</span><span class="s">"dst4"</span><span class="p">,</span> <span class="n">dst4</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)));</span>
<span class="n">waitKey</span><span class="p">();</span>
</pre></table></code></div></div><p>총 4가지의 방법으로 진행해서 비교해보았다. dst1,2,3,4 다 동일한 크기로 resize된다.</p><ul><li>dst1 : fx,fy를 지정해줌으로써 size가 알아서 결정된다.<li>dst2 : size를 지정해주어서 fx,fy를 지정해주지 않았다. 그리고 interpolation은 default가 INTER_LINEAR이므로 지정하지 않을 경우 INTER_LINEAR 방식을 사용한다.<li>dst3 : INTER_CUBIC<li>dst4 : INTER_LANCZOS4</ul><p>그리고 출력 영상이 너무 크기 때문에 특정 크기만큼 잘라서 보고자 했다. (400,500)위치에서 가로 400, 세로 400 크기만큼만 화면에 출력하도록 했다.</p><p><img data-src="/assets\img\dev\week6\day2\resize.png" data-proofer-ignore> <img data-src="/assets\img\dev\week6\day2\resizetime.png" width="400px" origin="center" data-proofer-ignore></p><p>이와 같이 비교해보면 3,4가 화질이 좋다. 그러나 연산량을 비교해보면 3번이 2번보다 1.5배 정도 더 걸리고, 4번의 경우 3번의 2배 정도의 시간이 더 걸린다.</p><p><br /></p><ul><li>영상의 축소 시 고려할 사항<ul><li>한 픽셀로 구성된 성분들은 영상을 축소할 때 사라지는 경우가 발생할 수 있다.<li>입력 영상을 부드럽게 필터링(블러링)한 후 축소하거나 다단계 축소를 권장한다.<li>OpenCV의 resize() 함수에서는 INTER_AREA 플래그를 사용하면 축소할 때 발생하는 화질의 열화를 방지할 수 있다.</ul></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Mat</span> <span class="n">src</span><span class="p">(</span><span class="mi">1280</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>

	<span class="n">rectangle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">Rect</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
	<span class="n">rectangle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">Rect</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>

	<span class="n">Mat</span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">CV_32FC1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">9.</span><span class="n">f</span><span class="p">;</span>

	<span class="n">Mat</span> <span class="n">dst1</span><span class="p">,</span> <span class="n">dst2</span><span class="p">,</span> <span class="n">dst3</span><span class="p">,</span> <span class="n">dst4</span><span class="p">;</span>

	<span class="n">GaussianBlur</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst3</span><span class="p">,</span> <span class="n">Size</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">);</span>
	<span class="n">GaussianBlur</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst4</span><span class="p">,</span> <span class="n">Size</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">);</span>

	<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst1</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span><span class="n">INTER_AREA</span><span class="p">);</span>
	<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst2</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span><span class="n">INTER_LINEAR</span><span class="p">);</span>
	<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst3</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span> <span class="n">INTER_LINEAR</span><span class="p">);</span>
	<span class="n">resize</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst4</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span> <span class="n">INTER_AREA</span><span class="p">);</span>

	<span class="n">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"dst1"</span><span class="p">,</span> <span class="n">dst1</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"dst2"</span><span class="p">,</span> <span class="n">dst2</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"dst3"</span><span class="p">,</span> <span class="n">dst3</span><span class="p">);</span>
	<span class="n">imshow</span><span class="p">(</span><span class="s">"dst4"</span><span class="p">,</span> <span class="n">dst4</span><span class="p">);</span>
	<span class="n">waitKey</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>흰색 배경에 검은색 두께 1인 사각형 2개를 그리고, 축소를 시켰더니 선들이 사라지는 것을 볼 수 있다. 나의 경우에는 INTER_AREA를 사용하거나, 블러링하고 축소를 해도 사각형이 사라지는 현상이 발생했다.</p><p><img data-src="/assets\img\dev\week6\day2\small.png" data-proofer-ignore></p><p><br /></p><p><br /></p><h3 id="영상의-회전-변환rotation-transform">영상의 회전 변환(rotation transform) <a href="#영상의-회전-변환rotation-transform" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>영상을 특정 각도만큼 회전시키는 변환이다. OpenCV에서는 반시계 방향을 기본으로 사용한다.</p><p><img data-src="/assets\img\dev\week6\day2\rotation.png" data-proofer-ignore></p><p>노란색이 입력 영상, 초록색이 회전된 영상을 표현한다.</p><p><br /></p><p>이 때, 회전했을 때 y가 0보다 작으면 오류가 나므로 회전한 좌표가 유효한 좌표인지 검사를 하는 것이 중요하다. 또한, 정방향 매핑이 아닌 역방향 매핑을 해야 빈 픽셀이 발생하지 않는다.</p><p><img data-src="/assets\img\dev\week6\day2\backwardrotation.png" data-proofer-ignore></p><p>입력 영상은 출력 영상과 역행렬을 곱한 것으로 표현할 수 있다.</p><p>추가적으로 보간법도 선택하여 진행한다.</p><ul><li>함수 - <strong>영상의 회전 변환 행렬</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="nf">getRotationMatrix2D</span><span class="p">(</span><span class="n">Point2f</span> <span class="n">center</span><span class="p">,</span> <span class="kt">double</span> <span class="n">angle</span><span class="p">,</span> <span class="kt">double</span> <span class="n">scale</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>center : 회전 중심 좌표<li>angle : (반시계 방향) 회전 각도(degree), 음수는 시계 방향<li>scale : 회전 후 확대 비율<li>반환값 : 2x3 double(CV_64F) 행렬 (어파인 변환 행렬)</ul><p>이 때, center 좌표를 단순히 0,0으로 두려면 <code class="language-plaintext highlighter-rouge">Point2f pt;</code>로 할 수 있지만, 대체로 영상 중심의 좌표를 center로 두기 때문에</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Point2f</span> <span class="n">pt</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="o">/</span><span class="mf">2.</span><span class="n">f</span><span class="p">,</span> <span class="n">src</span><span class="p">.</span><span class="n">rows</span><span class="o">/</span><span class="mf">2.</span><span class="n">f</span><span class="p">)</span>
</pre></table></code></div></div><p>주의해야 할 것은 cols==y가 먼저 나온다는 것이다.</p><p>반환하는 행렬은 다음과 같다.</p><p><img data-src="/assets\img\dev\week6\day2\transformationmatrix.png" data-proofer-ignore></p><p><br /></p><ul><li>함수 - <strong>어파인 변환</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">warpAffine</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">src</span><span class="p">,</span> <span class="n">OutputArray</span> <span class="n">dst</span><span class="p">,</span> <span class="n">InputArray</span> <span class="n">M</span><span class="p">,</span> <span class="n">Size</span> <span class="n">dsize</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">=</span> <span class="n">INTER_LINEAR</span><span class="p">,</span> <span class="kt">int</span> <span class="n">borderMode</span> <span class="o">=</span> <span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="k">const</span> <span class="n">Scalar</span><span class="o">&amp;</span> <span class="n">borderValue</span> <span class="o">=</span> <span class="n">Scalar</span><span class="p">());</span>
</pre></table></code></div></div><ul><li>src,dst : 입력, 출력 영상, 두 개는 같은 타입이어야 함<li>M : 2x3 어파인 변환 행렬, CV_32F or CV_64F, 위의 회전 변환 행렬의 반환값을 여기에 입력<li>dsize : 결과 영상의 크기, 입력 영상과 동일하게 하려고 하면 <code class="language-plaintext highlighter-rouge">Size()</code>로 지정<li>flags : 보간법 선택<li>borderMode : 가장자리 픽셀 처리 방식<li>borderValue : BORDER_CONSTANT 모드 사용 시 사용할 픽셀 값</ul><p>실제로 회전을 시키기 위해서는 이 함수를 선언해야 한다.</p><ul><li><strong>코드 구현</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"lenna.bmp"</span><span class="p">);</span>

<span class="kt">float</span> <span class="n">degree</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
<span class="n">Point2f</span> <span class="nf">pt</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mf">2.</span><span class="n">f</span><span class="p">,</span> <span class="n">src</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mf">2.</span><span class="n">f</span><span class="p">);</span>
<span class="n">Mat</span> <span class="n">rot</span> <span class="o">=</span> <span class="n">getRotationMatrix2D</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>

<span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span>
<span class="n">warpAffine</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="mi">700</span><span class="p">));</span> <span class="c1">// 512,512 를 700,700으로 키워서 잘리는 부분까지 추출</span>

<span class="n">imshow</span><span class="p">(</span><span class="s">"dst"</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
<span class="n">waitKey</span><span class="p">();</span>
</pre></table></code></div></div><p><br /></p><p><br /></p><h3 id="이동-크기-회전-변환-조합">이동, 크기, 회전 변환 조합 <a href="#이동-크기-회전-변환-조합" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>크기 -&gt; 회전 변환할 경우</ul><p><img data-src="/assets\img\dev\week6\day2\sizerotation.png" data-proofer-ignore></p><p>Sx,Sy 는 크기에 대한 scale factor, 그 앞에 있는 2x2 행렬이 회전에 대한 변환이다. 뒤에서부터 계산하여 출력 영상을 만들어낸다.</p><p><br /></p><ul><li>크기 -&gt; 회전 -&gt; 크기 변환할 경우</ul><p><img data-src="/assets\img\dev\week6\day2\sizerotationsize.png" data-proofer-ignore></p><p>크기 변환에 대한 변환을 1번 더 진행한다. 이 3개를 하나의 2x2 행렬로 표현이 가능하다.</p><p><br /></p><ul><li>이동 -&gt; 크기 변환할 경우</ul><p><img data-src="/assets\img\dev\week6\day2\movesize.png" data-proofer-ignore></p><p>이동 변환을 먼저 수행하기 때문에 x방향으로 a, y방향으로 b만큼을 이동한 결과를 크기 변환한다.</p><p><br /></p><ul><li>이동 -&gt; 크기 -&gt; 회전 변환할 경우</ul><p><img data-src="/assets\img\dev\week6\day2\movesizerotation.png" data-proofer-ignore></p><p>이 경우에도 <code class="language-plaintext highlighter-rouge">2x2행렬 * [x,y] + 2x1행렬</code> 로 나타낼 수 있는데, 덧셈이 들어가게 되면 연산이 번거로워진다. 연산의 번거로움을 해결하기 위해 <strong>동차 좌표계</strong>를 사용한다.</p><p><br /></p><h4 id="동차-좌표계homogenous-coordinates">동차 좌표계(homogenous coordinates) <a href="#동차-좌표계homogenous-coordinates" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>차원의 좌표를 1차원 증가시켜서 표현하는 방법을 말한다. 예를 들어 2차원(x,y)좌표를 (x,y,1)로 표현할 수 있다. 이를 통해 각각의 변환들을 표현할 수 있다.</p><p><img data-src="/assets\img\dev\week6\day2\homogenous.png" data-proofer-ignore></p><p>이처럼 오른쪽 식으로 변환할 수 있다. 이 때 마지막 항은 항상 1이다.</p><p><br /></p><p>동차 좌표계를 활용하여 이동 변환 -&gt; 크기 변환 -&gt; 회전 변환을 수행한다면 아래 식처럼 쓸 수 있다.</p><p><img data-src="/assets\img\dev\week6\day2\homotransform.png" data-proofer-ignore></p><p><br /></p><p>getRotationMatrix2D() 함수를 이용하여 영상의 중앙 기준 회전한다고 할 때, 한 이미지를 (-cx,cy)만큼 이동 변환하여 영상의 중심이 (0,0)에 오도록 한다. 그 후 이미지를 회전 변환하고, 다시 (cx,cy)만큼 이동 변환하여 제자리로 이동시킨다.</p><p>이를 행렬로 나타내면 다음과 같다.</p><p><img data-src="/assets\img\dev\week6\day2\rotationmatrixfunction.png" data-proofer-ignore></p><p>이를 전개하면 위에서 봤던 getRotationMatrix2D() 함수의 반환값과 똑같은 형태가 된다.</p><p><img data-src="/assets\img\dev\week6\day2\transformationmatrix.png" data-proofer-ignore></p><p><br /></p><h3 id="영상의-대칭-변환flipreflection">영상의 대칭 변환(flip,reflection) <a href="#영상의-대칭-변환flipreflection" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>영상의 상하/좌우/원점 대칭이 있다. 상하/좌우 대칭의 경우 축을 기준으로 반전시킨 후 이동 변환을 통해 원래 자리로 되돌리는 것이다.</p><ul><li><strong>함수</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">flip</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">src</span><span class="p">,</span> <span class="n">OutputArray</span> <span class="n">dst</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flipCode</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>src, dst : 입력, 출력 영상<li>flipCode : 대칭 방향 지정<ul><li>양수(+1) : 좌우 대칭<li>0 : 상하 대칭<li>음수(-1) : 원점 대칭</ul></ul><p><br /></p><p><br /></p><h1 id="어파인-변환과-투시-변환">어파인 변환과 투시 변환</h1><h2 id="어파인-변환affine-transform-vs-투시-변환perspective-transform--projective-transfrom">어파인 변환(affine transform) vs. 투시 변환(perspective transform == projective transfrom) <a href="#어파인-변환affine-transform-vs-투시-변환perspective-transform--projective-transfrom" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>어파인 변환</strong></p><ul><li>translation<li>shear<li>scaling<li>rotation<li>parallelograms</ul><p>이 어파인 변환은 3x3행렬로 표현되지만, 마지막 열은 [0,0,1] 이므로 2x3 행렬(6 DOF == 6개의 미지수)이라고도 말할 수 있다.</p><p><br /></p><p><strong>투시 변환</strong></p><ul><li>trapazoids</ul><p>이 투시 변환은 3x3행렬(8 DOF)로 표현된다.</p><p><br /></p><p><img data-src="/assets\img\dev\week6\day2\affineperspective.png" data-proofer-ignore></p><p>affine transform의 경우 직사각형이 평행사변형이 되므로 마지막 1점은 추론이 가능하다. 각 점마다 수식이 2개씩 나오게 되므로 총 6개의 수식만 알면 된다.</p><p>perspective transform의 경우 점이 각각 변하기 때문에 4개 다 계산이 필요하다. 그래서 총 8개의 수식이 필요하다.</p><p><br /></p><ul><li><strong>어파인 변환 점 행렬 구하기</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="nf">getAffineTransform</span><span class="p">(</span><span class="k">const</span> <span class="n">Point2f</span> <span class="n">src</span><span class="p">[],</span> <span class="k">const</span> <span class="n">Point2f</span> <span class="n">dst</span><span class="p">[]);</span>
<span class="n">Mat</span> <span class="nf">getAffineTransform</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">src</span><span class="p">,</span> <span class="n">InputArray</span> <span class="n">dst</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>src : 3개의 원본 좌표점(point2f src[3]; 또는 vector&lt;Point2f&gt; src;)<li>dst : 3개의 결과 좌표점(point2f dst[3]; 또는 vector&lt;Point2f&gt; dst;)<li>반환값 : 2x3 크기의 변환 행렬 (CV_64F)</ul><p>원래의 좌표점src와 변환된 결과 좌표점dst를 지정하면 변환 행렬을 출력해준다.</p><p>getRotationMatrix2D() 함수와 반환값이 같지만 이 함수는 회전 각도를 통해 어떻게 회전을 할지에 대한 함수이다.</p><p><br /></p><ul><li><strong>영상의 어파인 변환</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">warpAffine</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">src</span><span class="p">,</span> <span class="n">OutputArray</span> <span class="n">dst</span><span class="p">,</span> <span class="n">InputArray</span> <span class="n">M</span><span class="p">,</span> <span class="n">Size</span> <span class="n">dsize</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">=</span> <span class="n">INTER_LINEAR</span><span class="p">,</span> <span class="kt">int</span> <span class="n">borderMode</span> <span class="o">=</span> <span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="k">const</span> <span class="n">Scalar</span><span class="o">&amp;</span> <span class="n">borderValue</span> <span class="o">=</span> <span class="n">Scalar</span><span class="p">());</span>
</pre></table></code></div></div><ul><li>src,dst : 입력, 출력 영상, 두 개는 같은 타입이어야 함<li>M : <strong>2x3</strong> 어파인 변환 행렬, CV_32F or CV_64F, 위의 회전 변환 행렬의 반환값을 여기에 입력<li>dsize : 결과 영상의 크기, 입력 영상과 동일하게 하려고 하면 <code class="language-plaintext highlighter-rouge">Size()</code>로 지정<li>flags : 보간법 선택<li>borderMode : 가장자리 픽셀 처리 방식<li>borderValue : BORDER_CONSTANT 모드 사용 시 사용할 픽셀 값</ul><p><br /></p><ul><li><strong>투시 변환 행렬 구하기</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">Mat</span> <span class="nf">getPerspectiveTransform</span><span class="p">(</span><span class="k">const</span> <span class="n">Point2f</span> <span class="n">src</span><span class="p">[],</span> <span class="k">const</span> <span class="n">Point2f</span> <span class="n">dst</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">solveMethod</span> <span class="o">=</span> <span class="n">DECOMP_LU</span><span class="p">);</span>
<span class="n">Mat</span> <span class="nf">getPerspectiveTransform</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">src</span><span class="p">,</span><span class="n">InputArray</span> <span class="n">dst</span><span class="p">,</span> <span class="kt">int</span> <span class="n">solveMethod</span> <span class="o">=</span> <span class="n">DECOMP_LU</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>src : 4개의 원본 좌표점(Point2f src[4]; 또는 vector&lt;Point2f&gt; src;)<li>dst : 4개의 원본 좌표점(Point2f dst[4]; 또는 vector&lt;Point2f&gt; dst;)<li>solveMethod : 어떻게 계산할지에 대한 수학적 방법<li>반환값 : 3x3 크기의 변환 행렬 (CV_64F)</ul><p><br /></p><ul><li><strong>영상의 투시 변환</strong></ul><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">warpPerspective</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">src</span><span class="p">,</span> <span class="n">OutputArray</span> <span class="n">dst</span><span class="p">,</span> <span class="n">InputArray</span> <span class="n">M</span><span class="p">,</span> <span class="n">Size</span> <span class="n">dsize</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">INTER_LINEAR</span><span class="p">,</span> <span class="kt">int</span> <span class="n">borderMode</span> <span class="o">=</span> <span class="n">BORDER_CONSTANT</span><span class="p">,</span> <span class="k">const</span> <span class="n">Scalar</span><span class="o">&amp;</span> <span class="n">borderValue</span> <span class="o">=</span> <span class="n">Scalar</span><span class="p">());</span>
</pre></table></code></div></div><ul><li>src,dst : 입,출력 영상, 둘은 같은 타입<li>M : <strong>3x3</strong> 투시 변환 행렬, CV_32F 또는 CV_64F<li>dsize : 결과 영상의 크기, 입력 영상과 동일하게 하려고 하면 <code class="language-plaintext highlighter-rouge">Size()</code>로 지정<li>flags : 보간법 선택<li>borderMode : 가장자리 픽셀 처리 방식<li>borderValue : BORDER_CONSTANT 모드 사용 시 사용할 픽셀 값</ul><p><br /></p><p>추가적으로 4개의 대응점으로부터 투시 변환 행렬을 구하는 식에 대해 살펴보고자 한다.</p><p><img data-src="/assets\img\dev\week6\day2\gerperspective.png" data-proofer-ignore></p><p><br /></p><p><br /></p><h1 id="차선-영상의-조감도birds-eye-view-만들기">차선 영상의 조감도(bird’s eye view) 만들기</h1><p>bird’s eye view : 새가 하늘에서 내려다보듯이 매우 높은 곳에 위치한 카메라가 아래의 피사체를 찍은 화면을 말한다. 투시 변환을 이용하여 전면에서 촬영된 영상을 버드아이뷰처럼 변환할 수 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">"opencv2/opencv.hpp"</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">VideoCapture</span> <span class="n">cap</span><span class="p">(</span><span class="s">"../../../data/test_video.mp4"</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Video open failed!"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Mat</span> <span class="n">src</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="n">src</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">260</span><span class="p">;</span>

		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">src_pts</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// 입력 영상에서의 점들의 좌표 4개</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">dst_pts</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// 출력 영상에서의 점들의 좌표 4개</span>

		<span class="n">src_pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="mi">474</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>	<span class="n">src_pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="mi">710</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span> <span class="c1">// 특정 위치에서 차선을 기준으로 한 사다리꼴의 점 좌표</span>
		<span class="n">src_pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="mi">866</span><span class="p">,</span> <span class="mi">530</span><span class="p">);</span> <span class="n">src_pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="mi">366</span><span class="p">,</span> <span class="mi">530</span><span class="p">);</span>

		<span class="n">dst_pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>	<span class="n">dst_pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// 출력 영상에서의 좌측 상단, 우측 상단</span>
		<span class="n">dst_pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>	<span class="n">dst_pts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 우측 하단, 좌측 하단</span>

		<span class="n">Mat</span> <span class="n">per_mat</span> <span class="o">=</span> <span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">);</span> <span class="c1">// 입력과 출력 좌표를 통해 matrix 획득</span>

		<span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span>
		<span class="n">warpPerspective</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">per_mat</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">));</span> <span class="c1">// 투시 변환 실행, 크기는 임의의 크기 500,260</span>

<span class="cp">#if 1
</span>		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">pts</span><span class="p">;</span> <span class="c1">// 자료형을 변환시키기 위한 변수</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">pt</span> <span class="o">:</span> <span class="n">src_pts</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pts</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="p">.</span><span class="n">y</span><span class="p">));</span> <span class="c1">// polylines가 int로 받는데, 위의 point2f는 float타입이르모 point를 통해 int로 변환</span>
		<span class="p">}</span>
		<span class="n">polylines</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">LINE_AA</span><span class="p">);</span> <span class="c1">// 위의 입력 영상에서의 좌표 4개에 대한 사각형 표시</span>
<span class="cp">#endif
</span>
		<span class="n">imshow</span><span class="p">(</span><span class="s">"src"</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
		<span class="n">imshow</span><span class="p">(</span><span class="s">"dst"</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">27</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/opencv3/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/opencv3.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/classlog/'>Classlog</a>, <a href='/categories/devcourse/'>devcourse</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/devcourse/" class="post-tag no-text-decoration" >devcourse</a> <a href="/tags/opencv/" class="post-tag no-text-decoration" >OpenCV</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[데브코스] 6주차 - OpenCV Image Geometric Transformation - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/opencv3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[데브코스] 6주차 - OpenCV Image Geometric Transformation - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/opencv3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/opencv3/&amp;text=[데브코스] 6주차 - OpenCV Image Geometric Transformation - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/opencv3/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[깃허브 프로필 꾸미기] github 프로필 만들기</a><li><a href="/posts/product/">[깃허브 프로필 꾸미기] productive box 만들기</a><li><a href="/posts/regex/">[데브코스] 2주차 - linux 기초(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation 과 StratifiedKFold</a><li><a href="/posts/cmake/">[데브코스] 17주차 - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/opencv2/"><div class="card-body"> <em class="timeago small" date="2022-03-21 14:01:00 +0900" >Mar 21, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 6주차 - OpenCV Gaussian blurring</h3><div class="text-muted small"><p> 블러링 평균 값 필터 (mean filter) 영상의 특정 좌표 값을 주변 픽셀 값들의 산술 평균으로 설정하는 것이다. 픽셀 들 간의 그레이스케일 값 변화가 줄어들어 날카로운 엣지가 무뎌지고, 영상에 있는 잡음의 영향이 사라지는 효과가 있다. #include &amp;lt;iostream&amp;gt; #include &quot;opencv2/opencv.hpp&quot; ...</p></div></div></a></div><div class="card"> <a href="/posts/opencv4/"><div class="card-body"> <em class="timeago small" date="2022-03-23 14:01:00 +0900" >Mar 23, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 6주차 - OpenCV Color Space</h3><div class="text-muted small"><p> 컬러 영상을 그레이 스케일로 변환 1 Y = 0.299R + 0.587G + 0.114B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 int main() { Mat src = imread(&quot;lenna.bmp&quot;); #if 0 Mat dst ...</p></div></div></a></div><div class="card"> <a href="/posts/opencvedge/"><div class="card-body"> <em class="timeago small" date="2022-03-24 14:01:00 +0900" >Mar 24, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[데브코스] 6주차 - OpenCV specific color and edge extraction</h3><div class="text-muted small"><p> 특정 색상 영역 추출 RGB, HSV, YCrCb 등의 색 공간에서 각 색상 성분의 범위를 지정하여 특정 색상 성분만 추출할 수 있다. RGB는 계산이 이상하게 나올 수 있으므로 HSV나 YCrCb를 사용한다. 1 void inRange(InputArray src,InputArray lowerb, InputArray upperb, OutputA...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/opencv2/" class="btn btn-outline-primary" prompt="Older"><p>[데브코스] 6주차 - OpenCV Gaussian blurring</p></a> <a href="/posts/opencv4/" class="btn btn-outline-primary" prompt="Newer"><p>[데브코스] 6주차 - OpenCV Color Space</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>