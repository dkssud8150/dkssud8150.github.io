<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[ROS2 이론] turtlesim 실행" /><meta name="author" content="JaeHo YooN" /><meta property="og:locale" content="en" /><meta name="description" content="개발 환경을 설정하는 것은 해당 블로그를 확인해보길 바란다." /><meta property="og:description" content="개발 환경을 설정하는 것은 해당 블로그를 확인해보길 바란다." /><link rel="canonical" href="https://dkssud8150.github.io/posts/turtlesim/" /><meta property="og:url" content="https://dkssud8150.github.io/posts/turtlesim/" /><meta property="og:site_name" content="JaeHo Yoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-26T04:23:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[ROS2 이론] turtlesim 실행" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@JaeHo YooN" /><meta name="google-site-verification" content="znvuGsQGYxMZPBslC4XG6doCYao6Y-fWibfGlcaMHH8" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"JaeHo YooN"},"dateModified":"2022-08-02T22:11:51+09:00","datePublished":"2022-07-26T04:23:00+09:00","description":"개발 환경을 설정하는 것은 해당 블로그를 확인해보길 바란다.","headline":"[ROS2 이론] turtlesim 실행","mainEntityOfPage":{"@type":"WebPage","@id":"https://dkssud8150.github.io/posts/turtlesim/"},"url":"https://dkssud8150.github.io/posts/turtlesim/"}</script><title>[ROS2 이론] turtlesim 실행 | JaeHo Yoon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaeHo Yoon"><meta name="application-name" content="JaeHo Yoon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/shin_chan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaeHo Yoon</a></div><div class="site-subtitle font-italic">Mamba Mentality</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fab fa-angellist ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/dkssud8150" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hoya58150','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.notion.so/18490713817d403696812c57d0abe730" aria-label="notion" target="_blank" rel="noopener"> <i class="fab fa-battle-net"></i> </a> <a href="https://www.linkedin.com/in/jaeho-yoon-90b62b230" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/jai_ho8150/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[ROS2 이론] turtlesim 실행</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[ROS2 이론] turtlesim 실행</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/dkssud8150">JaeHo YooN</a> </em></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-07-26 04:23:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Tue, Jul 26, 2022, 4:23 AM +0900" >Jul 26, 2022</em> </span> <span> Updated <em class="timeago" date="2022-08-02 22:11:51 +0900 " data-toggle="tooltip" data-placement="bottom" title="Tue, Aug 2, 2022, 10:11 PM +0900" >Aug 2, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7166 words"> <em>39 min</em> read</span></div></div></div><div class="post-content"><div class="table-wrapper"><table><tbody><tr><td>개발 환경을 설정하는 것은 <a href="https://dkssud8150.github.io/posts/introduction/">해당 블로그</a>를 확인해보길 바란다.</table></div><p> </p><ul><li><a href="https://cafe.naver.com/openrt/24065">007 패키지 설치와 노드 실행</a></ul><h1 id="turtlesim-이란">Turtlesim 이란?</h1><div class="table-wrapper"><table><tbody><tr><td>추가 예정.</table></div><p> </p><p> </p><h1 id="turtlesim-패키지-설치">Turtlesim 패키지 설치</h1><p>turtlesim은 ROS의 기본 기능을 가지고 있어 튜토리얼로 많이 사용된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>ros-foxy-turtlesim
</pre></table></code></div></div><p>turtlesim 패키지에 포함된 노드가 어떤 것들이 있는지 확인해보자.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 pkg executables turtlesim
turtlesim draw_square
turtlesim mimic
turtlesim turtle_teleop_key
turtlesim turtlesim_node
</pre></table></code></div></div><ul><li>draw_square : 사각형 모양으로 turtle을 움직이게 하는 노드<li>mimic : 유저가 지정한 토픽으로 동일 움직임의 turtlesim_node를 복수개 실행시킬 수 있는 노드<li>turtle_teleop_key : turtlesim_node를 움직이게 하는 속도 값을 퍼블리시하는 노드<li>turtlesim_node : turtle_teleop_key로부터 속도 값을 토픽으로 받아 움직이게 하는 간단 2D 시뮬레이터 노드</ul><p> </p><h1 id="turtlesim-패키지-노드-실행">Turtlesim 패키지 노드 실행</h1><p><strong>turtlesim_node</strong> 노드와 <strong>turtle_teleop_key</strong> 노드를 실행시키면 파란색 창에 거북이가 보인다. <strong>turtle_teleop_key</strong> 노드를 실행시키면 화살표키로 <strong>turtlesim_node</strong> 노드의 거북이를 움직일 수 있게 된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 run turtlesim turtlesim_node
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 run turtlesim turtle_teleop_key
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtlesim1.png" data-proofer-ignore></p><p><img data-src="/assets/img/ros2/turtlesim/turtlesim2.png" data-proofer-ignore></p><p> </p><ul><li>키보드로 움직일 수도 있는데, 눌려진 키보드의 키 값이 어떻게 메시지로 전달되는지 확인해봐야 한다. 키 값은 linear velocity와 angular velocity가 포함된 geometry_msgs 패키지의 Twist 메시지 형태로 보내지고 있다.</ul><p> </p><p>그렇기에 직접 터미널로 토픽을 발행하여 조종해보자.</p><p>그 전에 노드, 토픽, 서비스, 액션에 대해 알고 있어야 한다.</p><p> </p><ul><li><a href="https://cafe.naver.com/openrt/24086">008 ROS2 노드와 데이터 통신</a></ul><p>노드와 메시지 통신은 앞서 글에서 배웠기 때문에, 간단히 설명했다.</p><ul><li>노드(node)<ul><li>최소 단위의 실행 가능한 프로세스<li>각 노드는 서로 유기적으로 message로 연결되어 사용된다.</ul><li>메시지 통신(message communication)<ul><li>노드와 노드 사이에 입력과 출력 데이터를 서로 주고받게 설계해야 한다. 주고 받는 데이터를 메시지(message)라 한다.<li>주고받는 방식을 메시지 통신(message communication)이라 한다.<li>주고받는 통신 방법에 따라 토픽, 서비스, 액션, 파라미터로 나뉜다.</ul></ul><p> </p><ul><li>토픽</ul><p><img data-src="/assets/img/ros2/turtlesim/topic.png" data-proofer-ignore></p><p>그림에서처럼 NodeA - NodeB, NodeA - NodeC 처럼 비동기식 단방향 메시지 송수신 방식을 <strong>토픽</strong>(topic)이라 하고, 메시지를 발간하는 <em>Publisher</em>, 메시지를 구독하는 <em>Subscriber</em>가 존재한다.</p><p> </p><ul><li>서비스</ul><p><img data-src="/assets/img/ros2/turtlesim/topic_service.png" data-proofer-ignore></p><p>NodeB - NodeC 처럼 동기식 양방향 메시지 송수신 방식을 <strong>서비스</strong>(Service)라 하고, 서비스를 요청(request)하는 쪽을 <em>service client</em>라 하고, 서비스를 응답(response)하는 쪽을 <em>service server</em>라 한다.</p><p> </p><ul><li>액션</ul><p><img data-src="/assets/img/ros2/turtlesim/topic_service_action.png" data-proofer-ignore></p><p>NodeA - NodeB 처럼 비동기식 + 동기식 양방향 메시지 송수신 방식을 액션(action)이라 하고, 액션 목표(Goal)을 지정하는 <strong>action client</strong>와 액션 목표를 받아 특정 태스크를 수행하면서 중간 결과값에 해당하는 액션 피드백(Feedback)과 최종 결과값에 해당하는 액션 결과(result)를 전송하는 action server간의 통신을 액션(action)이라 볼 수 있다.</p><p>즉 <code class="language-plaintext highlighter-rouge">Action Goal -&gt; Action Feedback -&gt; Action Result</code> 로 진행된다.</p><p>액션의 구현 방식을 더 자세히 살펴보면 토픽과 서비스의 혼합이라 볼 수 있는데, 액션 목표와 액션 결과를 전달하는 방식은 서비스와 같고, 액션 피드백은 토픽과 같은 메시지 전송 방식이다. 그래서 피드백의 퍼블리셔는 Action Server라 할 수 있고, 피드백의 서브스크라이버는 Action client와 service client라 할 수 있다.</p><p> </p><ul><li>파라미터</ul><p><img data-src="/assets/img/ros2/turtlesim/parameter.png" data-proofer-ignore></p><p>각 노드에 <strong>파라미터 관련 parameter server를 실행시켜 외부의 parameter client 간의 통신</strong>으로 파라미터를 변경하는 것으로 서비스와 동일하다. 단 노드 내 매개변수 또는 글로벌 매개변수를 서비스 메시지 통신 방법을 사용하여 <strong>노드 내부 또는 외부에서 쉽게 지정(set)하거나 변경할 수 있고, 쉽게 가져와(get) 사용</strong>할 수 있다.</p><p> </p><p>이제 turtlesim에서 실행되는 통신을 살펴보자. 먼저 어떤 노드들이 실행되고, 어떤 토픽, 어떤 서비스와 액션이 있는지 확인해봐야 한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node list
/teleop_turtle
/turtlesim

<span class="nv">$ </span>ros2 topic list
/parameter_events
/rosout
/turtle1/cmd_vel
/turtle1/color_sensor
/turtle1/pose

<span class="nv">$ </span>ros2 service list
/clear
/kill
/reset
/spawn
/teleop_turtle/describe_parameters
/teleop_turtle/get_parameter_types
/teleop_turtle/get_parameters
/teleop_turtle/list_parameters
/teleop_turtle/set_parameters
/teleop_turtle/set_parameters_atomically
/turtle1/set_pen
/turtle1/teleport_absolute
/turtle1/teleport_relative
/turtlesim/describe_parameters
/turtlesim/get_parameter_types
/turtlesim/get_parameters
/turtlesim/list_parameters
/turtlesim/set_parameters
/turtlesim/set_parameters_atomically

<span class="nv">$ </span>ros2 action list
/turtle1/rotate_absolute
</pre></table></code></div></div><p> </p><p>그리고 rqt_graph로 시각화할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rqt_graph
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtlesim_rqt_graph.png" data-proofer-ignore></p><p> </p><h2 id="turtlesim-노드-정보">turtlesim 노드 정보 <a href="#turtlesim-노드-정보" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>먼저 노드를 자세히 살펴보고자 한다. turtlesim의 노드는 총 2개로 구성되어 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node list
/teleop_turtle
/turtlesim
</pre></table></code></div></div><p>turtlesim_node 노드 파일은 turtlesim이라는 노드명으로 실행되어 있고, turtle_teleop_key 노드 파일은 teleop_turtle 이라는 노드명으로 실행되어 있다.</p><p>이 때, 동일 노드를 여러 개 실행하고자 하면 이전과 동일하게 <code class="language-plaintext highlighter-rouge">ros2 run turtlesim turtlesim_node</code>로 실행할 수 있는데, 이렇게 하면 동일한 노드 이름으로 생성된다.</p><p>만약 다른 노드 이름으로 설정하고자 한다면 아래 명령어로 실행한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 run turtlesim turtlesim_node __node:<span class="o">=</span>new_turtle
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtlesim_rqt_graph2.png" data-proofer-ignore></p><p> </p><p>노드 이름만 변경되었고, 토픽인 <code class="language-plaintext highlighter-rouge">turtle1/cmd_vel</code>은 동일하다. 만약 teleop_turtle 노드를 이용하여 거북이를 움직이면 두 개의 노드의 거북이가 동일하게 움직인다. 이는 동일한 토픽을 이용하기 때문이다. 이 토픽 또한 토픽명을 변경하거나 name_space를 통해 바꿀 수 있다.</p><p><img data-src="/assets/img/ros2/turtlesim/turtlesim_rqt_graph3.png" data-proofer-ignore></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node list
/new_turtle
/teleop_turtle
/turtlesim
</pre></table></code></div></div><p> </p><p> </p><p>노드의 정보를 확인하기 위해서는 <code class="language-plaintext highlighter-rouge">ros2 node info</code> 명령어를 사용해야 한다. 이를 통해 퍼블리셔, 서브스크라이버, 서비스, 액션, 파라미터 정보를 확인할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node info /turtlesim
/turtlesim
  Subscribers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /turtle1/cmd_vel: geometry_msgs/msg/Twist
  Publishers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /rosout: rcl_interfaces/msg/Log
    /turtle1/color_sensor: turtlesim/msg/Color
    /turtle1/pose: turtlesim/msg/Pose
  Service Servers:
    /clear: std_srvs/srv/Empty
    /kill: turtlesim/srv/Kill
    /reset: std_srvs/srv/Empty
    /spawn: turtlesim/srv/Spawn
    /turtle1/set_pen: turtlesim/srv/SetPen
    /turtle1/teleport_absolute: turtlesim/srv/TeleportAbsolute
    /turtle1/teleport_relative: turtlesim/srv/TeleportRelative
    /turtlesim/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /turtlesim/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
    /turtlesim/get_parameters: rcl_interfaces/srv/GetParameters
    /turtlesim/list_parameters: rcl_interfaces/srv/ListParameters
    /turtlesim/set_parameters: rcl_interfaces/srv/SetParameters
    /turtlesim/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
  Service Clients:

  Action Servers:
    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
  Action Clients:
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node info /teleop_turtle
/teleop_turtle
  Subscribers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
  Publishers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /rosout: rcl_interfaces/msg/Log
    /turtle1/cmd_vel: geometry_msgs/msg/Twist
  Service Servers:
    /teleop_turtle/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /teleop_turtle/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
    /teleop_turtle/get_parameters: rcl_interfaces/srv/GetParameters
    /teleop_turtle/list_parameters: rcl_interfaces/srv/ListParameters
    /teleop_turtle/set_parameters: rcl_interfaces/srv/SetParameters
    /teleop_turtle/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
  Service Clients:

  Action Servers:

  Action Clients:
    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
</pre></table></code></div></div><p> </p><p> </p><h2 id="turtlesim-토픽">turtlesim 토픽 <a href="#turtlesim-토픽" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://cafe.naver.com/openrt/24101">009 ROS2 토픽 (topic)</a></ul><p>토픽은 비동기식 단방향 메시지 송수신 방식으로 메시지 형태로 메시지를 발행하는 퍼블리셔(publisher)와 메시지를 구동하는 서브스크라이버(subscriber) 간의 통신이라 볼 수 있다. 이는 1:1 통신을 기본으로 하지만, 1:N도 가능하고, 구성에 따라 N:1, N:N 통신도 가능하다.</p><p>하나의 노드가 퍼블리셔와 서브스크라이버를 동시에 수행할 수도 있다. 원한다면 자신이 발행한 토픽을 셀프 구독할 수 있게 구성할 수도 있다.</p><p><img data-src="/assets/img/ros2/turtlesim/node_and_topic.png" data-proofer-ignore></p><p> </p><ul><li>토픽 목록 확인</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 run turtlesim turtlesim_node
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 run turtlesim turtle_teleop_key
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node info /turtlesim
/turtlesim
  Subscribers:
    /turtle1/cmd_vel: geometry_msgs/msg/Twist
  Publishers:
    /turtle1/color_sensor: turtlesim/msg/Color
    /turtle1/pose: turtlesim/msg/Pose
...
</pre></table></code></div></div><p>토픽만을 보면 위와 같을 것이다.</p><ul><li>turtlesim 노드<ul><li>subscriber<ul><li>geometry_msgs/msg/Twist 형태의 메시지인 turtle1/cmd_vel</ul><li>publisher<ul><li>turtlesim/msg/color_sensor 메시지 형태인 turtle1/color_sensor<li>turtlesim/msg/Pose 메시지 형태인 turtle1/pose</ul></ul></ul><p> </p><p>간단한 리스트로 확인하기 위해서는 다음과 같이 명령어를 실행하면 된다. 동작 중인 모든 노드들의 토픽 정보를 확인할 수 있다. 이 때, <code class="language-plaintext highlighter-rouge">-t</code>는 메시지의 형태도 함께 표시하기 위한 옵션이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 topic list <span class="nt">-t</span>
/parameter_events <span class="o">[</span>rcl_interfaces/msg/ParameterEvent]
/rosout <span class="o">[</span>rcl_interfaces/msg/Log]
/turtle1/cmd_vel <span class="o">[</span>geometry_msgs/msg/Twist]
/turtle1/color_sensor <span class="o">[</span>turtlesim/msg/Color]
/turtle1/pose <span class="o">[</span>turtlesim/msg/Pose]
</pre></table></code></div></div><p> </p><ul><li>토픽 정보 확인</ul><p>하나의 토픽을 더 자세히 확인해보자.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 topic info /turtle1/cmd_vel
Type: geometry_msgs/msg/Twist
Publisher count: 1
Subscription count: 1
</pre></table></code></div></div><p>메시지 타입은 <strong>Twist</strong>, 퍼블리셔 1개, 서브스크라이버 1개로 구성되어 있다.</p><p> </p><ul><li>토픽 내용 확인</ul><p>토픽의 내용을 확인해보자. <code class="language-plaintext highlighter-rouge">teleop_key</code>를 실행한 터미널에서 방향키를 눌러 거북이를 움직이게 되면, linear 와 angular 값이 담긴 토픽이 발행되고 있는 것을 볼 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 topic <span class="nb">echo</span> /turtle1/cmd_vel
linear:
  x: 2.0
  y: 0.0
  z: 0.0
angular:
  x: 0.0
  y: 0.0
  z: 0.0
<span class="nt">---</span>
linear:
  x: 0.0
  y: 0.0
  z: 0.0
angular:
  x: 0.0
  y: 0.0
  z: 2.0
<span class="nt">---</span>
</pre></table></code></div></div><p>linear에 x,y,z , angular에 x,y,z 총 6개의 값으로 구성되어 있고, linear.x 값은 1.0m/s 단위로 구성되어 있다.</p><p>모든 메시지는 meter, second, degree, kg 등 SI 단위를 기본으로 사용한다.</p><p> </p><ul><li>메시지 크기 확인</ul><p>메시지의 대역폭, 즉 송수신받는 토픽 메시지의 크기를 확인해보고자 한다. 크기 확인은 <code class="language-plaintext highlighter-rouge">ros2 topic bw</code>로 토픽의 초당 대역폭을 확인해볼 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 topic bw /turtle1/cmd_vel
Subscribed to <span class="o">[</span>/turtle1/cmd_vel]
35 B/s from 2 messages
        Message size mean: 52 B min: 52 B max: 52 B
26 B/s from 2 messages
        Message size mean: 52 B min: 52 B max: 52 B
21 B/s from 2 messages
        Message size mean: 52 B min: 52 B max: 52 B
18 B/s from 2 messages
        Message size mean: 52 B min: 52 B max: 52 B
15 B/s from 2 messages
        Message size mean: 52 B min: 52 B max: 52 B
13 B/s from 2 messages
        Message size mean: 52 B min: 52 B max: 52 B
</pre></table></code></div></div><p>방향키를 통해 실행을 해보면 약 35 B/s 정도의 대역폭을 가지고 있고, 토픽을 보내지 않으면 값이 계속 감소된다.</p><p> </p><ul><li>토픽 주기 확인</ul><p>토픽의 전송 주기를 확인하기 위해서는 <code class="language-plaintext highlighter-rouge">ros2 topic hz</code>를 사용해야 한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 topic hz /turtle1/cmd_vel
average rate: 0.449
        min: 1.016s max: 3.439s std dev: 1.21158s window: 2
average rate: 0.293
        min: 1.016s max: 5.792s std dev: 1.94967s window: 3
</pre></table></code></div></div><p>/turtle1/cmd_vel 토픽을 발행하면 약 0.3 Hz를 가지고 있다. 이는 약 0.0003초에 한번씩 토픽을 발행한다.</p><p> </p><ul><li>토픽 지연 시간 확인</ul><p>토픽은 RMW 및 네트워크 장비를 거치기 때문에, latency가 반드시 존재한다. 지연 시간을 체크하는 방식은 메시지 내 header라는 stamp 메시지를 사용하여 체크한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 topic delay /TOPIC_NAME
</pre></table></code></div></div><p>그러나 turtlesim에서는 stamp가 없기에 테스트는 수행하지 못했다.</p><p> </p><ul><li>토픽 발행</ul><p>토픽을 발행하는 방법은 <code class="language-plaintext highlighter-rouge">ros2 topic pub &lt;topic-name&gt; &lt;msg type&gt; "&lt;args&gt;"</code> 로 발행할 수 있다.</p><p>이 때, <code class="language-plaintext highlighter-rouge">--once</code>옵션을 사용하여 단 한번만 발행을 할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 topic pub <span class="nt">--once</span> /turtle1/cmd_vel geometry_msgs/msg/Twist <span class="s2">"{linear: {x: 2.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 1.8}}"</span>
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/pubonce_turtle.png" data-proofer-ignore></p><p>이 때, linear은 m/s 단위이고, angular는 rad/s 단위이다.</p><p> </p><p>지속적인 발행을 원한다면 –once 옵션을 제거하고 –rate옵션을 사용하여 Hz 단위로 발행한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 topic pub <span class="nt">--rate</span> 1 /turtle1/cmd_vel geometry_msgs/msg/Twist <span class="s2">"{linear: {x: 2.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 1.8}}"</span>
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/pubrate_turtle.png" data-proofer-ignore></p><p> </p><p> </p><p>거북이를 조종할 때 <code class="language-plaintext highlighter-rouge">← ↑ ↓ →</code> 키를 사용하여 움직일 수 있는데, 터미널에도 나오듯이 F를 기준으로 <code class="language-plaintext highlighter-rouge">G,B,V,C,D,E,R,T</code>를 사용해서도 거북이를 움직일 수 있다.</p><p><img data-src="/assets/img/ros2/turtlesim/movement_f.png" data-proofer-ignore></p><p>R키를 누르면, 1.57 radian 방향인 π/2, 즉 위 방향을 바라보게 된다.</p><p> </p><p> </p><h2 id="bag-파일-저장">bag 파일 저장 <a href="#bag-파일-저장" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>토픽을 파일 형태로 저장할 수 있다. 이 때 저장하는 파일의 형태가 bag 이고, 저장된 토픽은 다시 불러와 동일한 타이밍에 재생할 수 있다. 이를 <strong>rosbag</strong>이라 한다.</p><p>명령하는 방법은 <code class="language-plaintext highlighter-rouge">ros2 bag record &lt;topic_name1&gt; &lt;topic_name2&gt; &lt;topic_name3&gt;</code> 와 같이 사용하여 원하는 토픽만 기록할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 bag record &lt;topic_name1&gt; &lt;topic_name2&gt; &lt;topic_name3&gt;
</pre></table></code></div></div><p> </p><p><code class="language-plaintext highlighter-rouge">-a</code>를 사용하면 전체 토픽을 저장할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 bag record <span class="nt">-a</span>
</pre></table></code></div></div><p> </p><p>원하는 이름이 있다면 -o 를 사용하여 이름을 지정한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ros2 topic pub <span class="nt">--rate</span> 1 /turtle1/cmd_vel geometry_msgs/msg/Twist <span class="s2">"{linear: {x: 2.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 1.8}}"</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c">### ros2 bag record -o &lt;file-name&gt; &lt;topic-name&gt;</span>
<span class="nv">$ </span>ros2 bag record <span class="nt">-o</span> test.bag turtle1/cmd_vel
<span class="o">[</span>INFO]: Opened database <span class="s1">'test.bag/test.bag_0.db3'</span> <span class="k">for </span>READ_WRITE.
<span class="o">[</span>INFO]: Listening <span class="k">for </span>topics...
<span class="o">[</span>INFO]: Subscribed to topic <span class="s1">'/turtle1/cmd_vel'</span>
<span class="o">[</span>INFO]: All requested topics are subscribed. Stopping discovery...
</pre></table></code></div></div><p> </p><ul><li>bag 파일 정보 확인</ul><p>저장된 bag파일의 정보를 확인할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 bag info test.bag
Files:             test.bag_0.db3
Bag size:          16.8 KiB
Storage <span class="nb">id</span>:        sqlite3
Duration:          1.984s
Start:             Jul 26 2022 14:43:24.586 <span class="o">(</span>1658814204.586<span class="o">)</span>
End:               Jul 26 2022 14:43:26.571 <span class="o">(</span>1658814206.571<span class="o">)</span>
Messages:          9
Topic information: Topic: /turtle1/cmd_vel | Type: geometry_msgs/msg/Twist | Count: 9 | Serialization Format: cdr
</pre></table></code></div></div><p> </p><ul><li>bag 파일 재생</ul><p>저장된 bag 파일을 재생하여 토픽을 발행할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 bag play test.bag
<span class="o">[</span>INFO]: Opened database <span class="s1">'test.bag/test.bag_0.db3'</span> <span class="k">for </span>READ_ONLY.
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/bagplay_turtle.png" data-proofer-ignore></p><p> </p><p> </p><h2 id="ros-인터페이스">ROS 인터페이스 <a href="#ros-인터페이스" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>ROS 노드 간에 데이터를 주고받을 때 토픽, 서비스, 액션이 사용되는데, 이 때 사용되는 데이터의 형태를 ROS 인터페이스(interface)라 한다. ROS 인터페이스에는 ROS2에 새롭게 추가된 IDL(Interface Definition Language)와 ROS1부터 존재하던 msg, srv, action 등이 있다.</p><p>즉, 토픽, 서비스, 액션은 각각 msg, srv, action interface를 사용하고 있으며 정수, 소수, bool 등과 같은 단순 자료형을 기본으로 하고, 메시지 안에 메시지를 품는 구조도 있다.</p><p> </p><h3 id="메시지-인터페이스-message-interface-msg">메시지 인터페이스 (message interface, msg) <a href="#메시지-인터페이스-message-interface-msg" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>지금까지 다루던 토픽의 형태가 msg 분류의 데이터 형태이다. 예를 들어 Twist 데이터 형태를 자세히 보면 Vector3 linear와 Vector3 angular 가 있는데, 이것이 메시지 안에 메시지를 품고 있는 형태이다. Vector3안에는 또 다시 float64 형태의 x,y,z 값이 존재한다.</p><ul><li>geometry_msgs/msgs/Twist<ul><li>Vector3 linear<ul><li>float64 x<li>float64 y<li>float64 z</ul><li>Vector3 angular<ul><li>float64 x<li>float64 y<li>float64 z</ul></ul></ul><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 interface show geometry_msgs/msg/Twist
Vector3  linear
Vector3  angular

<span class="nv">$ </span>ros2 interface show geometry_msgs/msg/Vector3
float64 x
float64 y
float64 z
</pre></table></code></div></div><p> </p><p>interface 명령어에는 show 이외에도 <strong>list</strong>, <strong>package</strong>, <strong>packages</strong>, <strong>proto</strong>가 있다.</p><ul><li>list : 현재 개발 환경의 모든 msg, srv, action 메시지를 보여준다.<li>package + &lt;package name&gt; : 지정한 패키지에 포함된 인터페이스를 보여준다.<li>packages : msg, srv, action 인터페이스를 담고 있는 패키지의 목록을 보여준다.<li>proto + &lt;interface&gt; : 특정 인터페이스 형태를 입력하면 인터페이스의 기본 형태를 표시해준다.</ul><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 interface list
Messages:
    action_msgs/msg/GoalInfo
    action_msgs/msg/GoalStatus
    action_msgs/msg/GoalStatusArray
    ...
Services:
    action_msgs/srv/CancelGoal
    composition_interfaces/srv/ListNodes
    composition_interfaces/srv/LoadNode
    ...
Actions:
    action_tutorials_interfaces/action/Fibonacci
    example_interfaces/action/Fibonacci
    tf2_msgs/action/LookupTransform
    turtlesim/action/RotateAbsolute
</pre></table></code></div></div><p>토픽에 해당되는 msg 인터페이스 이외에도 서비스, 액션 메시지도 존재하고 이를 srv, action 인터페이스라 한다.</p><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 interface packages
action_msgs
action_tutorials_interfaces
...
</pre></table></code></div></div><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 interface package turtlesim
turtlesim/srv/Spawn
turtlesim/msg/Pose
turtlesim/action/RotateAbsolute
turtlesim/srv/Kill
turtlesim/srv/TeleportAbsolute
turtlesim/srv/SetPen
turtlesim/srv/TeleportRelative
turtlesim/msg/Color
</pre></table></code></div></div><p>이 때, msg는 토픽, srv는 service, action은 action 인터페이스에 해당한다.</p><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 interface proto geometry_msgs/msg/Twist
<span class="s2">"linear:
  x: 0.0
  y: 0.0
  z: 0.0
angular:
  x: 0.0
  y: 0.0
  z: 0.0
"</span>
</pre></table></code></div></div><p> </p><p> </p><h1 id="turtlesim-서비스">Turtlesim 서비스</h1><ul><li><a href="https://cafe.naver.com/openrt/24128">010 ROS2 서비스 (service)</a></ul><p> </p><p>서비스는 동기식 양방향 메시지 송수신 방식으로 서비스의 요청(request)을 하는 쪽을 <strong>service client</strong>라 하며, 요청받은 서비스를 수행 후 서비스의 응답(response)을 하는 쪽을 <strong>service server</strong>라 한다.</p><p>결국 서비스는 특정 요청을 하는 클라이언트와 요청받은 일을 수행한 후 결괏값을 전달하는 서버 간의 통신이다. <strong>서비스 요청 및 응답</strong> 또한, msg 인터페이스의 변형인 <strong>srv 인터페이스</strong>라 한다.</p><p><img data-src="/assets/img/ros2/turtlesim/service.png" data-proofer-ignore></p><p> </p><p>서비스는 동일 서비스에 대해 복수의 클라이언트를 가질 수 있다. 단 응답은 서비스 요청이 있었던 클라이언트에 대해서만 응답하는 형태로, 위의 그림에서 Node C의 클라이언트가 Node B의 서버에게 요청을 했다면, B의 서버는 요청받은 서비스를 수행한 후 Node C의 클라이언트에게만 응답을 하게 된다.</p><p> </p><ul><li>서비스 목록 확인</ul><p>turtlesim 패키지를 통해 서비스 목록을 살펴보도록 한다. 목록을 살펴볼 때는 topic이랑 동일하게 <code class="language-plaintext highlighter-rouge">ros2 service list</code>로 확인할 수 있다.</p><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run turtlesim turtlesim_node
<span class="o">[</span>INFO]: Starting turtlesim with node name /turtlesim
<span class="o">[</span>INFO]: Spawning turtle <span class="o">[</span>turtle1] at <span class="nv">x</span><span class="o">=[</span>5.544445], <span class="nv">y</span><span class="o">=[</span>5.544445], <span class="nv">theta</span><span class="o">=[</span>0.000000]
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service list
/clear
/kill
/reset
/spawn
/turtle1/set_pen
/turtle1/teleport_absolute
/turtle1/teleport_relative
/turtlesim/describe_parameters
/turtlesim/get_parameter_types
/turtlesim/get_parameters
/turtlesim/list_parameters
/turtlesim/set_parameters
/turtlesim/set_parameters_atomically
</pre></table></code></div></div><p>파라미터가 붙어있는 부분을 제외한 7가지의 서비스에 대해 자세하게 알아보자.</p><p> </p><ul><li>서비스 형태 확인</ul><p>서비스 형태 확인 명령어는 <code class="language-plaintext highlighter-rouge">ros2 service type &lt;service name&gt;</code> 이다. 그러나 더 쉽게 확인하는 방법은 <code class="language-plaintext highlighter-rouge">ros2 service list -t</code>를 사용할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service <span class="nb">type</span> /clear
std_srvs/srv/Empty

<span class="nv">$ </span>ros2 service <span class="nb">type</span> /kill
turtlesim/srv/Kill
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service list <span class="nt">-t</span>
/clear <span class="o">[</span>std_srvs/srv/Empty]
/kill <span class="o">[</span>turtlesim/srv/Kill]
/reset <span class="o">[</span>std_srvs/srv/Empty]
/spawn <span class="o">[</span>turtlesim/srv/Spawn]
/turtle1/set_pen <span class="o">[</span>turtlesim/srv/SetPen]
/turtle1/teleport_absolute <span class="o">[</span>turtlesim/srv/TeleportAbsolute]
/turtle1/teleport_relative <span class="o">[</span>turtlesim/srv/TeleportRelative]
...
</pre></table></code></div></div><p>clear 서비스는 std_srvs/srv/Empty 형태이고, kill 서비스는 turtlesim/srv/Kill 형태임을 확인할 수 있다.</p><p> </p><ul><li>서비스 찾기</ul><p>서비스 형태를 통해 서비스명을 찾을 수 있다. <code class="language-plaintext highlighter-rouge">ros2 service find &lt;service type&gt;</code> 와 같이 서비스 형태를 넣으면 서비스명을 찾는다.</p><p> </p><h2 id="서비스-요청">서비스 요청 <a href="#서비스-요청" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>실제 서비스 서버에게 서비스를 요청(request)해본다. 서비스 요청은 <code class="language-plaintext highlighter-rouge">ros2 service call &lt;service_name&gt; &lt;service_type&gt; "&lt;arguments&gt;"</code>를 통해 보낼 수 있다. <strong>/clear</strong> 서비스는 turtlesim 노드를 동작할 때 표시되는 이동 궤적을 지우는 서비스이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 run turtlesim turtle_teleop_key
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtle_move.png" data-proofer-ignore></p><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service call /clear std_srvs/srv/Empty
waiting <span class="k">for </span>service to become available...
requester: making request: std_srvs.srv.Empty_Request<span class="o">()</span>

response:
std_srvs.srv.Empty_Response<span class="o">()</span>
</pre></table></code></div></div><p>뒤에 argument 부분이 없는 이유는 해당 서비스가 아무런 내용이 없는 형태로도 사용이 가능하기 때문이다.</p><p><img data-src="/assets/img/ros2/turtlesim/turtle_clear.png" data-proofer-ignore></p><p> </p><p><strong>/kill</strong> 서비스는 죽이고자 하는 거북이 이름을 서비스 요청의 내용을 입력하면 거북이가 사라지게 된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service call /kill turtlesim/srv/Kill <span class="s2">"name: 'turtle1'"</span>
waiting <span class="k">for </span>service to become available...
requester: making request: turtlesim.srv.Kill_Request<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s1">'turtle1'</span><span class="o">)</span>

response:
turtlesim.srv.Kill_Response<span class="o">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtle_kill.png" data-proofer-ignore></p><p> </p><p>이번에는 <strong>/reset</strong> 서비스를 해보자. 이 서비스는 단어 그대로 모든 것을 리셋하여 거북이를 처음 상태로 되돌린다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service call /reset std_srvs/srv/Empty
waiting <span class="k">for </span>service to become available...
requester: making request: std_srvs.srv.Empty_Request<span class="o">()</span>

response:
std_srvs.srv.Empty_Response<span class="o">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtle_reset.png" data-proofer-ignore></p><p> </p><p>이제 <strong>/set_pen</strong> 을 통해 거북이의 궤적의 색과 크기를 지정해보자. r,g,b, width, offset을 통해 변경이 가능하다/</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service call /turtle1/set_pen turtlesim/srv/SetPen <span class="s2">"{r: 255, g: 255, b: 255, width: 10}"</span>
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtle_set_pen.png" data-proofer-ignore></p><p> </p><p>마지막으로 <strong>/spawn</strong> 서비스를 사용하여 해당 위치 및 자세에 맞게 거북이를 추가한다. 이름 옵션을 지정하지 않으면 자동으로 지정된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 service call /spawn turtlesim/srv/Spawn <span class="s2">"{x: 5.5, y: 9, theta: 1.57, name: 'leonardo'}"</span>
waiting <span class="k">for </span>service to become available...
requester: making request: turtlesim.srv.Spawn_Request<span class="o">(</span><span class="nv">x</span><span class="o">=</span>5.5, <span class="nv">y</span><span class="o">=</span>9.0, <span class="nv">theta</span><span class="o">=</span>1.57, <span class="nv">name</span><span class="o">=</span><span class="s1">'leonardo'</span><span class="o">)</span>

response:
turtlesim.srv.Spawn_Response<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s1">'leonardo'</span><span class="o">)</span>
</pre></table></code></div></div><p><img data-src="/assets/img/ros2/turtlesim/turtle_spawn.png" data-proofer-ignore></p><p> </p><ul><li>서비스 인터페이스</ul><p>서비스 또한 토픽과 마찬가지로 인터페이스를 가지고 있고, 파일로는 srv파일을 가르킨다. 서비스 인터페이스는 메시지 인터페이스의 확장형이라 볼 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 interface show turtlesim/srv/Spawn.srv
float32 x
float32 y
float32 theta
string name <span class="c"># Optional.  A unique name will be created and returned if this is empty</span>
<span class="nt">---</span>
string name
</pre></table></code></div></div><p>Spawn.srv 에는 float32 형태의 x,y,theta, string 형태의 name 이라는 데이터가 들어 있다. 여기서 특이한 것은 <code class="language-plaintext highlighter-rouge">---</code>인데, 이는 구분자라 하여 요청과 응답을 나누어 사용하기 위한 구분이라 할 수 있다. 즉 구분자 위의 x,y,theta, name 부분은 서비스 요청에 해당하여 클라이언트에서 서버로 전송하는 값이다. 아래의 name은 응답 부분에 해당하여 지정된 서비스 요청을 수행하고, name 데이터를 클라이언트에 전송한다.</p><p>Spawn 서비스를 사용하려면 위치인 x,y와 자세인 theta, 거북이 이름인 name를 통해 거북이를 생성하고, 응답 부분의 name에 신규 거북이의 이름이 저장된다.</p><p> </p><p> </p><h1 id="turtlesim-액션">Turtlesim 액션</h1><ul><li><a href="https://cafe.naver.com/openrt/24142">011 ROS2 액션 (action)</a></ul><p> </p><p><img data-src="/assets/img/ros2/turtlesim/action.png" data-proofer-ignore></p><p>비동기식 + 동기식 양방향 메시지 송수신 방식으로 액션 <strong>목표(goal)을 지정하는 액션 클라이언트</strong>와 액션 목표를 받아 특정 태스크를 수행하면서 <strong>중간 결괏값에 해당되는 액션 피드백</strong>과 최종 결괏값에 해당되는 <strong>액션 결과를 전송하는 맥션 서버 간의 통신</strong>이라 할 수 있다.</p><p> </p><p><img data-src="/assets/img/ros2/turtlesim/action2.png" data-proofer-ignore></p><p>더 자세히 들여다보면, 액션 클라이언트는 서비스 클라이언트 3개와 서브스크라이버 2개로 구성되어 있고, 액션 서버는 서비스 서버 3개와 퍼블리셔 2개로 구성되어 있다. 액션 데이터는 action 인터페이스라 한다.</p><p> </p><p>ROS1에서의 액션은 목표, 피드백, 결과 값을 토픽으로만 주고 받았는데, ROS2에서는 토픽과 서비스 방식을 혼합하여 사용했다. 그 이유는 토픽으로만 액션을 구성했을 때는 비동기식 방식으로 구성되는데 반해, ROS2는 서비스와 토픽 방식의 혼합으로 인한 동기식 방식이므로 원하는 타이밍에 적절한 액션을 수행하게 되었다.</p><p>ROS에서는 <strong>목표 상태</strong>(goal_state)라는 것이 존재하는데, 이는 목표 값을 전달한 후의 상태 머신을 구동하여 액션의 프로세스를 쫓는다. 여기서 <strong>상태머신</strong>(Goal State Machine)은 액션 목표 전달의 이후 <strong>액션의 상태 값을 액션 클라이언트에게 전달</strong>하여 액션이 원할하게 동작할 수 있도록 한다.</p><p> </p><ul><li>상태 머신 구조</ul><p><img data-src="/assets/img/ros2/turtlesim/goal_state_machine.png" data-proofer-ignore></p><p> </p><p>위에서 G,B,V,C,D,E,R,T 키를 사용하는 것이 rotate_absolute 액션을 수행하는 것이고, 이 키들은 액션의 목표 값을 전달하는 목적으로 사용된다. F 액션 목표를 취소하는 키이다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node info /turtlesim
/turtlesim
  ...
  Action Servers:
    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
  Action Clients:
</pre></table></code></div></div><p>turtlesim 노드는 액션 서버 역할을 하고, <code class="language-plaintext highlighter-rouge">turtlesim/action/RotateAbsolute</code> 이라는 action 인터페이스를 사용하는 /turtle1/rotate_absolute 라는 이름의 액션 서버임을 확인할 수 있다.</p><p> </p><p>만약 위의 키들로 액션을 수행하게 되면, <code class="language-plaintext highlighter-rouge">ros2 run turtlesim turtlesim_node</code>를 실행한 터미널에 아래와 같이 표시된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 node info /teleop_turtle
/teleop_turtle
  ...
  Action Servers:

  Action Clients:
    /turtle1/rotate_absolute: turtlesim/action/RotateAbsolute
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">teleop_turtle</code> 노드가 액션 클라이언트 역할을 한다.</p><p> </p><p> </p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">[</span>INFO]: Rotation goal completed successfully
</pre></table></code></div></div><p>그러나 전달되는 과정에서 F 키를 눌러 액션 목표를 취소하게 되면 취소되었다고 표시되고, 수행하던 행동을 멈춘다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">[</span>INFO]: Rotation goal canceled
</pre></table></code></div></div><p> </p><p>rotate_absolute 액션을 더 세분화하면 5가지로 구성된다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>/turtle1/rotate_absolute/_action/send_goal: turtlesim/action/RotateAbsolute_SendGoal

/turtle1/rotate_absolute/_action/cancel_goal: action_msgs/srv/CancelGoal

/turtle1/rotate_absolute/_action/status: action_msgs/msg/GoalStatusArray

/turtle1/rotate_absolute/_action/feedback: turtlesim/action/RotateAbsolute_FeedbackMessage

/turtle1/rotate_absolute/_action/get_result: turtlesim/action/RotateAbsolute_GetResult
</pre></table></code></div></div><p>추가적인 내용은 추후 설명한다고 한다.</p><p> </p><ul><li>액션 정보 확인</ul><p><code class="language-plaintext highlighter-rouge">ros2 action info</code> 를 통해 액션의 정보를 확인할 수 있는데, 여기에는 액션의 이름, 액션의 서버와 클라이언트 노드의 이름과 개수를 확인할 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 action info /turtle1/rotate_absolute
Action: /turtle1/rotate_absolute
Action clients: 1
    /teleop_turtle
Action servers: 1
    /turtlesim
</pre></table></code></div></div><p> </p><ul><li>액션 목표(action goal) 전달</ul><p><code class="language-plaintext highlighter-rouge">ros2 action send_goal &lt;action name&gt; &lt;action type&gt; "&lt;value&gt;"</code>를 통해 action을 보낼 수 있다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute <span class="s2">"{theta: 1.5708}"</span>
Waiting <span class="k">for </span>an action server to become available...
Sending goal:
     theta: 1.5708

Goal accepted with ID: 760369ad7f7f4cc8af2618fa688b65f6

Result:
    delta: <span class="nt">-0</span>.16000032424926758

Goal finished with status: SUCCEEDED
</pre></table></code></div></div><p>거북이를 12시 방향인 1.57 radian 값을 목표로 주게 되면 전달한 목표 값과 액션 목표의 UID(Unique ID), 시작 위치부터 결괏값에 해당하는 위치까지의 변위 값인 delta를 결과로 보여준다. 그리고 전달 상태를 표시하게 된다.</p><p>여기에 <code class="language-plaintext highlighter-rouge">--feedback</code>이라는 옵션을 주면, 거북이가 목표값까지의 남은 회전량을 표시해준다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute <span class="s2">"{theta: 1.5708}"</span> <span class="nt">--feedback</span>
Waiting <span class="k">for </span>an action server to become available...
Sending goal:
     theta: 1.5708

Feedback:
    remaining: 1.554800033569336

Goal accepted with ID: 21a4fdd053f84ea1935a9b3c582c9ac6

Feedback:
    remaining: 1.5388000011444092

Feedback:
    remaining: 1.5227999687194824

Feedback:
    remaining: 1.5067999362945557
...
Feedback:
    remaining: 0.05079972743988037

Feedback:
    remaining: 0.03479969501495361

Feedback:
    remaining: 0.018799662590026855

Result:
    delta: <span class="nt">-1</span>.536000370979309

Goal finished with status: SUCCEEDED
</pre></table></code></div></div><p> </p><ul><li>액션 인터페이스</ul><p>토픽, 서비스와 마찬가지로 액션도 인터페이스를 가지고 있다. action 파일이 이에 해당되고, 액션 인터페이스는 메시지 및 서비스 인터페이스의 확장형이라 볼 수 있다.</p><p><code class="language-plaintext highlighter-rouge">ros2 interface show &lt;action name&gt;</code> 명령어로 액션 인터페이스의 정보를 확인할 수 있는데, float32 형태의 theta, delta, remaining 이라는 세 개의 데이터가 있다. 여기도 마찬가지로 <code class="language-plaintext highlighter-rouge">---</code>라는 구분자가 있고, 맨 위부터 액션 목표(goal), 액션 결과(result), 액션 피드백(feedback)으로 나누어져 있다. 즉, theta는 액션 목표, delta는 액션 결과, 액션 피드백(feedback)이다. 모든 데이터는 radian 단위를 사용한다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ros2 interface show turtlesim/action/RotateAbsolute.action
<span class="c"># The desired heading in radians</span>
float32 theta
<span class="nt">---</span>
<span class="c"># The angular displacement in radians to the starting position</span>
float32 delta
<span class="nt">---</span>
<span class="c"># The remaining rotation in radians</span>
float32 remaining
</pre></table></code></div></div><p> </p><p> </p><h1 id="ros2-토픽서비스액션-정리">ROS2 토픽/서비스/액션 정리</h1><ul><li><a href="https://cafe.naver.com/openrt/24154">012 ROS2 토픽/서비스/액션 정리 및 비교</a></ul><p> </p><ul><li>토픽, 서비스, 액션 비교</ul><div class="table-wrapper"><table><thead><tr><th> <th>토픽 (topic)​<th>서비스 (service)<th>액션 (action)<tbody><tr><td>연속성<td>연속성<td>일회성<td>복합 (토픽+서비스)<tr><td>방향성<td>단방향<td>양방향<td>양방향<tr><td>동기성<td>비동기<td>동기<td>동기 + 비동기<tr><td>다자간 연결<td>1:1, 1:N, N:1, N:N(publisher:subscriber)<td>1:1(server:client)<td>1:1(server:client)<tr><td>노드 역할<td>발행자 (publisher), 구독자 (subscriber)<td>서버 (server), 클라언트 (client)<td>서버 (server), 클라언트 (client)<tr><td>동작 트리거<td>발행자<td>클라언트<td>클라언트<tr><td>인터페이스<td>msg 인터페이스<td>srv 인터페이스<td>action 인터페이스<tr><td>CLI 명령어<td>ros2 topic, ros2 interface<td>ros2 service, ros2 interface<td>ros2 action, ros2 interface<tr><td>사용 예<td>센서 데이터, 로봇 상태, 로봇 좌표, 로봇 속도 명령 등<td>LED 제어, 모터 토크 On/Off, IK/FK 계산, 이동 경로 계산 등<td>목적지로 이동, 물건 파지, 복합 태스크 등</table></div><p> </p><ul><li>msg, srv, action 인터페이스 비교</ul><div class="table-wrapper"><table><thead><tr><th> <th>msg 인터페이스<th>srv 인터페이스<th>action 인터페이스<tbody><tr><td>확장자<td>*.msg<td>*.srv<td>*.action<tr><td>데이터<td>토픽 데이터 (data)<td>서비스 요청 (request), 서비스 응답 (response)<td>액션 목표 (goal), 액션 결과 (result), 액션 피드백 (feedback)<tr><td>형식<td>fieldtype1 fieldname1, fieldtype2 fieldname2, fieldtype3 fieldname3<td>fieldtype1 fieldname1, fieldtype2 fieldname2, fieldtype3 fieldname3, fieldtype4 fieldname4<td>fieldtype1 fieldname1, fieldtype2 fieldname2, fieldtype3 fieldname3, fieldtype4 fieldname4, fieldtype5 fieldname5, fieldtype6 fieldname6<tr><td>사용 예<td>[geometry_msgs/msg/Twist], Vector3 linear, Vector3 angular<td>[turtlesim/srv/Spawn.srv], float32 x, float32 y , float32 theta , string name — string name<td>[turtlesim/action/RotateAbsolute.action], float32 theta, float32 delta, float32 remaining</table></div><p> </p><p> </p></div><div class="post-tail-wrapper text-muted"><div style="text-align: left;"> <a href="http://hits.dwyl.com/dkssud8150.github.io/posts/turtlesim/" target="_blank"> <img data-src="http://hits.dwyl.com/dkssud8150.github.io/posts/turtlesim.svg" data-proofer-ignore> </a></div><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/classlog/'>Classlog</a>, <a href='/categories/ros2/'>ROS2</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ros2/" class="post-tag no-text-decoration" >ROS2</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[ROS2 이론] turtlesim 실행 - JaeHo Yoon&amp;url=https://dkssud8150.github.io/posts/turtlesim/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[ROS2 이론] turtlesim 실행 - JaeHo Yoon&amp;u=https://dkssud8150.github.io/posts/turtlesim/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://dkssud8150.github.io/posts/turtlesim/&amp;text=[ROS2 이론] turtlesim 실행 - JaeHo Yoon" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dkssud8150.github.io/posts/turtlesim/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6611243953442169" crossorigin="anonymous"></script></div><script src="https://utteranc.es/client.js" repo="dkssud8150/dkssud8150.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/gitpage/">[깃허브 프로필 꾸미기] github 프로필 만들기</a><li><a href="/posts/product/">[깃허브 프로필 꾸미기] productive box 만들기</a><li><a href="/posts/regex/">[데브코스] 2주차 - linux 기초(REGEX)</a><li><a href="/posts/Kfold/">KFold Cross Validation 과 StratifiedKFold</a><li><a href="/posts/cmake/">[데브코스] 17주차 - CMake OpenCV, Eigen, Pangolin install </a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/package/"><div class="card-body"> <em class="timeago small" date="2022-07-27 01:23:00 +0900" >Jul 27, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip> [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기</h3><div class="text-muted small"><p> ROS 패키지 제작 ROS 패키지 설계 목적별로 나누어 노드 단위의 프로그램을 작성하고, 노드와 노드간의 데이터 통신을 설계해야 한다. 이번 예제 패키지는 토픽, 서비스, 액션으로 구성하고자 한다. 총 4개의 노드로 구성되며, 각 노드에서는 1개 이상의 토픽 퍼블리셔, 토픽 서브스크라이브, 서비스 서버, 서비스 클라이언트, 액션 서버, 액션 ...</p></div></div></a></div><div class="card"> <a href="/posts/introduction/"><div class="card-body"> <em class="timeago small" date="2022-07-25 18:35:00 +0900" >Jul 25, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ROS2 이론] 목차 및 개요</h3><div class="text-muted small"><p> 표윤석 박사님의 네이버 카페 글을 참고로 하여 ROS2를 공부하고, 기록하고자 합니다. 기본 URL : https://cafe.naver.com/openrt/24070 github : https://github.com/robotpilot/ros2-seminar-examples   목차는 기본적으로 이론/프로그래밍으로 나뉘어져 있고, 심...</p></div></div></a></div><div class="card"> <a href="/posts/helloworld/"><div class="card-body"> <em class="timeago small" date="2022-07-26 01:35:00 +0900" >Jul 26, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ROS2 프로그래밍] ROS 프로그래밍 코드 스타일 및 프로그래밍 기초</h3><div class="text-muted small"><p> 023 ROS 프로그래밍 규칙 (코드 스타일) ROS2 프로그래밍 규칙 (코드 스타일) 협업 프로그래밍 작업 시 일관된 규칙을 만들고, 이를 준수하여야 코드가 꼬이거나 문제가 생기지 않는다. ROS가 지원하느 프로그래밍 언어는 다양하지만, 가장 많이 사용되는 C++과 python만 살펴보자.   C++ style ROS2 Develo...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/helloworld/" class="btn btn-outline-primary" prompt="Older"><p>[ROS2 프로그래밍] ROS 프로그래밍 코드 스타일 및 프로그래밍 기초</p></a> <a href="/posts/package/" class="btn btn-outline-primary" prompt="Newer"><p> [ROS2 프로그래밍] ROS 패키지 설계 및 토픽 뜯어보기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">JaeHo YooN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devcourse/">devcourse</a> <a class="post-tag" href="/tags/deeplearning/">deeplearning</a> <a class="post-tag" href="/tags/cs231n/">CS231N</a> <a class="post-tag" href="/tags/ros/">ros</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kooc/">kooc</a> <a class="post-tag" href="/tags/opencv/">OpenCV</a> <a class="post-tag" href="/tags/pytorch-tutorial/">pytorch tutorial</a> <a class="post-tag" href="/tags/autonomous-driving/">Autonomous Driving</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NC7MWHVXJE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NC7MWHVXJE'); }); </script>